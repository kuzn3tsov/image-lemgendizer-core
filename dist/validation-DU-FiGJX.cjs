"use strict";const m={INVALID_FILE:"INVALID_FILE",UNSUPPORTED_TYPE:"UNSUPPORTED_TYPE",FILE_TOO_LARGE:"FILE_TOO_LARGE",DIMENSIONS_TOO_SMALL:"DIMENSIONS_TOO_SMALL",DIMENSIONS_TOO_LARGE:"DIMENSIONS_TOO_LARGE",INVALID_DIMENSIONS:"INVALID_DIMENSIONS",ASPECT_RATIO_MISMATCH:"ASPECT_RATIO_MISMATCH",QUALITY_OUT_OF_RANGE:"QUALITY_OUT_OF_RANGE",INVALID_FORMAT:"INVALID_FORMAT",TRANSPARENCY_LOSS:"TRANSPARENCY_LOSS",EXCESSIVE_COMPRESSION:"EXCESSIVE_COMPRESSION",AVIF_BROWSER_SUPPORT:"AVIF_BROWSER_SUPPORT",VARIABLE_DIMENSION_NOT_ALLOWED:"VARIABLE_DIMENSION_NOT_ALLOWED"},c={LARGE_FILE:"LARGE_FILE",SMALL_DIMENSIONS:"SMALL_DIMENSIONS",LARGE_DIMENSIONS:"LARGE_DIMENSIONS",HIGH_QUALITY:"HIGH_QUALITY",LOW_QUALITY:"LOW_QUALITY",POTENTIAL_PIXELATION:"POTENTIAL_PIXELATION",CONTENT_LOSS:"CONTENT_LOSS",ASPECT_CHANGE:"ASPECT_CHANGE",MULTIPLE_OPTIMIZATIONS:"MULTIPLE_OPTIMIZATIONS",TRANSPARENCY_LOSS:"TRANSPARENCY_LOSS",AVIF_BROWSER_SUPPORT:"AVIF_BROWSER_SUPPORT",VARIABLE_DIMENSION_USED:"VARIABLE_DIMENSION_USED",FLEXIBLE_TEMPLATE:"FLEXIBLE_TEMPLATE"};function L(a){if(typeof a=="string"){const n=a.toLowerCase();return n==="auto"||n==="flex"||n==="variable"||n==="natural"}return!1}function p(a){if(L(a))return{value:null,isVariable:!0,type:a.toLowerCase(),raw:a};const n=Number(a);return{value:isNaN(n)?null:n,isVariable:!1,type:"fixed",raw:a}}function w(a,n=2){if(a===0)return"0 Bytes";const i=1024,r=n<0?0:n,s=["Bytes","KB","MB","GB","TB"],o=Math.floor(Math.log(a)/Math.log(i));return parseFloat((a/Math.pow(i,o)).toFixed(r))+" "+s[o]}function _(a={}){const n=[],i=[],r={valid:!0,errors:n,warnings:i},s=a.quality!==void 0?a.quality:85,o=a.format||"auto",l=a.compressionMode||"adaptive",t=a.maxDisplayWidth,e=a.browserSupport||["modern","legacy"],d=a.preserveTransparency!==!1;typeof s!="number"||s<1||s>100?(n.push({code:m.QUALITY_OUT_OF_RANGE,message:`Quality must be between 1-100, got ${s}`,severity:"error",suggestion:"Use quality between 60-95 for best results"}),r.valid=!1):s>95?i.push({code:c.HIGH_QUALITY,message:`High quality (${s}%) provides minimal visual improvement over 90%`,severity:"info",suggestion:"Consider 80-90% for optimal balance"}):s<50&&i.push({code:c.LOW_QUALITY,message:`Low quality (${s}%) may cause noticeable artifacts`,severity:"warning",suggestion:"Consider at least 60% for acceptable quality"});const f=["auto","webp","jpg","jpeg","png","avif","ico","svg","original"];if(f.includes(o.toLowerCase())||(n.push({code:m.INVALID_FORMAT,message:`Invalid format: ${o}`,severity:"error",suggestion:`Use one of: ${f.join(", ")}`}),r.valid=!1),o.toLowerCase()==="avif"){const g=Math.min(63,Math.round(s*.63));g<s&&i.push({code:"AVIF_QUALITY_ADJUSTED",message:`AVIF quality adjusted from ${s} to ${g} (different quality scale)`,severity:"info"})}t!=null&&(typeof t!="number"||t<10||t>1e4)&&i.push({code:"EXTREME_MAX_DISPLAY_WIDTH",message:`maxDisplayWidth (${t}) outside recommended range`,severity:"warning",suggestion:"Use between 100-4000px for web images"});const u=["adaptive","aggressive","balanced"];return u.includes(l)||i.push({code:"INVALID_COMPRESSION_MODE",message:`Invalid compression mode: ${l}`,severity:"warning",suggestion:`Use one of: ${u.join(", ")}`}),e&&!Array.isArray(e)&&i.push({code:"INVALID_BROWSER_SUPPORT",message:"browserSupport should be an array",severity:"warning",suggestion:'Use ["modern", "legacy"] or ["all"]'}),a.icoSizes&&Array.isArray(a.icoSizes)&&a.icoSizes.forEach(g=>{(g<16||g>512)&&i.push({code:"INVALID_ICO_SIZE",message:`ICO size ${g}px outside recommended range`,severity:"warning",suggestion:"Use sizes between 16-512px"})}),(o.toLowerCase()==="jpg"||o.toLowerCase()==="jpeg")&&d&&i.push({code:c.TRANSPARENCY_LOSS,message:"JPEG format does not support transparency",severity:"warning",suggestion:"Use PNG or WebP to preserve transparency"}),o.toLowerCase()==="avif"&&(!e||!e.includes("modern"))&&i.push({code:c.AVIF_BROWSER_SUPPORT,message:"AVIF format has limited browser support (Chrome 85+, Firefox 93+, Edge 85+)",severity:"info",suggestion:'Consider providing WebP fallback or use ["modern", "legacy"] browser support'}),l==="aggressive"&&s<60&&i.push({code:c.EXCESSIVE_COMPRESSION,message:"Aggressive compression with low quality may degrade image significantly",severity:"warning",suggestion:"Increase quality or use balanced/adaptive mode"}),r}function N(a,n={}){const{maxFileSize:i=50*1024*1024,minFileSize:r=1,allowedTypes:s=["image/jpeg","image/jpg","image/png","image/webp","image/gif","image/svg+xml","image/bmp","image/tiff","image/avif","image/x-icon","image/vnd.microsoft.icon"],checkDimensions:o=!1,minDimensions:l={width:1,height:1},maxDimensions:t={width:1e4,height:1e4}}=n,e={valid:!0,errors:[],warnings:[],metadata:{}};return a instanceof File?(a.size<r?(e.valid=!1,e.errors.push({code:m.INVALID_FILE,message:"File is empty",severity:"error"})):a.size>i?(e.valid=!1,e.errors.push({code:m.FILE_TOO_LARGE,message:`File too large (${w(a.size)} > ${w(i)})`,severity:"error"})):a.size>10*1024*1024&&e.warnings.push({code:c.LARGE_FILE,message:`Large file (${w(a.size)}) may process slowly`,severity:"warning"}),s.includes(a.type)||(e.valid=!1,e.errors.push({code:m.UNSUPPORTED_TYPE,message:`Unsupported file type: ${a.type}`,severity:"error"})),e.metadata={name:a.name,type:a.type,size:a.size,lastModified:a.lastModified},e):(e.valid=!1,e.errors.push({code:m.INVALID_FILE,message:"Not a valid File object",severity:"error"}),e)}function E(a,n={}){const{minWidth:i=1,minHeight:r=1,maxWidth:s=1e4,maxHeight:o=1e4,requireIntegers:l=!0,allowVariable:t=!0}=n,e={valid:!0,errors:[],warnings:[],dimensions:{...a},hasVariableDimensions:!1},{width:d,height:f}=a,u=p(d),g=p(f);return e.hasVariableDimensions=u.isVariable||g.isVariable,(u.isVariable||g.isVariable)&&!t?(e.valid=!1,e.errors.push({code:m.VARIABLE_DIMENSION_NOT_ALLOWED,message:"Variable dimensions are not allowed in this context",severity:"error",suggestion:"Provide fixed dimensions or enable allowVariable option"}),e):(u.isVariable||(typeof u.value!="number"||isNaN(u.value)?(e.valid=!1,e.errors.push({code:m.INVALID_DIMENSIONS,message:"Width must be a valid number",severity:"error"})):l&&!Number.isInteger(u.value)?e.warnings.push({code:c.SMALL_DIMENSIONS,message:"Width should be an integer for best results",severity:"warning"}):u.value<i?(e.valid=!1,e.errors.push({code:m.DIMENSIONS_TOO_SMALL,message:`Width too small (${u.value} < ${i})`,severity:"error"})):u.value>s?(e.valid=!1,e.errors.push({code:m.DIMENSIONS_TOO_LARGE,message:`Width too large (${u.value} > ${s})`,severity:"error"})):u.value<50&&e.warnings.push({code:c.SMALL_DIMENSIONS,message:`Small width (${u.value}px) may produce pixelated results`,severity:"warning"})),g.isVariable||(typeof g.value!="number"||isNaN(g.value)?(e.valid=!1,e.errors.push({code:m.INVALID_DIMENSIONS,message:"Height must be a valid number",severity:"error"})):l&&!Number.isInteger(g.value)?e.warnings.push({code:c.SMALL_DIMENSIONS,message:"Height should be an integer for best results",severity:"warning"}):g.value<r?(e.valid=!1,e.errors.push({code:m.DIMENSIONS_TOO_SMALL,message:`Height too small (${g.value} < ${r})`,severity:"error"})):g.value>o?(e.valid=!1,e.errors.push({code:m.DIMENSIONS_TOO_LARGE,message:`Height too large (${g.value} > ${o})`,severity:"error"})):g.value<50&&e.warnings.push({code:c.SMALL_DIMENSIONS,message:`Small height (${g.value}px) may produce pixelated results`,severity:"warning"})),!u.isVariable&&!g.isVariable&&u.value>0&&g.value>0?(e.dimensions.aspectRatio=u.value/g.value,e.dimensions.orientation=u.value>=g.value?"landscape":"portrait",(u.value>4e3||g.value>4e3)&&e.warnings.push({code:c.LARGE_DIMENSIONS,message:`Large dimensions (${u.value}x${g.value}) may cause performance issues`,severity:"warning"})):(u.isVariable||g.isVariable)&&(e.dimensions.hasVariable=!0,e.dimensions.variableType=u.isVariable?"width":"height",e.warnings.push({code:c.VARIABLE_DIMENSION_USED,message:`Using ${u.isVariable?"variable width":"variable height"} dimension`,severity:"info",suggestion:"One dimension will be calculated automatically"})),e)}function O(a,n,i="auto"){const r={valid:!0,errors:[],warnings:[],newDimensions:null},s=E(a);if(!s.valid)return s;const{width:o,height:l}=a,t=p(n);if(t.isVariable)return i==="width"&&t.type==="flex"?(r.newDimensions={width:"flex",height:l},r.warnings.push({code:c.FLEXIBLE_TEMPLATE,message:"Using flexible width - will maintain natural aspect ratio",severity:"info"}),r):i==="height"&&t.type==="flex"?(r.newDimensions={width:o,height:"flex"},r.warnings.push({code:c.FLEXIBLE_TEMPLATE,message:"Using flexible height - will maintain natural aspect ratio",severity:"info"}),r):(r.valid=!1,r.errors.push({code:m.INVALID_DIMENSIONS,message:`Invalid target dimension for mode ${i}: ${n}`,severity:"error"}),r);if(typeof t.value!="number"||t.value<=0)return r.valid=!1,r.errors.push({code:m.INVALID_DIMENSIONS,message:`Invalid target dimension: ${n}`,severity:"error"}),r;let e,d;i==="width"?(e=t.value,d=Math.round(l/o*t.value)):i==="height"?(d=t.value,e=Math.round(o/l*t.value)):o>=l?(e=t.value,d=Math.round(l/o*t.value)):(d=t.value,e=Math.round(o/l*t.value)),r.newDimensions={width:e,height:d};const f=E(r.newDimensions);if(!f.valid)return f;const u=e/o;u<.1&&r.warnings.push({code:c.POTENTIAL_PIXELATION,message:`Downscaling by ${((1-u)*100).toFixed(1)}% may cause pixelation`,severity:"warning",suggestion:"Consider using nearest-neighbor algorithm for pixel art"}),u>4&&r.warnings.push({code:c.POTENTIAL_PIXELATION,message:`Upscaling by ${((u-1)*100).toFixed(1)}% may reduce quality`,severity:"warning",suggestion:"Consider using AI upscaling tools for better results"});const g=o/l,h=e/d;return Math.abs(g-h)/g>.01&&r.warnings.push({code:c.ASPECT_CHANGE,message:`Aspect ratio changed from ${g.toFixed(3)} to ${h.toFixed(3)}`,severity:"info",suggestion:"Check if this deviation is acceptable"}),r}function y(a,n,i,r="center"){const s={valid:!0,errors:[],warnings:[],cropInfo:null},o=E(a);if(!o.valid)return o;const{width:l,height:t}=a,e=p(n),d=p(i);if(e.isVariable||d.isVariable){s.warnings.push({code:c.FLEXIBLE_TEMPLATE,message:"Using flexible dimensions for crop - will use maximum available space",severity:"info"});const C=e.isVariable?l:e.value,F=d.isVariable?t:d.value;return s.cropInfo={cropDimensions:{width:C,height:F},offsets:{x:0,y:0},position:"center",scale:1,hasFlexibleDimensions:!0,flexibleWidth:e.isVariable,flexibleHeight:d.isVariable},s}const f=E({width:e.value,height:d.value});if(!f.valid)return f;const u=Math.max(e.value/l,d.value/t),g=Math.round(l*u),h=Math.round(t*u);let v,I;switch(r){case"top":v=(g-e.value)/2,I=0;break;case"bottom":v=(g-e.value)/2,I=h-d.value;break;case"left":v=0,I=(h-d.value)/2;break;case"right":v=g-e.value,I=(h-d.value)/2;break;case"center":default:v=(g-e.value)/2,I=(h-d.value)/2}s.cropInfo={scaledDimensions:{width:g,height:h},cropDimensions:{width:e.value,height:d.value},offsets:{x:Math.max(0,Math.round(v)),y:Math.max(0,Math.round(I))},position:r,scale:u};const P=Math.max(0,(e.value-l)/l),x=Math.max(0,(d.value-t)/t),A=Math.max(P,x);A>.3&&s.warnings.push({code:c.CONTENT_LOSS,message:`Crop will remove ${(A*100).toFixed(1)}% of image content`,severity:"warning",suggestion:"Consider adjusting crop dimensions or position"});const S=l/t,b=e.value/d.value;return Math.abs(S-b)/S>.5&&s.warnings.push({code:c.ASPECT_CHANGE,message:`Source aspect ratio (${S.toFixed(2)}) differs significantly from target (${b.toFixed(2)})`,severity:"warning",suggestion:"This may result in stretched appearance"}),s}function T(a,n,i,r=!1){const s={valid:!0,errors:[],warnings:[],recommendations:[]};typeof i!="number"||i<1||i>100?(s.valid=!1,s.errors.push({code:m.QUALITY_OUT_OF_RANGE,message:`Quality must be between 1-100, got ${i}`,severity:"error"})):i>95?s.warnings.push({code:c.HIGH_QUALITY,message:`High quality setting (${i}%) provides minimal visual improvement`,severity:"info",suggestion:"Consider 80-85% for optimal balance"}):i<50&&s.warnings.push({code:c.LOW_QUALITY,message:`Low quality setting (${i}%) may cause noticeable artifacts`,severity:"warning",suggestion:"Consider 60%+ for acceptable quality"});const o={jpg:["jpeg","png","webp","gif","bmp","tiff","ico"],jpeg:["jpeg","png","webp","gif","bmp","tiff","ico"],png:["jpeg","png","webp","gif","bmp","tiff","svg","ico"],webp:["jpeg","png","webp","gif","bmp","tiff","svg","ico"],avif:["jpeg","png","webp","ico"],ico:["jpeg","png","webp","gif","bmp","ico"]},l=a.toLowerCase().replace("image/",""),t=n.toLowerCase();return t!=="original"&&!o[t]?.includes(l)&&(s.valid=!1,s.errors.push({code:m.INVALID_FORMAT,message:`Cannot convert ${l} to ${t}`,severity:"error"})),(t==="jpg"||t==="jpeg")&&r&&s.warnings.push({code:c.TRANSPARENCY_LOSS,message:"JPEG format does not support transparency",severity:"warning",suggestion:"Use PNG or WebP to preserve transparency"}),t==="webp"?i>90&&s.recommendations.push({type:"quality_adjustment",message:"WebP quality above 90 has diminishing returns",suggestion:"Use 80-85% for optimal size/quality balance"}):t==="jpg"||t==="jpeg"?s.recommendations.push({type:"format_suggestion",message:"Consider WebP for better compression with similar quality",suggestion:"WebP typically provides 25-35% smaller files than JPEG"}):t==="ico"&&s.recommendations.push({type:"format_suggestion",message:"ICO format is best for favicons and Windows icons",suggestion:"Include multiple sizes (16×16, 32×32, 48×48, 64×64) in single .ico file"}),s}function M(a){const n={valid:!0,errors:[],warnings:[],variables:[]};if(typeof a!="string"||a.trim()==="")return n.valid=!1,n.errors.push({code:m.INVALID_FORMAT,message:"Pattern cannot be empty",severity:"error"}),n;/[<>:"/\\|?*]/.test(a)&&(n.valid=!1,n.errors.push({code:m.INVALID_FORMAT,message:"Pattern contains invalid filename characters",severity:"error",details:'Remove <>:"/\\|?* from pattern'}));const r=/\{(\w+)\}/g;let s;const o=new Set;for(;(s=r.exec(a))!==null;)o.add(s[1]);n.variables=Array.from(o);const l=["name","index","date","time","year","month","day","hour","minute","second","timestamp","width","height","size","format","ext","orientation","aspect","total","padded"],t=n.variables.filter(e=>!l.includes(e));return t.length>0&&n.warnings.push({code:c.CONTENT_LOSS,message:`Unknown variables: ${t.join(", ")}`,severity:"warning",suggestion:"These variables will not be replaced"}),n}function D(a,n){const i={compatible:!0,errors:[],warnings:[],matchScore:0,recommendations:[]},r=p(a.width),s=p(a.height),o=p(n.width),l=p(n.height);if(r.isVariable||s.isVariable){i.warnings.push({code:c.FLEXIBLE_TEMPLATE,message:"Using flexible template - one dimension will adapt automatically",severity:"info"});let t=80;if(!o.isVariable&&!l.isVariable){if(r.isVariable&&!s.isVariable){const e=l.value/s.value;e>=.8?t+=20:(t*=e,i.warnings.push({code:c.SMALL_DIMENSIONS,message:`Image height (${l.value}px) is smaller than template height (${s.value}px)`,severity:"warning"}))}else if(!r.isVariable&&s.isVariable){const e=o.value/r.value;e>=.8?t+=20:(t*=e,i.warnings.push({code:c.SMALL_DIMENSIONS,message:`Image width (${o.value}px) is smaller than template width (${r.value}px)`,severity:"warning"}))}}return i.matchScore=t/100,i.compatible=!0,i}if(o.isVariable||l.isVariable)return i.compatible=!1,i.errors.push({code:m.INVALID_DIMENSIONS,message:"Cannot use variable image dimensions with fixed template",severity:"error"}),i;if(o.value<r.value||l.value<s.value){i.warnings.push({code:c.SMALL_DIMENSIONS,message:`Image dimensions (${o.value}x${l.value}) are smaller than template (${r.value}x${s.value})`,severity:"warning"});const t=o.value/r.value,e=l.value/s.value,d=Math.min(t,e);i.matchScore=d*.8}else{i.matchScore=.9;const t=o.value/l.value,e=r.value/s.value;Math.abs(t-e)/t>.1&&(i.warnings.push({code:c.ASPECT_CHANGE,message:`Aspect ratio differs (image: ${t.toFixed(2)}, template: ${e.toFixed(2)})`,severity:"warning",suggestion:"Consider cropping to match template aspect ratio"}),i.matchScore*=.8)}return i}function V(a){const n={total:a.length,valid:0,errors:0,warnings:0,errorDetails:[],warningDetails:[]};return a.forEach(i=>{i.valid&&n.valid++,n.errors+=i.errors.length,n.warnings+=i.warnings.length,i.errors.forEach(r=>{n.errorDetails.push({...r,source:i.metadata?.name||"Unknown"})}),i.warnings.forEach(r=>{n.warningDetails.push({...r,source:i.metadata?.name||"Unknown"})})}),n}function R(a){return a.filter(n=>{const i=p(n.width),r=p(n.height);return i.isVariable||r.isVariable})}const U={ValidationErrors:m,ValidationWarnings:c,isVariableDimension:L,parseDimension:p,validateOptimizationOptions:_,validateImage:N,validateDimensions:E,validateResize:O,validateCrop:y,validateOptimization:T,validateRenamePattern:M,validateTemplateCompatibility:D,getValidationSummary:V,getFlexibleTemplates:R};exports.ValidationErrors=m;exports.ValidationWarnings=c;exports.getFlexibleTemplates=R;exports.getValidationSummary=V;exports.isVariableDimension=L;exports.parseDimension=p;exports.validateCrop=y;exports.validateDimensions=E;exports.validateImage=N;exports.validateOptimization=T;exports.validateOptimizationOptions=_;exports.validateRenamePattern=M;exports.validateResize=O;exports.validateTemplateCompatibility=D;exports.validation=U;
//# sourceMappingURL=validation-DU-FiGJX.cjs.map
