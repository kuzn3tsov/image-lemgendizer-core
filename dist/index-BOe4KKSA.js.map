{"version":3,"file":"index-BOe4KKSA.js","sources":["../src/utils/imageUtils.js","../src/utils/validationUtils.js","../src/tasks/LemGendTask.js","../src/processors/LemGendaryResize.js","../src/processors/LemGendaryCrop.js","../src/processors/LemGendaryRename.js","../src/utils/processingUtils.js","../src/processors/LemGendaryOptimize.js","../src/templates/social.js","../src/templates/web.js","../src/templates/favicon.js","../src/templates/logo.js","../src/templates/index.js","../src/index.js"],"sourcesContent":["/**\r\n * Image utility functions\r\n * @module utils/imageUtils\r\n */\r\n\r\n/**\r\n * Get image dimensions from File\r\n * @param {File} file - Image file\r\n * @returns {Promise<Object>} Dimensions object\r\n */\r\nexport async function getImageDimensions(file) {\r\n    return new Promise((resolve, reject) => {\r\n        if (!file || !(file instanceof File)) {\r\n            reject(new Error('Invalid file provided'));\r\n            return;\r\n        }\r\n\r\n        // Special handling for favicons\r\n        if (file.type === 'image/x-icon' || file.type === 'image/vnd.microsoft.icon') {\r\n            getIcoDimensions(file)\r\n                .then(resolve)\r\n                .catch(() => resolve({ width: 32, height: 32, orientation: 'square', aspectRatio: 1 }));\r\n            return;\r\n        }\r\n\r\n        const img = new Image();\r\n        const objectUrl = URL.createObjectURL(file);\r\n\r\n        img.onload = () => {\r\n            const dimensions = {\r\n                width: img.naturalWidth || img.width,\r\n                height: img.naturalHeight || img.height,\r\n                orientation: img.naturalWidth >= img.naturalHeight ? 'landscape' : 'portrait',\r\n                aspectRatio: img.naturalWidth / img.naturalHeight\r\n            };\r\n\r\n            URL.revokeObjectURL(objectUrl);\r\n            resolve(dimensions);\r\n        };\r\n\r\n        img.onerror = () => {\r\n            URL.revokeObjectURL(objectUrl);\r\n\r\n            // For SVG files, try different approach\r\n            if (file.type === 'image/svg+xml') {\r\n                getSVGDimensions(file)\r\n                    .then(resolve)\r\n                    .catch(() => reject(new Error('Failed to load image dimensions')));\r\n            } else {\r\n                reject(new Error('Failed to load image'));\r\n            }\r\n        };\r\n\r\n        img.src = objectUrl;\r\n    });\r\n}\r\n\r\n/**\r\n * Get MIME type from file extension\r\n * @param {string} filename - Filename or extension\r\n * @returns {string} MIME type\r\n */\r\nexport function getMimeTypeFromExtension(filename) {\r\n    const extension = filename.toLowerCase().split('.').pop();\r\n\r\n    const mimeTypes = {\r\n        'jpg': 'image/jpeg',\r\n        'jpeg': 'image/jpeg',\r\n        'png': 'image/png',\r\n        'webp': 'image/webp',\r\n        'gif': 'image/gif',\r\n        'svg': 'image/svg+xml',\r\n        'bmp': 'image/bmp',\r\n        'ico': 'image/x-icon',\r\n        'tiff': 'image/tiff',\r\n        'tif': 'image/tiff',\r\n        'avif': 'image/avif',\r\n        'pdf': 'application/pdf',\r\n        'txt': 'text/plain',\r\n        'csv': 'text/csv',\r\n        'json': 'application/json',\r\n        'xml': 'application/xml',\r\n        'zip': 'application/zip',\r\n        'rar': 'application/vnd.rar',\r\n        '7z': 'application/x-7z-compressed',\r\n        '': 'application/octet-stream'\r\n    };\r\n\r\n    return mimeTypes[extension] || 'application/octet-stream';\r\n}\r\n\r\n/**\r\n * Get SVG dimensions\r\n * @private\r\n */\r\nasync function getSVGDimensions(file) {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = (e) => {\r\n            try {\r\n                const svgText = e.target.result;\r\n                const parser = new DOMParser();\r\n                const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');\r\n                const svgElement = svgDoc.documentElement;\r\n\r\n                // Check for parsing errors\r\n                if (svgDoc.querySelector('parsererror')) {\r\n                    reject(new Error('Invalid SVG format'));\r\n                    return;\r\n                }\r\n\r\n                // Get dimensions\r\n                const width = parseFloat(svgElement.getAttribute('width')) ||\r\n                    svgElement.viewBox?.baseVal?.width || 100;\r\n                const height = parseFloat(svgElement.getAttribute('height')) ||\r\n                    svgElement.viewBox?.baseVal?.height || 100;\r\n\r\n                resolve({\r\n                    width,\r\n                    height,\r\n                    orientation: width >= height ? 'landscape' : 'portrait',\r\n                    aspectRatio: width / height\r\n                });\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        };\r\n\r\n        reader.onerror = reject;\r\n        reader.readAsText(file);\r\n    });\r\n}\r\n\r\n/**\r\n * Get ICO file dimensions (simplified)\r\n * @private\r\n */\r\nasync function getIcoDimensions(file) {\r\n    return new Promise((resolve) => {\r\n        // ICO files can contain multiple sizes, return default for favicons\r\n        resolve({\r\n            width: 32,\r\n            height: 32,\r\n            orientation: 'square',\r\n            aspectRatio: 1\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Check if image has transparency\r\n * @param {File} file - Image file\r\n * @returns {Promise<boolean>} True if image has transparency\r\n */\r\nexport async function hasTransparency(file) {\r\n    if (!file || (file.type !== 'image/png' && file.type !== 'image/webp')) {\r\n        return false; // Only PNG and WebP have meaningful transparency for our purposes\r\n    }\r\n\r\n    return new Promise((resolve) => {\r\n        const img = new Image();\r\n        const objectUrl = URL.createObjectURL(file);\r\n\r\n        img.onload = () => {\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = img.width;\r\n            canvas.height = img.height;\r\n            const ctx = canvas.getContext('2d');\r\n            ctx.drawImage(img, 0, 0);\r\n\r\n            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n            const data = imageData.data;\r\n\r\n            // Check alpha channel\r\n            for (let i = 3; i < data.length; i += 4) {\r\n                if (data[i] < 255) {\r\n                    URL.revokeObjectURL(objectUrl);\r\n                    resolve(true);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            URL.revokeObjectURL(objectUrl);\r\n            resolve(false);\r\n        };\r\n\r\n        img.onerror = () => {\r\n            URL.revokeObjectURL(objectUrl);\r\n            resolve(false);\r\n        };\r\n\r\n        img.src = objectUrl;\r\n    });\r\n}\r\n\r\n/**\r\n * Convert File to Data URL\r\n * @param {File} file - File to convert\r\n * @returns {Promise<string>} Data URL\r\n */\r\nexport function fileToDataURL(file) {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.onload = () => resolve(reader.result);\r\n        reader.onerror = reject;\r\n        reader.readAsDataURL(file);\r\n    });\r\n}\r\n\r\n/**\r\n * Convert Data URL to File\r\n * @param {string} dataURL - Data URL\r\n * @param {string} filename - Output filename\r\n * @returns {Promise<File>} File object\r\n */\r\nexport function dataURLtoFile(dataURL, filename) {\r\n    return new Promise((resolve, reject) => {\r\n        try {\r\n            const arr = dataURL.split(',');\r\n            const mime = arr[0].match(/:(.*?);/)[1];\r\n            const bstr = atob(arr[1]);\r\n            let n = bstr.length;\r\n            const u8arr = new Uint8Array(n);\r\n\r\n            while (n--) {\r\n                u8arr[n] = bstr.charCodeAt(n);\r\n            }\r\n\r\n            resolve(new File([u8arr], filename, { type: mime }));\r\n        } catch (error) {\r\n            reject(error);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Resize image using canvas\r\n * @param {File} file - Image file\r\n * @param {number} width - Target width\r\n * @param {number} height - Target height\r\n * @param {string} format - Output format\r\n * @param {number} quality - Quality (0-1)\r\n * @returns {Promise<File>} Resized image file\r\n */\r\nexport async function resizeImage(file, width, height, format = 'webp', quality = 0.8) {\r\n    return new Promise((resolve, reject) => {\r\n        // Special handling for favicon format\r\n        if (format.toLowerCase() === 'ico') {\r\n            // Create PNG first, then convert to ICO (simplified approach)\r\n            resizeImage(file, width, height, 'png', quality)\r\n                .then(pngFile => {\r\n                    // For now, return PNG and warn about ICO limitation\r\n                    console.warn('ICO format creation limited in browser. Using PNG instead.');\r\n                    resolve(pngFile);\r\n                })\r\n                .catch(reject);\r\n            return;\r\n        }\r\n\r\n        const img = new Image();\r\n        const objectUrl = URL.createObjectURL(file);\r\n\r\n        img.onload = () => {\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            const ctx = canvas.getContext('2d');\r\n\r\n            // Fill background for JPEG\r\n            if (format === 'jpg' || format === 'jpeg') {\r\n                ctx.fillStyle = '#ffffff';\r\n                ctx.fillRect(0, 0, width, height);\r\n            }\r\n\r\n            ctx.drawImage(img, 0, 0, width, height);\r\n\r\n            // Determine MIME type\r\n            let mimeType;\r\n            switch (format.toLowerCase()) {\r\n                case 'jpg':\r\n                case 'jpeg':\r\n                    mimeType = 'image/jpeg';\r\n                    break;\r\n                case 'png':\r\n                    mimeType = 'image/png';\r\n                    break;\r\n                case 'webp':\r\n                    mimeType = 'image/webp';\r\n                    break;\r\n                case 'avif':\r\n                    mimeType = 'image/avif';\r\n                    break;\r\n                case 'svg':\r\n                    mimeType = 'image/svg+xml';\r\n                    break;\r\n                default:\r\n                    mimeType = 'image/webp';\r\n            }\r\n\r\n            canvas.toBlob(\r\n                (blob) => {\r\n                    URL.revokeObjectURL(objectUrl);\r\n\r\n                    if (!blob) {\r\n                        reject(new Error('Failed to create blob'));\r\n                        return;\r\n                    }\r\n\r\n                    const extension = format.toLowerCase();\r\n                    const originalName = file.name.replace(/\\.[^/.]+$/, '');\r\n                    const newName = `${originalName}-${width}x${height}.${extension}`;\r\n\r\n                    resolve(new File([blob], newName, { type: mimeType }));\r\n                },\r\n                mimeType,\r\n                quality\r\n            );\r\n        };\r\n\r\n        img.onerror = () => {\r\n            URL.revokeObjectURL(objectUrl);\r\n            reject(new Error('Failed to load image'));\r\n        };\r\n\r\n        img.src = objectUrl;\r\n    });\r\n}\r\n\r\n/**\r\n * Crop image using canvas\r\n * @param {File} file - Image file\r\n * @param {number} x - X offset\r\n * @param {number} y - Y offset\r\n * @param {number} width - Crop width\r\n * @param {number} height - Crop height\r\n * @param {string} format - Output format\r\n * @param {number} quality - Quality (0-1)\r\n * @returns {Promise<File>} Cropped image file\r\n */\r\nexport async function cropImage(file, x, y, width, height, format = 'webp', quality = 0.8) {\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image();\r\n        const objectUrl = URL.createObjectURL(file);\r\n\r\n        img.onload = () => {\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            const ctx = canvas.getContext('2d');\r\n\r\n            // Fill background for JPEG\r\n            if (format === 'jpg' || format === 'jpeg') {\r\n                ctx.fillStyle = '#ffffff';\r\n                ctx.fillRect(0, 0, width, height);\r\n            }\r\n\r\n            ctx.drawImage(img, x, y, width, height, 0, 0, width, height);\r\n\r\n            // Determine MIME type\r\n            let mimeType;\r\n            switch (format.toLowerCase()) {\r\n                case 'jpg':\r\n                case 'jpeg':\r\n                    mimeType = 'image/jpeg';\r\n                    break;\r\n                case 'png':\r\n                    mimeType = 'image/png';\r\n                    break;\r\n                case 'webp':\r\n                    mimeType = 'image/webp';\r\n                    break;\r\n                default:\r\n                    mimeType = 'image/webp';\r\n            }\r\n\r\n            canvas.toBlob(\r\n                (blob) => {\r\n                    URL.revokeObjectURL(objectUrl);\r\n\r\n                    if (!blob) {\r\n                        reject(new Error('Failed to create blob'));\r\n                        return;\r\n                    }\r\n\r\n                    const extension = format.toLowerCase();\r\n                    const originalName = file.name.replace(/\\.[^/.]+$/, '');\r\n                    const newName = `${originalName}-crop-${width}x${height}.${extension}`;\r\n\r\n                    resolve(new File([blob], newName, { type: mimeType }));\r\n                },\r\n                mimeType,\r\n                quality\r\n            );\r\n        };\r\n\r\n        img.onerror = () => {\r\n            URL.revokeObjectURL(objectUrl);\r\n            reject(new Error('Failed to load image'));\r\n        };\r\n\r\n        img.src = objectUrl;\r\n    });\r\n}\r\n\r\n/**\r\n * Calculate new dimensions maintaining aspect ratio\r\n * @param {number} originalWidth - Original width\r\n * @param {number} originalHeight - Original height\r\n * @param {number} targetSize - Target size (width or height)\r\n * @param {string} mode - 'width', 'height', or 'auto'\r\n * @returns {Object} New dimensions\r\n */\r\nexport function calculateAspectRatioFit(originalWidth, originalHeight, targetSize, mode = 'auto') {\r\n    if (mode === 'width') {\r\n        const newWidth = targetSize;\r\n        const newHeight = Math.round((originalHeight / originalWidth) * targetSize);\r\n        return { width: newWidth, height: newHeight };\r\n    } else if (mode === 'height') {\r\n        const newHeight = targetSize;\r\n        const newWidth = Math.round((originalWidth / originalHeight) * targetSize);\r\n        return { width: newWidth, height: newHeight };\r\n    } else {\r\n        // Auto mode: portrait uses height, landscape uses width\r\n        if (originalWidth >= originalHeight) {\r\n            const newWidth = targetSize;\r\n            const newHeight = Math.round((originalHeight / originalWidth) * targetSize);\r\n            return { width: newWidth, height: newHeight };\r\n        } else {\r\n            const newHeight = targetSize;\r\n            const newWidth = Math.round((originalWidth / originalHeight) * targetSize);\r\n            return { width: newWidth, height: newHeight };\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Format file size for display\r\n * @param {number} bytes - File size in bytes\r\n * @param {number} decimals - Decimal places\r\n * @returns {string} Formatted size\r\n */\r\nexport function formatFileSize(bytes, decimals = 2) {\r\n    if (bytes === 0) return '0 Bytes';\r\n\r\n    const k = 1024;\r\n    const dm = decimals < 0 ? 0 : decimals;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\r\n\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\r\n}\r\n\r\n/**\r\n * Get file extension from filename or MIME type\r\n * @param {File|string} fileOrName - File object or filename\r\n * @returns {string} File extension\r\n */\r\nexport function getFileExtension(fileOrName) {\r\n    if (fileOrName instanceof File) {\r\n        // Try from name first\r\n        const nameExt = fileOrName.name.split('.').pop().toLowerCase();\r\n        if (nameExt && nameExt.length <= 4) {\r\n            return nameExt;\r\n        }\r\n\r\n        // Fall back to MIME type\r\n        const mimeExt = {\r\n            'image/jpeg': 'jpg',\r\n            'image/jpg': 'jpg',\r\n            'image/png': 'png',\r\n            'image/webp': 'webp',\r\n            'image/gif': 'gif',\r\n            'image/svg+xml': 'svg',\r\n            'image/bmp': 'bmp',\r\n            'image/tiff': 'tiff',\r\n            'image/avif': 'avif',\r\n            'image/x-icon': 'ico',\r\n            'image/vnd.microsoft.icon': 'ico'\r\n        }[fileOrName.type];\r\n\r\n        return mimeExt || 'unknown';\r\n    }\r\n\r\n    // String input\r\n    const name = typeof fileOrName === 'string' ? fileOrName : '';\r\n    const ext = name.split('.').pop().toLowerCase();\r\n    return ext && ext.length <= 4 ? ext : 'unknown';\r\n}\r\n\r\n/**\r\n * Validate image file\r\n * @param {File} file - File to validate\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateImageFile(file) {\r\n    const errors = [];\r\n    const warnings = [];\r\n\r\n    // Check if it's a File object\r\n    if (!(file instanceof File)) {\r\n        errors.push('Not a valid File object');\r\n        return { valid: false, errors, warnings };\r\n    }\r\n\r\n    // Check file type\r\n    const validTypes = [\r\n        'image/jpeg',\r\n        'image/jpg',\r\n        'image/png',\r\n        'image/webp',\r\n        'image/gif',\r\n        'image/svg+xml',\r\n        'image/bmp',\r\n        'image/tiff',\r\n        'image/avif',\r\n        'image/x-icon',\r\n        'image/vnd.microsoft.icon'\r\n    ];\r\n\r\n    if (!validTypes.includes(file.type)) {\r\n        errors.push(`Unsupported file type: ${file.type}`);\r\n    }\r\n\r\n    // Check file size\r\n    const maxSize = 50 * 1024 * 1024; // 50MB\r\n    if (file.size > maxSize) {\r\n        errors.push(`File too large: ${formatFileSize(file.size)} (max: ${formatFileSize(maxSize)})`);\r\n    } else if (file.size > 10 * 1024 * 1024) { // 10MB\r\n        warnings.push(`Large file: ${formatFileSize(file.size)} - processing may be slow`);\r\n    }\r\n\r\n    // Check filename\r\n    const invalidChars = /[<>:\"/\\\\|?*]/;\r\n    if (invalidChars.test(file.name)) {\r\n        warnings.push('Filename contains invalid characters');\r\n    }\r\n\r\n    return {\r\n        valid: errors.length === 0,\r\n        errors,\r\n        warnings\r\n    };\r\n}\r\n\r\n/**\r\n * Create image thumbnail\r\n * @param {File|Object} imageOrFile - Image file or object with file property\r\n * @param {number} maxSize - Maximum thumbnail dimension\r\n * @returns {Promise<string>} Thumbnail as Data URL\r\n */\r\nexport async function createThumbnail(imageOrFile, maxSize = 200) {\r\n    let file;\r\n\r\n    // Handle both File and object with file property\r\n    if (imageOrFile instanceof File) {\r\n        file = imageOrFile;\r\n    } else if (imageOrFile && imageOrFile.file instanceof File) {\r\n        // Assuming it's a LemGendImage or similar object\r\n        file = imageOrFile.file;\r\n    } else {\r\n        throw new Error('Invalid input: must be File or object with file property');\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n        // Special handling for favicons\r\n        if (file.type === 'image/x-icon' || file.type === 'image/vnd.microsoft.icon') {\r\n            // Use a default favicon icon as thumbnail\r\n            resolve('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzM4ODJlZiIvPjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iNjAiIGZpbGw9IiNmZmYiLz48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjQwIiBmaWxsPSIjMzg4MmVmIi8+PC9zdmc+');\r\n            return;\r\n        }\r\n\r\n        // Special handling for SVG\r\n        if (file.type === 'image/svg+xml') {\r\n            // For SVG, return as-is\r\n            const reader = new FileReader();\r\n            reader.onload = () => resolve(reader.result);\r\n            reader.onerror = reject;\r\n            reader.readAsDataURL(file);\r\n            return;\r\n        }\r\n\r\n        const img = new Image();\r\n        const objectUrl = URL.createObjectURL(file);\r\n\r\n        img.onload = () => {\r\n            // Calculate thumbnail dimensions\r\n            let width, height;\r\n            if (img.width > img.height) {\r\n                width = maxSize;\r\n                height = Math.round((img.height / img.width) * maxSize);\r\n            } else {\r\n                height = maxSize;\r\n                width = Math.round((img.width / img.height) * maxSize);\r\n            }\r\n\r\n            // Create canvas for thumbnail\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            const ctx = canvas.getContext('2d');\r\n\r\n            // Draw image\r\n            ctx.drawImage(img, 0, 0, width, height);\r\n\r\n            // Convert to Data URL\r\n            const thumbnail = canvas.toDataURL('image/jpeg', 0.7);\r\n\r\n            // Clean up\r\n            URL.revokeObjectURL(objectUrl);\r\n            resolve(thumbnail);\r\n        };\r\n\r\n        img.onerror = () => {\r\n            URL.revokeObjectURL(objectUrl);\r\n            reject(new Error('Failed to create thumbnail'));\r\n        };\r\n\r\n        img.src = objectUrl;\r\n    });\r\n}\r\n\r\n/**\r\n * Batch process images with progress tracking\r\n * @param {Array<File>} files - Image files\r\n * @param {Function} processor - Processing function\r\n * @param {Function} onProgress - Progress callback\r\n * @returns {Promise<Array>} Processed results\r\n */\r\nexport async function batchProcess(files, processor, onProgress) {\r\n    const results = [];\r\n    const total = files.length;\r\n\r\n    for (let i = 0; i < files.length; i++) {\r\n        try {\r\n            const result = await processor(files[i], i);\r\n            results.push(result);\r\n\r\n            if (onProgress) {\r\n                onProgress((i + 1) / total, i + 1, total);\r\n            }\r\n        } catch (error) {\r\n            console.error(`Error processing file ${i + 1}:`, error);\r\n            results.push({ error: error.message, file: files[i] });\r\n        }\r\n    }\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Analyze image for optimization potential\r\n * @param {File} file - Image file\r\n * @returns {Promise<Object>} Optimization analysis\r\n */\r\nexport async function analyzeForOptimization(file) {\r\n    const dimensions = await getImageDimensions(file);\r\n    const transparency = await hasTransparency(file);\r\n\r\n    const analysis = {\r\n        dimensions,\r\n        transparency,\r\n        fileSize: file.size,\r\n        mimeType: file.type,\r\n        extension: getFileExtension(file),\r\n        optimizationScore: 0,\r\n        recommendations: []\r\n    };\r\n\r\n    // Calculate optimization score (0-100)\r\n    let score = 0;\r\n\r\n    // Size-based scoring\r\n    if (file.size > 5 * 1024 * 1024) {\r\n        score += 40; // Large files have high optimization potential\r\n        analysis.recommendations.push('File is very large - high optimization potential');\r\n    } else if (file.size > 1 * 1024 * 1024) {\r\n        score += 20;\r\n    } else if (file.size > 100 * 1024) {\r\n        score += 10;\r\n    }\r\n\r\n    // Dimension-based scoring\r\n    const megapixels = (dimensions.width * dimensions.height) / 1000000;\r\n    if (megapixels > 16) {\r\n        score += 30;\r\n        analysis.recommendations.push('Very high resolution - consider resizing');\r\n    } else if (megapixels > 4) {\r\n        score += 15;\r\n    }\r\n\r\n    // Format-based scoring\r\n    const modernFormats = ['webp', 'avif', 'svg'];\r\n    const currentFormat = getFileExtension(file);\r\n    if (!modernFormats.includes(currentFormat)) {\r\n        score += 20;\r\n        analysis.recommendations.push(`Consider converting from ${currentFormat} to modern format`);\r\n    }\r\n\r\n    // Transparency consideration\r\n    if (transparency && currentFormat === 'jpg') {\r\n        score += 10;\r\n        analysis.recommendations.push('JPEG with transparency - convert to PNG or WebP');\r\n    }\r\n\r\n    analysis.optimizationScore = Math.min(100, score);\r\n    analysis.optimizationLevel = score > 50 ? 'high' : score > 25 ? 'medium' : 'low';\r\n\r\n    return analysis;\r\n}\r\n\r\n/**\r\n * Get optimization presets for common use cases\r\n * @param {string} useCase - Use case identifier\r\n * @returns {Object} Optimization preset\r\n */\r\nexport function getOptimizationPreset(useCase) {\r\n    const presets = {\r\n        'web-high': {\r\n            quality: 85,\r\n            format: 'auto',\r\n            maxDisplayWidth: 1920,\r\n            compressionMode: 'balanced',\r\n            stripMetadata: true,\r\n            description: 'High quality web images'\r\n        },\r\n        'web-balanced': {\r\n            quality: 80,\r\n            format: 'auto',\r\n            maxDisplayWidth: 1200,\r\n            compressionMode: 'adaptive',\r\n            stripMetadata: true,\r\n            description: 'Balanced web images'\r\n        },\r\n        'web-aggressive': {\r\n            quality: 70,\r\n            format: 'webp',\r\n            maxDisplayWidth: 800,\r\n            compressionMode: 'aggressive',\r\n            stripMetadata: true,\r\n            description: 'Aggressive web optimization'\r\n        },\r\n        'social-media': {\r\n            quality: 90,\r\n            format: 'jpg',\r\n            maxDisplayWidth: 1080,\r\n            compressionMode: 'balanced',\r\n            stripMetadata: false, // Keep metadata for social\r\n            description: 'Social media images'\r\n        },\r\n        'ecommerce': {\r\n            quality: 92,\r\n            format: 'webp',\r\n            maxDisplayWidth: 1200,\r\n            compressionMode: 'balanced',\r\n            stripMetadata: true,\r\n            preserveTransparency: true,\r\n            description: 'E-commerce product images'\r\n        },\r\n        'favicon': {\r\n            quality: 100,\r\n            format: 'ico',\r\n            compressionMode: 'balanced',\r\n            icoSizes: [16, 32, 48, 64],\r\n            description: 'Favicon generation'\r\n        },\r\n        'print-ready': {\r\n            quality: 100,\r\n            format: 'png',\r\n            compressionMode: 'balanced',\r\n            lossless: true,\r\n            stripMetadata: false,\r\n            description: 'Print-ready images'\r\n        },\r\n        'mobile-optimized': {\r\n            quality: 75,\r\n            format: 'webp',\r\n            maxDisplayWidth: 800,\r\n            compressionMode: 'aggressive',\r\n            stripMetadata: true,\r\n            description: 'Mobile-optimized images'\r\n        }\r\n    };\r\n\r\n    return presets[useCase] || presets['web-balanced'];\r\n}\r\n\r\n/**\r\n * Calculate estimated optimization savings\r\n * @param {number} originalSize - Original file size in bytes\r\n * @param {Object} optimizationSettings - Optimization settings\r\n * @returns {Object} Estimated savings\r\n */\r\nexport function calculateOptimizationSavings(originalSize, optimizationSettings) {\r\n    const { format, quality, maxDisplayWidth } = optimizationSettings;\r\n\r\n    let estimatedSize = originalSize;\r\n    let reductionFactors = [];\r\n\r\n    // Format reduction\r\n    switch (format) {\r\n        case 'webp':\r\n            estimatedSize *= 0.7;\r\n            reductionFactors.push('WebP format: 30% reduction');\r\n            break;\r\n        case 'avif':\r\n            estimatedSize *= 0.6;\r\n            reductionFactors.push('AVIF format: 40% reduction');\r\n            break;\r\n        case 'jpg':\r\n            estimatedSize *= 0.8;\r\n            reductionFactors.push('JPEG format: 20% reduction');\r\n            break;\r\n        case 'png':\r\n            estimatedSize *= 0.9;\r\n            reductionFactors.push('PNG format: 10% reduction');\r\n            break;\r\n        case 'svg':\r\n            estimatedSize *= 0.3;\r\n            reductionFactors.push('SVG format: 70% reduction');\r\n            break;\r\n        default:\r\n            estimatedSize *= 0.75;\r\n            reductionFactors.push('Auto format selection: ~25% reduction');\r\n    }\r\n\r\n    // Quality reduction\r\n    const qualityFactor = quality / 100;\r\n    estimatedSize *= qualityFactor;\r\n    reductionFactors.push(`Quality ${quality}%: ${Math.round((1 - qualityFactor) * 100)}% reduction`);\r\n\r\n    // Display width reduction (if specified)\r\n    if (maxDisplayWidth) {\r\n        // Assume typical reduction for web display\r\n        estimatedSize *= 0.85;\r\n        reductionFactors.push(`Max width ${maxDisplayWidth}px: ~15% reduction`);\r\n    }\r\n\r\n    const savings = originalSize - estimatedSize;\r\n    const savingsPercent = (savings / originalSize) * 100;\r\n\r\n    return {\r\n        originalSize,\r\n        estimatedSize: Math.round(estimatedSize),\r\n        savings: Math.round(savings),\r\n        savingsPercent: Math.round(savingsPercent * 10) / 10,\r\n        reductionFactors,\r\n        readable: {\r\n            original: formatFileSize(originalSize),\r\n            estimated: formatFileSize(Math.round(estimatedSize)),\r\n            savings: formatFileSize(Math.round(savings)),\r\n            savingsPercent: `${Math.round(savingsPercent * 10) / 10}%`\r\n        }\r\n    };\r\n}\r\n\r\n/**\r\n * Create optimization preview\r\n * @param {File} file - Image file\r\n * @param {Object} optimizationSettings - Optimization settings\r\n * @returns {Promise<string>} Data URL of optimized preview\r\n */\r\nexport async function createOptimizationPreview(file, optimizationSettings) {\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image();\r\n\r\n        img.onload = () => {\r\n            try {\r\n                const canvas = document.createElement('canvas');\r\n                const ctx = canvas.getContext('2d');\r\n\r\n                // Calculate preview dimensions (max 400px for preview)\r\n                const maxPreviewSize = 400;\r\n                let width = img.width;\r\n                let height = img.height;\r\n\r\n                if (width > maxPreviewSize || height > maxPreviewSize) {\r\n                    if (width >= height) {\r\n                        width = maxPreviewSize;\r\n                        height = Math.round((img.height / img.width) * maxPreviewSize);\r\n                    } else {\r\n                        height = maxPreviewSize;\r\n                        width = Math.round((img.width / img.height) * maxPreviewSize);\r\n                    }\r\n                }\r\n\r\n                canvas.width = width;\r\n                canvas.height = height;\r\n\r\n                // Draw image\r\n                ctx.drawImage(img, 0, 0, width, height);\r\n\r\n                // Create preview with reduced quality\r\n                const previewQuality = Math.min(0.7, optimizationSettings.quality / 100 * 0.8);\r\n                const previewDataURL = canvas.toDataURL('image/jpeg', previewQuality);\r\n\r\n                resolve(previewDataURL);\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        };\r\n\r\n        img.onerror = reject;\r\n        img.src = URL.createObjectURL(file);\r\n    });\r\n}\r\n\r\n/**\r\n * Generate optimization comparison\r\n * @param {File} originalFile - Original image file\r\n * @param {File} optimizedFile - Optimized image file\r\n * @returns {Promise<Object>} Comparison data\r\n */\r\nexport async function generateOptimizationComparison(originalFile, optimizedFile) {\r\n    const originalSize = originalFile.size;\r\n    const optimizedSize = optimizedFile.size;\r\n    const savings = originalSize - optimizedSize;\r\n    const savingsPercent = (savings / originalSize) * 100;\r\n\r\n    // Get thumbnails for visual comparison\r\n    const originalThumbnail = await createThumbnail(originalFile, 300);\r\n    const optimizedThumbnail = await createThumbnail(optimizedFile, 300);\r\n\r\n    return {\r\n        original: {\r\n            size: originalSize,\r\n            sizeFormatted: formatFileSize(originalSize),\r\n            thumbnail: originalThumbnail\r\n        },\r\n        optimized: {\r\n            size: optimizedSize,\r\n            sizeFormatted: formatFileSize(optimizedSize),\r\n            thumbnail: optimizedThumbnail\r\n        },\r\n        savings: {\r\n            bytes: savings,\r\n            percent: Math.round(savingsPercent * 10) / 10,\r\n            formatted: formatFileSize(savings),\r\n            compressionRatio: (originalSize / optimizedSize).toFixed(2)\r\n        },\r\n        comparison: savingsPercent > 0 ?\r\n            `Saved ${formatFileSize(savings)} (${Math.round(savingsPercent)}%)` :\r\n            'No savings achieved'\r\n    };\r\n}\r\n\r\n/**\r\n * Check if image format needs conversion for web\r\n * @param {File} file - Image file\r\n * @returns {boolean} True if format conversion recommended\r\n */\r\nexport function needsFormatConversion(file) {\r\n    const extension = getFileExtension(file);\r\n    const modernFormats = ['webp', 'avif', 'svg'];\r\n    return !modernFormats.includes(extension);\r\n}\r\n\r\n/**\r\n * Get recommended format for web\r\n * @param {File} file - Image file\r\n * @returns {string} Recommended format\r\n */\r\nexport function getRecommendedFormat(file) {\r\n    const extension = getFileExtension(file);\r\n\r\n    if (extension === 'svg') return 'svg';\r\n    if (extension === 'ico') return 'ico';\r\n\r\n    // Check if image has transparency\r\n    if (file.type === 'image/png' || file.type === 'image/webp') {\r\n        return 'webp'; // WebP supports transparency\r\n    }\r\n\r\n    // For large images, recommend AVIF\r\n    if (file.size > 2 * 1024 * 1024) {\r\n        return 'avif';\r\n    }\r\n\r\n    return 'webp'; // Default to WebP for good balance\r\n}\r\n\r\n/**\r\n * Get optimization quick stats\r\n * @param {File} file - Image file\r\n * @returns {Promise<Object>} Quick optimization stats\r\n */\r\nexport async function getOptimizationStats(file) {\r\n    const analysis = await analyzeForOptimization(file);\r\n    const recommendedFormat = getRecommendedFormat(file);\r\n    const savings = calculateOptimizationSavings(file.size, {\r\n        format: recommendedFormat,\r\n        quality: 85,\r\n        maxDisplayWidth: 1920\r\n    });\r\n\r\n    return {\r\n        analysis,\r\n        recommendedFormat,\r\n        estimatedSavings: savings,\r\n        needsOptimization: analysis.optimizationScore > 30,\r\n        priority: analysis.optimizationLevel\r\n    };\r\n}\r\n\r\n/**\r\n * Get format priorities for intelligent optimization selection\r\n * @param {Array<string>} browserSupport - Browser support requirements\r\n * @returns {Object} Format priority data\r\n */\r\nexport function getFormatPriorities(browserSupport = ['modern', 'legacy']) {\r\n    const formats = {\r\n        'avif': {\r\n            quality: 0.9,\r\n            browserSupport: browserSupport.includes('modern') ? 0.9 : 0.7,\r\n            compression: 0.8,\r\n            supportsTransparency: true,\r\n            maxQuality: 63 // AVIF has different quality scale\r\n        },\r\n        'webp': {\r\n            quality: 0.8,\r\n            browserSupport: browserSupport.includes('legacy') ? 0.9 : 0.98,\r\n            compression: 0.7,\r\n            supportsTransparency: true,\r\n            maxQuality: 100\r\n        },\r\n        'jpg': {\r\n            quality: 0.7,\r\n            browserSupport: 1.0,\r\n            compression: 0.6,\r\n            supportsTransparency: false,\r\n            maxQuality: 100\r\n        },\r\n        'png': {\r\n            quality: 0.9,\r\n            browserSupport: 1.0,\r\n            compression: 0.5,\r\n            supportsTransparency: true,\r\n            maxQuality: 100\r\n        },\r\n        'ico': {\r\n            quality: 1.0,\r\n            browserSupport: 1.0,\r\n            compression: 0.5,\r\n            supportsTransparency: true,\r\n            maxQuality: 100\r\n        }\r\n    };\r\n\r\n    return formats;\r\n}\r\n\r\n/**\r\n * Check AI capabilities for smart cropping\r\n * @returns {Promise<Object>} AI capability report\r\n */\r\nexport async function checkAICapabilities() {\r\n    const capabilities = {\r\n        faceDetection: false,\r\n        objectDetection: false,\r\n        saliencyDetection: false,\r\n        entropyDetection: false,\r\n        canvasAvailable: false,\r\n        workerAvailable: typeof Worker !== 'undefined',\r\n        tensorFlowAvailable: typeof tf !== 'undefined',\r\n        faceDetectorAvailable: typeof FaceDetector !== 'undefined'\r\n    };\r\n\r\n    try {\r\n        // Check canvas API\r\n        const canvas = document.createElement('canvas');\r\n        capabilities.canvasAvailable = !!(canvas.getContext && canvas.getContext('2d'));\r\n\r\n        // Check Face Detection API\r\n        if (typeof FaceDetector === 'function') {\r\n            try {\r\n                const faceDetector = new FaceDetector();\r\n                capabilities.faceDetection = true;\r\n            } catch (e) {\r\n                console.warn('FaceDetector API available but failed to initialize:', e.message);\r\n            }\r\n        }\r\n\r\n        // Check TensorFlow.js\r\n        if (typeof tf !== 'undefined') {\r\n            capabilities.tensorFlowAvailable = true;\r\n            capabilities.objectDetection = true;\r\n            capabilities.saliencyDetection = true;\r\n            capabilities.entropyDetection = true;\r\n        }\r\n\r\n        // Check for offscreen canvas for workers\r\n        if (typeof OffscreenCanvas !== 'undefined') {\r\n            capabilities.offscreenCanvas = true;\r\n        }\r\n\r\n    } catch (error) {\r\n        console.warn('Error checking AI capabilities:', error.message);\r\n    }\r\n\r\n    // Generate capability summary\r\n    capabilities.summary = generateAISummary(capabilities);\r\n    capabilities.hasAnyAI = capabilities.faceDetection || capabilities.objectDetection ||\r\n        capabilities.saliencyDetection || capabilities.entropyDetection;\r\n\r\n    return capabilities;\r\n}\r\n\r\n/**\r\n * Generate AI capability summary\r\n * @private\r\n */\r\nfunction generateAISummary(capabilities) {\r\n    const availableFeatures = [];\r\n    const unavailableFeatures = [];\r\n\r\n    if (capabilities.faceDetection) availableFeatures.push('Face Detection');\r\n    else unavailableFeatures.push('Face Detection (requires FaceDetector API)');\r\n\r\n    if (capabilities.objectDetection) availableFeatures.push('Object Detection');\r\n    else unavailableFeatures.push('Object Detection (requires TensorFlow.js)');\r\n\r\n    if (capabilities.saliencyDetection) availableFeatures.push('Saliency Detection');\r\n    else unavailableFeatures.push('Saliency Detection (requires TensorFlow.js)');\r\n\r\n    if (capabilities.entropyDetection) availableFeatures.push('Entropy Analysis');\r\n    else unavailableFeatures.push('Entropy Analysis (requires TensorFlow.js)');\r\n\r\n    return {\r\n        available: availableFeatures,\r\n        unavailable: unavailableFeatures,\r\n        hasAdvancedAI: capabilities.tensorFlowAvailable,\r\n        canUseWorkers: capabilities.workerAvailable && capabilities.offscreenCanvas,\r\n        recommendedMode: capabilities.faceDetection ? 'face' :\r\n            capabilities.objectDetection ? 'object' :\r\n                capabilities.saliencyDetection ? 'saliency' : 'center'\r\n    };\r\n}\r\n\r\n/**\r\n * Check if object is a LemGendImage instance\r\n * @param {any} obj - Object to check\r\n * @returns {boolean} True if LemGendImage instance\r\n */\r\nexport function isLemGendImage(obj) {\r\n    // Simple check - this avoids circular dependency\r\n    return obj &&\r\n        typeof obj === 'object' &&\r\n        obj.constructor &&\r\n        obj.constructor.name === 'LemGendImage';\r\n}\r\n\r\nexport default {\r\n    getImageDimensions,\r\n    getMimeTypeFromExtension,\r\n    hasTransparency,\r\n    fileToDataURL,\r\n    dataURLtoFile,\r\n    resizeImage,\r\n    cropImage,\r\n    calculateAspectRatioFit,\r\n    formatFileSize,\r\n    getFileExtension,\r\n    validateImageFile,\r\n    createThumbnail,\r\n    batchProcess,\r\n    analyzeForOptimization,\r\n    getOptimizationPreset,\r\n    calculateOptimizationSavings,\r\n    createOptimizationPreview,\r\n    generateOptimizationComparison,\r\n    needsFormatConversion,\r\n    getRecommendedFormat,\r\n    getOptimizationStats,\r\n    getFormatPriorities,\r\n    checkAICapabilities,\r\n    isLemGendImage\r\n};","/**\r\n * Image validation utilities\r\n * @module utils/validation\r\n */\r\n\r\n// Import shared utilities\r\nimport { formatFileSize } from './imageUtils.js';\r\n\r\n/**\r\n * Validation error codes\r\n */\r\nexport const ValidationErrors = {\r\n    INVALID_FILE: 'INVALID_FILE',\r\n    FILE_TOO_LARGE: 'FILE_TOO_LARGE',\r\n    UNSUPPORTED_TYPE: 'UNSUPPORTED_TYPE',\r\n    INVALID_DIMENSIONS: 'INVALID_DIMENSIONS',\r\n    INVALID_QUALITY: 'INVALID_QUALITY',\r\n    INVALID_FORMAT: 'INVALID_FORMAT',\r\n    EMPTY_PATTERN: 'EMPTY_PATTERN',\r\n    INVALID_CHARS: 'INVALID_CHARS',\r\n    MISSING_INFO: 'MISSING_INFO',\r\n    INVALID_CROP_DIMENSIONS: 'INVALID_CROP_DIMENSIONS',\r\n    INVALID_CROP_MODE: 'INVALID_CROP_MODE',\r\n    INVALID_DIMENSION: 'INVALID_DIMENSION',\r\n    INVALID_MODE: 'INVALID_MODE',\r\n    INVALID_ALGORITHM: 'INVALID_ALGORITHM',\r\n    INVALID_WIDTH: 'INVALID_WIDTH',\r\n    INVALID_HEIGHT: 'INVALID_HEIGHT',\r\n    DIMENSION_EXCEEDS_MAX: 'DIMENSION_EXCEEDS_MAX',\r\n    VERY_SMALL_DIMENSION: 'VERY_SMALL_DIMENSION',\r\n    VERY_LARGE_DIMENSION: 'VERY_LARGE_DIMENSION'\r\n}\r\n\r\n/**\r\n * Validation warning codes\r\n */\r\nexport const ValidationWarnings = {\r\n    LARGE_FILE: 'LARGE_FILE',\r\n    CONTENT_LOSS: 'CONTENT_LOSS',\r\n    TRANSPARENCY_LOSS: 'TRANSPARENCY_LOSS',\r\n    AVIF_BROWSER_SUPPORT: 'AVIF_BROWSER_SUPPORT',\r\n    SMALL_WIDTH: 'SMALL_WIDTH',\r\n    SMALL_HEIGHT: 'SMALL_HEIGHT',\r\n    LARGE_DIMENSIONS: 'LARGE_DIMENSIONS',\r\n    UNSUPPORTED_FORMAT: 'UNSUPPORTED_FORMAT',\r\n    NO_PLACEHOLDERS: 'NO_PLACEHOLDERS',\r\n    NON_INTEGER_DIMENSION: 'NON_INTEGER_DIMENSION',\r\n    FORCE_SQUARE_NO_ASPECT: 'FORCE_SQUARE_NO_ASPECT',\r\n    SVG_SKIPPED: 'SVG_SKIPPED',\r\n    FAVICON_RESIZE: 'FAVICON_RESIZE',\r\n    EXTREME_ASPECT_RATIO: 'EXTREME_ASPECT_RATIO',\r\n    VERY_SMALL_SOURCE: 'VERY_SMALL_SOURCE',\r\n    VERY_LARGE_SOURCE: 'VERY_LARGE_SOURCE'\r\n}\r\n\r\n/**\r\n * Check if dimension is variable\r\n */\r\nexport function isVariableDimension(dimension) {\r\n    if (typeof dimension === 'string') {\r\n        return dimension.includes('{') || dimension.includes('*') ||\r\n            dimension.toLowerCase().includes('variable') ||\r\n            dimension.toLowerCase().includes('flexible') ||\r\n            dimension === 'auto' || dimension === 'any'\r\n    }\r\n    return false\r\n}\r\n\r\n/**\r\n * Parse dimension string or number\r\n */\r\nexport function parseDimension(dimension) {\r\n    if (typeof dimension === 'number') {\r\n        return { value: dimension, isVariable: false, unit: 'px' }\r\n    }\r\n\r\n    if (typeof dimension === 'string') {\r\n        if (isVariableDimension(dimension)) {\r\n            return { value: null, isVariable: true, expression: dimension }\r\n        }\r\n\r\n        const match = dimension.match(/(\\d+)/)\r\n        if (match) {\r\n            return { value: parseInt(match[1]), isVariable: false, unit: 'px' }\r\n        }\r\n    }\r\n\r\n    return { value: null, isVariable: false }\r\n}\r\n\r\n/**\r\n * Validate resize options (moved from LemGendaryResize)\r\n */\r\nexport function validateResizeOptions(options = {}) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    const { dimension, algorithm, mode, forceSquare, preserveAspectRatio } = options\r\n\r\n    // Validate dimension\r\n    if (typeof dimension !== 'number' || dimension <= 0) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_DIMENSION',\r\n            message: 'Dimension must be a positive number',\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    if (dimension > 10000) {\r\n        result.errors.push({\r\n            code: 'DIMENSION_EXCEEDS_MAX',\r\n            message: `Dimension exceeds maximum allowed value of 10000`,\r\n            severity: 'error',\r\n            suggestion: 'Reduce dimension to 10000 or less'\r\n        })\r\n    }\r\n\r\n    if (dimension < 10) {\r\n        result.warnings.push({\r\n            code: 'VERY_SMALL_DIMENSION',\r\n            message: `Very small target dimension (${dimension}px)`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider at least 100px for usable images'\r\n        })\r\n    }\r\n\r\n    if (dimension > 4000) {\r\n        result.warnings.push({\r\n            code: 'VERY_LARGE_DIMENSION',\r\n            message: `Very large target dimension (${dimension}px)`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider 1920px or less for web images'\r\n        })\r\n    }\r\n\r\n    // Validate algorithm\r\n    const validAlgorithms = ['lanczos3', 'bilinear', 'nearest', 'cubic', 'mitchell']\r\n    if (algorithm && !validAlgorithms.includes(algorithm)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_ALGORITHM',\r\n            message: `Algorithm must be one of: ${validAlgorithms.join(', ')}`,\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    // Validate mode\r\n    const validModes = ['longest', 'width', 'height', 'auto']\r\n    if (mode && !validModes.includes(mode)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_MODE',\r\n            message: `Mode must be one of: ${validModes.join(', ')}`,\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    // Round dimension if not integer\r\n    if (dimension && !Number.isInteger(dimension)) {\r\n        result.warnings.push({\r\n            code: 'NON_INTEGER_DIMENSION',\r\n            message: 'Dimension should be an integer for best results',\r\n            severity: 'info'\r\n        })\r\n    }\r\n\r\n    // Check for potential issues\r\n    if (forceSquare && !preserveAspectRatio) {\r\n        result.warnings.push({\r\n            code: 'FORCE_SQUARE_NO_ASPECT',\r\n            message: 'Force square without preserving aspect ratio may cause issues',\r\n            severity: 'warning',\r\n            suggestion: 'Consider enabling preserveAspectRatio for forceSquare'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate crop options (moved from LemGendaryCrop)\r\n */\r\nexport function validateCropOptions(options = {}) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    const { width, height, mode, algorithm } = options\r\n\r\n    // Validate dimensions\r\n    if (typeof width !== 'number' || width <= 0) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_WIDTH',\r\n            message: 'Width must be a positive number',\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    if (typeof height !== 'number' || height <= 0) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_HEIGHT',\r\n            message: 'Height must be a positive number',\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    // Check for extreme dimensions\r\n    if (width < 10 || height < 10) {\r\n        result.errors.push({\r\n            code: 'EXTREME_SMALL_DIMENSIONS',\r\n            message: `Target dimensions too small: ${width}x${height}`,\r\n            severity: 'error',\r\n            suggestion: 'Use dimensions of at least 100x100 pixels'\r\n        })\r\n    }\r\n\r\n    if (width > 10000 || height > 10000) {\r\n        result.warnings.push({\r\n            code: 'EXTREME_LARGE_DIMENSIONS',\r\n            message: `Target dimensions very large: ${width}x${height}`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider smaller dimensions for better performance'\r\n        })\r\n    }\r\n\r\n    // Validate aspect ratio\r\n    const aspectRatio = width / height\r\n    if (aspectRatio > 10 || aspectRatio < 0.1) {\r\n        result.warnings.push({\r\n            code: 'EXTREME_ASPECT_RATIO',\r\n            message: `Extreme aspect ratio: ${aspectRatio.toFixed(2)}`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider more balanced dimensions'\r\n        })\r\n    }\r\n\r\n    // Validate mode\r\n    const validModes = [\r\n        'smart', 'face', 'object', 'saliency', 'entropy',\r\n        'center', 'top', 'bottom', 'left', 'right',\r\n        'top-left', 'top-right', 'bottom-left', 'bottom-right'\r\n    ]\r\n\r\n    if (mode && !validModes.includes(mode)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_CROP_MODE',\r\n            message: `Mode must be one of: ${validModes.join(', ')}`,\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    // Validate algorithm\r\n    if (algorithm && !['lanczos3', 'bilinear', 'nearest'].includes(algorithm)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_ALGORITHM',\r\n            message: 'Algorithm must be \"lanczos3\", \"bilinear\", or \"nearest\"',\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    // Check for integer dimensions\r\n    if (width && !Number.isInteger(width) || height && !Number.isInteger(height)) {\r\n        result.warnings.push({\r\n            code: 'NON_INTEGER_DIMENSIONS',\r\n            message: 'Crop dimensions should be integers for best results',\r\n            severity: 'info'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate optimization options\r\n */\r\nexport function validateOptimizationOptions(options = {}) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    const { quality, format, compressionMode, browserSupport } = options\r\n\r\n    if (quality !== undefined) {\r\n        if (typeof quality !== 'number' || quality < 1 || quality > 100) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: 'INVALID_QUALITY',\r\n                message: `Quality must be between 1 and 100, got ${quality}`,\r\n                severity: 'error',\r\n                suggestion: 'Use a value between 1 and 100'\r\n            })\r\n        }\r\n    }\r\n\r\n    const validFormats = ['auto', 'webp', 'jpg', 'jpeg', 'png', 'avif', 'original']\r\n    if (format && !validFormats.includes(format.toLowerCase())) {\r\n        result.warnings.push({\r\n            code: 'UNSUPPORTED_FORMAT',\r\n            message: `Format ${format} may not be supported`,\r\n            severity: 'warning',\r\n            suggestion: `Use one of: ${validFormats.join(', ')}`\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate template compatibility\r\n */\r\nexport function validateTemplateCompatibility(template, imageInfo) {\r\n    const result = {\r\n        compatible: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    if (!template || !imageInfo) {\r\n        result.compatible = false\r\n        result.errors.push({\r\n            code: 'MISSING_INFO',\r\n            message: 'Missing template or image information',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    const { width, height } = imageInfo\r\n    const widthInfo = parseDimension(template.width)\r\n    const heightInfo = parseDimension(template.height)\r\n\r\n    if (!widthInfo.isVariable && widthInfo.value && width < widthInfo.value) {\r\n        result.warnings.push({\r\n            code: 'SMALL_WIDTH',\r\n            message: `Image width (${width}px) smaller than template width (${widthInfo.value}px)`,\r\n            severity: 'warning',\r\n            suggestion: 'Image will be upscaled or may lose quality'\r\n        })\r\n    }\r\n\r\n    if (!heightInfo.isVariable && heightInfo.value && height < heightInfo.value) {\r\n        result.warnings.push({\r\n            code: 'SMALL_HEIGHT',\r\n            message: `Image height (${height}px) smaller than template height (${heightInfo.value}px)`,\r\n            severity: 'warning',\r\n            suggestion: 'Image will be upscaled or may lose quality'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Get validation summary\r\n */\r\nexport function getValidationSummary(validationResult) {\r\n    return {\r\n        isValid: validationResult.valid,\r\n        hasWarnings: validationResult.warnings.length > 0,\r\n        errorCount: validationResult.errors.length,\r\n        warningCount: validationResult.warnings.length,\r\n        errors: validationResult.errors,\r\n        warnings: validationResult.warnings\r\n    }\r\n}\r\n\r\n/**\r\n * Get flexible templates\r\n */\r\nexport function getFlexibleTemplates(templates) {\r\n    if (!Array.isArray(templates)) return []\r\n    return templates.filter(template => {\r\n        const widthInfo = parseDimension(template.width)\r\n        const heightInfo = parseDimension(template.height)\r\n        return widthInfo.isVariable || heightInfo.isVariable\r\n    })\r\n}\r\n\r\n/**\r\n * Validate dimensions\r\n */\r\nexport function validateDimensions(width, height, options = {}) {\r\n    const { minWidth = 1, minHeight = 1, maxWidth = 10000, maxHeight = 10000 } = options\r\n\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    if (width < minWidth || height < minHeight) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_DIMENSIONS,\r\n            message: `Dimensions too small: ${width}x${height} (minimum: ${minWidth}x${minHeight})`,\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    if (width > maxWidth || height > maxHeight) {\r\n        result.warnings.push({\r\n            code: 'LARGE_DIMENSIONS',\r\n            message: `Large dimensions: ${width}x${height} (maximum: ${maxWidth}x${maxHeight})`,\r\n            severity: 'warning'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate resize\r\n */\r\nexport function validateResize(dimension, mode, options = {}) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    if (!dimension || dimension <= 0) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_DIMENSION',\r\n            message: `Invalid resize dimension: ${dimension}`,\r\n            severity: 'error',\r\n            suggestion: 'Dimension must be a positive number'\r\n        })\r\n    }\r\n\r\n    const validModes = ['auto', 'width', 'height', 'longest', 'fit']\r\n    if (!validModes.includes(mode)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_MODE',\r\n            message: `Invalid resize mode: ${mode}`,\r\n            severity: 'error',\r\n            suggestion: `Use one of: ${validModes.join(', ')}`\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate crop\r\n */\r\nexport function validateCrop(width, height, mode, options = {}) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    if (!width || width <= 0 || !height || height <= 0) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_CROP_DIMENSIONS',\r\n            message: `Invalid crop dimensions: ${width}x${height}`,\r\n            severity: 'error',\r\n            suggestion: 'Dimensions must be positive numbers'\r\n        })\r\n    }\r\n\r\n    const validModes = ['smart', 'face', 'object', 'saliency', 'entropy', 'center', 'top', 'bottom', 'left', 'right', 'top-left', 'top-right', 'bottom-left', 'bottom-right']\r\n    if (!validModes.includes(mode)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'INVALID_CROP_MODE',\r\n            message: `Invalid crop mode: ${mode}`,\r\n            severity: 'error',\r\n            suggestion: `Use one of: ${validModes.join(', ')}`\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate optimization\r\n */\r\nexport function validateOptimization(options = {}) {\r\n    return validateOptimizationOptions(options)\r\n}\r\n\r\n/**\r\n * Validate rename pattern\r\n */\r\nexport function validateRenamePattern(pattern) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    if (!pattern || typeof pattern !== 'string' || pattern.trim() === '') {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: 'EMPTY_PATTERN',\r\n            message: 'Rename pattern cannot be empty',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    const invalidChars = /[<>:\"/\\\\|?*\\x00-\\x1F]/g\r\n    if (invalidChars.test(pattern)) {\r\n        result.errors.push({\r\n            code: 'INVALID_CHARS',\r\n            message: 'Pattern contains invalid filename characters',\r\n            severity: 'error',\r\n            suggestion: 'Remove <>:\"/\\\\|?* and control characters from pattern'\r\n        })\r\n        result.valid = false\r\n    }\r\n\r\n    const placeholders = ['{name}', '{index}', '{timestamp}', '{width}', '{height}', '{dimensions}', '{date}', '{time}']\r\n    const hasPlaceholder = placeholders.some(ph => pattern.includes(ph))\r\n\r\n    if (!hasPlaceholder) {\r\n        result.warnings.push({\r\n            code: 'NO_PLACEHOLDERS',\r\n            message: 'Pattern may create duplicate filenames',\r\n            severity: 'warning',\r\n            suggestion: 'Include {index} or {timestamp} for unique filenames'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate image file\r\n */\r\nexport function validateImage(file, options = {}) {\r\n    const {\r\n        maxFileSize = 50 * 1024 * 1024,\r\n        minFileSize = 1,\r\n        allowedTypes = [\r\n            'image/jpeg', 'image/jpg', 'image/png',\r\n            'image/webp', 'image/gif', 'image/svg+xml',\r\n            'image/bmp', 'image/tiff', 'image/avif',\r\n            'image/x-icon', 'image/vnd.microsoft.icon'\r\n        ],\r\n        checkDimensions = false,\r\n        minDimensions = { width: 1, height: 1 },\r\n        maxDimensions = { width: 10000, height: 10000 }\r\n    } = options\r\n\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        metadata: {}\r\n    }\r\n\r\n    if (!file || typeof file !== 'object') {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FILE,\r\n            message: 'Not a valid file object',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    const hasRequiredProperties = file.name !== undefined &&\r\n        file.size !== undefined &&\r\n        file.type !== undefined\r\n\r\n    if (!hasRequiredProperties) {\r\n        if (file.metadata && file.metadata.name && file.metadata.type && file.metadata.size) {\r\n            result.metadata = { ...file.metadata }\r\n        } else {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.INVALID_FILE,\r\n                message: 'File object missing required properties (name, size, type)',\r\n                severity: 'error'\r\n            })\r\n            return result\r\n        }\r\n    } else {\r\n        result.metadata = {\r\n            name: file.name,\r\n            type: file.type,\r\n            size: file.size,\r\n            lastModified: file.lastModified || Date.now()\r\n        }\r\n    }\r\n\r\n    const fileName = file.name || result.metadata.name\r\n    const fileType = file.type || result.metadata.type\r\n    const fileSize = file.size || result.metadata.size\r\n\r\n    if (fileSize < minFileSize) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FILE,\r\n            message: 'File is empty',\r\n            severity: 'error'\r\n        })\r\n    } else if (fileSize > maxFileSize) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.FILE_TOO_LARGE,\r\n            message: `File too large (${formatFileSize(fileSize)} > ${formatFileSize(maxFileSize)})`,\r\n            severity: 'error'\r\n        })\r\n    } else if (fileSize > 10 * 1024 * 1024) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.LARGE_FILE,\r\n            message: `Large file (${formatFileSize(fileSize)}) may process slowly`,\r\n            severity: 'warning'\r\n        })\r\n    }\r\n\r\n    const normalizedType = fileType ? fileType.toLowerCase() : ''\r\n    const isAllowed = allowedTypes.some(allowedType => {\r\n        if (normalizedType === allowedType) return true\r\n\r\n        if (normalizedType.includes('jpeg') && allowedType.includes('jpeg')) return true\r\n        if (normalizedType.includes('jpg') && allowedType.includes('jpg')) return true\r\n\r\n        if (!normalizedType || normalizedType === 'application/octet-stream') {\r\n            const extension = fileName ? fileName.split('.').pop().toLowerCase() : ''\r\n            const extensionMap = {\r\n                'jpg': 'image/jpeg',\r\n                'jpeg': 'image/jpeg',\r\n                'png': 'image/png',\r\n                'webp': 'image/webp',\r\n                'gif': 'image/gif',\r\n                'svg': 'image/svg+xml',\r\n                'bmp': 'image/bmp',\r\n                'tiff': 'image/tiff',\r\n                'tif': 'image/tiff',\r\n                'avif': 'image/avif',\r\n                'ico': 'image/x-icon'\r\n            }\r\n            return extensionMap[extension] === allowedType\r\n        }\r\n\r\n        return false\r\n    })\r\n\r\n    if (!isAllowed) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.UNSUPPORTED_TYPE,\r\n            message: `Unsupported file type: ${fileType || 'unknown'}`,\r\n            severity: 'error',\r\n            details: fileName ? `File: ${fileName}` : ''\r\n        })\r\n    }\r\n\r\n    if (checkDimensions && file.width && file.height) {\r\n        const dimensionValidation = validateDimensions(file.width, file.height, {\r\n            minWidth: minDimensions.width,\r\n            minHeight: minDimensions.height,\r\n            maxWidth: maxDimensions.width,\r\n            maxHeight: maxDimensions.height\r\n        })\r\n\r\n        result.errors.push(...dimensionValidation.errors)\r\n        result.warnings.push(...dimensionValidation.warnings)\r\n        result.valid = result.valid && dimensionValidation.valid\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate session image data\r\n */\r\nexport function validateSessionImage(imageData, options = {}) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        metadata: {}\r\n    }\r\n\r\n    if (!imageData || typeof imageData !== 'object') {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FILE,\r\n            message: 'Invalid image data',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    let fileName, fileType, fileSize, fileObject\r\n\r\n    if (imageData.file instanceof File || imageData.file instanceof Blob) {\r\n        fileObject = imageData.file\r\n        fileName = imageData.file.name\r\n        fileType = imageData.file.type\r\n        fileSize = imageData.file.size\r\n    } else if (imageData.name && imageData.type && imageData.size) {\r\n        fileName = imageData.name\r\n        fileType = imageData.type\r\n        fileSize = imageData.size\r\n    } else if (imageData.lemGendImage) {\r\n        if (imageData.lemGendImage.file) {\r\n            fileObject = imageData.lemGendImage.file\r\n        }\r\n        fileName = imageData.lemGendImage.metadata?.originalName || imageData.originalName\r\n        fileType = imageData.lemGendImage.metadata?.mimeType || imageData.type\r\n        fileSize = imageData.lemGendImage.metadata?.originalSize || imageData.size\r\n    } else {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FILE,\r\n            message: 'Cannot extract file information',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    if (!fileObject && imageData.blob) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.CONTENT_LOSS,\r\n            message: 'File data available as blob, but not as File object',\r\n            severity: 'warning',\r\n            suggestion: 'File may need to be reconstructed for processing'\r\n        })\r\n    }\r\n\r\n    result.metadata = {\r\n        name: fileName,\r\n        type: fileType,\r\n        size: fileSize,\r\n        id: imageData.id,\r\n        hasFileObject: !!fileObject,\r\n        hasBlobData: !!imageData.blob\r\n    }\r\n\r\n    if (fileObject) {\r\n        const fileValidation = validateImage(fileObject, options)\r\n        result.valid = fileValidation.valid\r\n        result.errors.push(...fileValidation.errors)\r\n        result.warnings.push(...fileValidation.warnings)\r\n        result.metadata = { ...result.metadata, ...fileValidation.metadata }\r\n    } else {\r\n        const minimalFile = {\r\n            name: fileName,\r\n            type: fileType,\r\n            size: fileSize,\r\n            lastModified: Date.now()\r\n        }\r\n        const fileValidation = validateImage(minimalFile, options)\r\n        result.valid = fileValidation.valid\r\n        result.errors.push(...fileValidation.errors)\r\n        result.warnings.push(...fileValidation.warnings)\r\n        result.metadata = { ...result.metadata, ...fileValidation.metadata }\r\n    }\r\n\r\n    if (imageData.url && !imageData.url.startsWith('blob:')) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.CONTENT_LOSS,\r\n            message: 'Image URL may not be a valid blob URL',\r\n            severity: 'warning'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate favicon options\r\n */\r\nexport function validateFaviconOptions(options, imageInfo = null) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    const { sizes, formats } = options\r\n\r\n    if (!Array.isArray(sizes) || sizes.length === 0) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_DIMENSIONS,\r\n            message: 'Favicon sizes must be a non-empty array',\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    sizes?.forEach(size => {\r\n        if (size < 16) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_WIDTH,\r\n                message: `Favicon size ${size}px is below recommended minimum (16px)`,\r\n                severity: 'warning'\r\n            })\r\n        }\r\n\r\n        if (size > 1024) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.LARGE_DIMENSIONS,\r\n                message: `Favicon size ${size}px is unusually large`,\r\n                severity: 'info'\r\n            })\r\n        }\r\n    })\r\n\r\n    if (imageInfo) {\r\n        const minSize = Math.min(...sizes)\r\n        if (imageInfo.width < minSize || imageInfo.height < minSize) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_WIDTH,\r\n                message: `Source image (${imageInfo.width}x${imageInfo.height}) smaller than smallest favicon size (${minSize}px)`,\r\n                severity: 'warning',\r\n                suggestion: 'Consider using a larger source image or enable upscaling'\r\n            })\r\n        }\r\n\r\n        if (Math.abs(imageInfo.width / imageInfo.height - 1) > 0.1) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.CONTENT_LOSS,\r\n                message: 'Source image is not square; favicons may be distorted',\r\n                severity: 'warning',\r\n                suggestion: 'Consider adding a crop step before favicon generation'\r\n            })\r\n        }\r\n    }\r\n\r\n    const validFormats = ['png', 'ico', 'svg']\r\n    formats?.forEach(format => {\r\n        if (!validFormats.includes(format)) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.UNSUPPORTED_FORMAT,\r\n                message: `Unsupported favicon format: ${format}`,\r\n                severity: 'warning',\r\n                suggestion: `Use one of: ${validFormats.join(', ')}`\r\n            })\r\n        }\r\n    })\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate task steps\r\n */\r\nexport function validateTaskSteps(steps, imageInfo = null) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: []\r\n    }\r\n\r\n    steps.forEach((step, index) => {\r\n        switch (step.processor) {\r\n            case 'resize':\r\n                const resizeValidation = validateResize(\r\n                    step.options.dimension,\r\n                    step.options.mode\r\n                )\r\n                if (!resizeValidation.valid) {\r\n                    resizeValidation.errors.forEach(error => {\r\n                        error.step = index + 1\r\n                        result.errors.push(error)\r\n                    })\r\n                    resizeValidation.warnings.forEach(warning => {\r\n                        warning.step = index + 1\r\n                        result.warnings.push(warning)\r\n                    })\r\n                    result.valid = false\r\n                }\r\n                break\r\n\r\n            case 'crop':\r\n                const cropValidation = validateCrop(\r\n                    step.options.width,\r\n                    step.options.height,\r\n                    step.options.mode\r\n                )\r\n                if (!cropValidation.valid) {\r\n                    cropValidation.errors.forEach(error => {\r\n                        error.step = index + 1\r\n                        result.errors.push(error)\r\n                    })\r\n                    cropValidation.warnings.forEach(warning => {\r\n                        warning.step = index + 1\r\n                        result.warnings.push(warning)\r\n                    })\r\n                    result.valid = false\r\n                }\r\n                break\r\n\r\n            case 'optimize':\r\n                const optimizeValidation = validateOptimization(step.options)\r\n                optimizeValidation.errors.forEach(error => {\r\n                    error.step = index + 1\r\n                    result.errors.push(error)\r\n                })\r\n                optimizeValidation.warnings.forEach(warning => {\r\n                    warning.step = index + 1\r\n                    result.warnings.push(warning)\r\n                })\r\n                result.valid = result.valid && optimizeValidation.valid\r\n                break\r\n\r\n            case 'rename':\r\n                const renameValidation = validateRenamePattern(step.options.pattern)\r\n                renameValidation.errors.forEach(error => {\r\n                    error.step = index + 1\r\n                    result.errors.push(error)\r\n                })\r\n                renameValidation.warnings.forEach(warning => {\r\n                    warning.step = index + 1\r\n                    result.warnings.push(warning)\r\n                })\r\n                result.valid = result.valid && renameValidation.valid\r\n                break\r\n\r\n            case 'favicon':\r\n                const faviconValidation = validateFaviconOptions(step.options, imageInfo)\r\n                faviconValidation.errors.forEach(error => {\r\n                    error.step = index + 1\r\n                    result.errors.push(error)\r\n                })\r\n                faviconValidation.warnings.forEach(warning => {\r\n                    warning.step = index + 1\r\n                    result.warnings.push(warning)\r\n                })\r\n                result.valid = result.valid && faviconValidation.valid\r\n                break\r\n        }\r\n    })\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate task logic\r\n */\r\nexport function validateTaskLogic(steps) {\r\n    const result = {\r\n        valid: true,\r\n        warnings: []\r\n    }\r\n\r\n    const enabledSteps = steps.filter(step => step.enabled !== false)\r\n    const hasResize = enabledSteps.some(s => s.processor === 'resize')\r\n    const hasCrop = enabledSteps.some(s => s.processor === 'crop')\r\n    const hasOptimize = enabledSteps.some(s => s.processor === 'optimize')\r\n\r\n    if (hasCrop && !hasResize) {\r\n        result.warnings.push({\r\n            type: 'crop_without_resize',\r\n            message: 'Crop without resize may result in unexpected output',\r\n            severity: 'info',\r\n            suggestion: 'Consider adding resize step before crop for better control'\r\n        })\r\n    }\r\n\r\n    const optimizeSteps = enabledSteps.filter(s => s.processor === 'optimize')\r\n    if (optimizeSteps.length > 1) {\r\n        result.warnings.push({\r\n            type: 'multiple_optimize',\r\n            message: `Multiple optimization steps (${optimizeSteps.length})`,\r\n            severity: 'warning',\r\n            suggestion: 'Multiple optimizations may degrade quality unnecessarily'\r\n        })\r\n    }\r\n\r\n    const renameIndex = enabledSteps.findIndex(s => s.processor === 'rename')\r\n    if (renameIndex >= 0 && renameIndex < enabledSteps.length - 2) {\r\n        result.warnings.push({\r\n            type: 'early_rename',\r\n            message: 'Rename step placed before other operations',\r\n            severity: 'info',\r\n            suggestion: 'Consider moving rename to end to reflect final output'\r\n        })\r\n    }\r\n\r\n    const faviconIndex = enabledSteps.findIndex(s => s.processor === 'favicon')\r\n    if (faviconIndex >= 0) {\r\n        const stepsBefore = enabledSteps.slice(0, faviconIndex)\r\n        const hasResizeBefore = stepsBefore.some(s => s.processor === 'resize')\r\n        const hasCropBefore = stepsBefore.some(s => s.processor === 'crop')\r\n\r\n        if (!hasResizeBefore && !hasCropBefore) {\r\n            result.warnings.push({\r\n                type: 'favicon_without_preparation',\r\n                message: 'Favicon generation without prior resize/crop',\r\n                severity: 'warning',\r\n                suggestion: 'Add resize/crop step before favicon for optimal results'\r\n            })\r\n        }\r\n    }\r\n\r\n    const faviconSteps = enabledSteps.filter(s => s.processor === 'favicon')\r\n    faviconSteps.forEach(faviconStep => {\r\n        const optimizeAfter = enabledSteps\r\n            .filter(s => s.processor === 'optimize')\r\n            .some(optimizeStep => optimizeStep.order > faviconStep.order)\r\n\r\n        if (optimizeAfter) {\r\n            result.warnings.push({\r\n                type: 'optimize_after_favicon',\r\n                message: 'Optimization after favicon generation may affect favicon quality',\r\n                severity: 'warning',\r\n                suggestion: 'Move optimization step before favicon generation'\r\n            })\r\n        }\r\n    })\r\n\r\n    if (hasOptimize && !hasResize && !hasCrop) {\r\n        result.warnings.push({\r\n            type: 'optimization_only',\r\n            message: 'Task contains only optimization step',\r\n            severity: 'info',\r\n            suggestion: 'Consider adding resize/crop steps for complete image processing'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate task against an image\r\n */\r\nexport async function validateTask(task, lemGendImage) {\r\n    const result = {\r\n        isValid: true,\r\n        hasWarnings: false,\r\n        errors: [],\r\n        warnings: [],\r\n        summary: null\r\n    }\r\n\r\n    const enabledSteps = task.getEnabledSteps()\r\n\r\n    if (enabledSteps.length === 0) {\r\n        result.warnings.push({\r\n            type: 'empty_task',\r\n            message: 'Task has no enabled processing steps',\r\n            severity: 'warning'\r\n        })\r\n    }\r\n\r\n    if (lemGendImage) {\r\n        if (!lemGendImage.file) {\r\n            result.warnings.push({\r\n                type: 'missing_file_property',\r\n                message: 'Image missing file property (may be from session storage)',\r\n                severity: 'warning',\r\n                suggestion: 'File will be reconstructed for processing'\r\n            })\r\n        } else if (!(lemGendImage.file instanceof File)) {\r\n            result.warnings.push({\r\n                type: 'invalid_file_type',\r\n                message: 'Image file property is not a File instance',\r\n                severity: 'warning',\r\n                suggestion: 'File will be reconstructed for processing'\r\n            })\r\n        }\r\n\r\n        const stepValidation = validateTaskSteps(enabledSteps, {\r\n            width: lemGendImage.width,\r\n            height: lemGendImage.height\r\n        })\r\n        result.errors.push(...stepValidation.errors)\r\n        result.warnings.push(...stepValidation.warnings)\r\n        result.isValid = stepValidation.valid\r\n\r\n        const logicValidation = validateTaskLogic(enabledSteps)\r\n        result.warnings.push(...logicValidation.warnings)\r\n    } else {\r\n        const stepValidation = validateTaskSteps(enabledSteps)\r\n        result.errors.push(...stepValidation.errors)\r\n        result.warnings.push(...stepValidation.warnings)\r\n        result.isValid = stepValidation.valid\r\n    }\r\n\r\n    result.hasWarnings = result.warnings.length > 0\r\n    result.summary = getValidationSummary({\r\n        valid: result.isValid,\r\n        errors: result.errors,\r\n        warnings: result.warnings\r\n    })\r\n\r\n    return result\r\n}\r\n\r\n// Default export for convenience\r\nexport default {\r\n    ValidationErrors,\r\n    ValidationWarnings,\r\n    isVariableDimension,\r\n    parseDimension,\r\n    validateResizeOptions,\r\n    validateCropOptions,\r\n    validateOptimizationOptions,\r\n    validateTemplateCompatibility,\r\n    validateImage,\r\n    validateSessionImage,\r\n    validateTask,\r\n    validateTaskSteps,\r\n    validateTaskLogic,\r\n    validateFaviconOptions,\r\n    getValidationSummary,\r\n    getFlexibleTemplates,\r\n    validateDimensions,\r\n    validateResize,\r\n    validateCrop,\r\n    validateOptimization,\r\n    validateRenamePattern\r\n}","/**\r\n * LemGendTask - Unified processing pipeline with favicon support\r\n * @class\r\n * @description Orchestrates multiple image processing operations in sequence\r\n */\r\n\r\n// Import centralized validation functions\r\nimport {\r\n    validateTask,\r\n    validateOptimizationOptions,\r\n    ValidationWarnings,\r\n    validateFaviconOptions,\r\n    validateTaskSteps,\r\n    validateTaskLogic\r\n} from '../utils/validationUtils.js'\r\n\r\nexport class LemGendTask {\r\n    /**\r\n     * Create a new LemGendTask\r\n     * @param {string} name - Task name\r\n     * @param {string} description - Task description\r\n     */\r\n    constructor(name = 'Untitled Task', description = '') {\r\n        this.id = `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\r\n        this.name = name\r\n        this.description = description\r\n        this.steps = []\r\n        this.validationWarnings = []\r\n        this.validationErrors = []\r\n        this.createdAt = new Date().toISOString()\r\n        this.updatedAt = new Date().toISOString()\r\n        this.metadata = {\r\n            version: '2.2.0',\r\n            processorVersions: {\r\n                resize: '1.2.1',\r\n                crop: '2.0.0',\r\n                optimize: '2.0.0',\r\n                rename: '1.0.0',\r\n                template: '1.3.0',\r\n                favicon: '2.0.0'\r\n            },\r\n            estimatedDuration: null,\r\n            estimatedOutputs: 0,\r\n            supportsFavicon: true,\r\n            supportsSVG: true,\r\n            supportsAICropping: true,\r\n            maxBatchSize: 50,\r\n            defaultResizeMode: 'longest',\r\n            supportsOptimizationFirst: true,\r\n            optimizationModes: ['adaptive', 'aggressive', 'balanced']\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add a processing step\r\n     * @param {string} processor - Processor name\r\n     * @param {Object} options - Processor options\r\n     * @returns {LemGendTask} This task instance for chaining\r\n     */\r\n    addStep = (processor, options) => {\r\n        const validProcessors = ['resize', 'crop', 'optimize', 'rename', 'template', 'favicon']\r\n\r\n        if (!validProcessors.includes(processor)) {\r\n            throw new Error(`Invalid processor: ${processor}. Valid options: ${validProcessors.join(', ')}`)\r\n        }\r\n\r\n        const step = {\r\n            id: `step_${this.steps.length + 1}_${Date.now()}_${Math.random().toString(36).substr(2, 4)}`,\r\n            processor,\r\n            options: this._validateStepOptions(processor, options),\r\n            order: this.steps.length + 1,\r\n            addedAt: new Date().toISOString(),\r\n            enabled: true,\r\n            metadata: {\r\n                requiresFavicon: processor === 'favicon',\r\n                isBatchable: !['favicon', 'template'].includes(processor),\r\n                outputType: this._getStepOutputType(processor, options),\r\n                supportsOptimizationFirst: processor === 'optimize'\r\n            }\r\n        }\r\n\r\n        this.steps.push(step)\r\n        this.updatedAt = new Date().toISOString()\r\n        this._updateMetadata()\r\n\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * Validate step options based on processor type\r\n     * @private\r\n     */\r\n    _validateStepOptions = (processor, options) => {\r\n        const defaults = {\r\n            resize: {\r\n                dimension: 1024,\r\n                mode: 'longest',\r\n                maintainAspectRatio: true,\r\n                upscale: true,\r\n                algorithm: 'lanczos3'\r\n            },\r\n            crop: {\r\n                width: 500,\r\n                height: 500,\r\n                mode: 'smart',\r\n                upscale: false,\r\n                preserveAspectRatio: true,\r\n                confidenceThreshold: 70,\r\n                cropToFit: true,\r\n                objectsToDetect: ['person', 'face', 'car', 'dog', 'cat']\r\n            },\r\n            optimize: {\r\n                quality: 85,\r\n                format: 'auto',\r\n                lossless: false,\r\n                stripMetadata: true,\r\n                preserveTransparency: true,\r\n                maxDisplayWidth: null,\r\n                browserSupport: ['modern', 'legacy'],\r\n                compressionMode: 'adaptive',\r\n                analyzeContent: true,\r\n                icoSizes: [16, 32, 48, 64, 128, 256]\r\n            },\r\n            rename: {\r\n                pattern: '{name}-{dimensions}',\r\n                preserveExtension: true,\r\n                addIndex: true,\r\n                addTimestamp: false,\r\n                customSeparator: '-'\r\n            },\r\n            template: {\r\n                templateId: null,\r\n                applyToAll: true,\r\n                preserveOriginal: false\r\n            },\r\n            favicon: {\r\n                sizes: [16, 32, 48, 64, 128, 180, 192, 256, 512],\r\n                formats: ['png', 'ico'],\r\n                generateManifest: true,\r\n                generateHTML: true,\r\n                includeAppleTouch: true,\r\n                includeAndroid: true,\r\n                roundCorners: true,\r\n                backgroundColor: '#ffffff'\r\n            }\r\n        }\r\n\r\n        const validatedOptions = { ...defaults[processor], ...options }\r\n\r\n        switch (processor) {\r\n            case 'favicon':\r\n                validatedOptions.sizes = [...new Set(validatedOptions.sizes.sort((a, b) => a - b))]\r\n                validatedOptions.sizes = validatedOptions.sizes.filter(size => size >= 16 && size <= 512)\r\n                break\r\n\r\n            case 'optimize':\r\n                if (validatedOptions.format === 'jpg' && options.preserveTransparency) {\r\n                    validatedOptions.format = 'png'\r\n                }\r\n\r\n                const validBrowserSupport = ['modern', 'legacy', 'all']\r\n                validatedOptions.browserSupport = validatedOptions.browserSupport.filter(support =>\r\n                    validBrowserSupport.includes(support)\r\n                )\r\n                if (validatedOptions.browserSupport.length === 0) {\r\n                    validatedOptions.browserSupport = ['modern', 'legacy']\r\n                }\r\n\r\n                const validCompressionModes = ['adaptive', 'aggressive', 'balanced']\r\n                if (!validCompressionModes.includes(validatedOptions.compressionMode)) {\r\n                    validatedOptions.compressionMode = 'adaptive'\r\n                }\r\n\r\n                if (validatedOptions.format === 'avif') {\r\n                    validatedOptions.quality = Math.min(63, validatedOptions.quality)\r\n                }\r\n                break\r\n\r\n            case 'crop':\r\n                if (['smart', 'face', 'object', 'saliency', 'entropy'].includes(validatedOptions.mode)) {\r\n                    validatedOptions.confidenceThreshold = Math.max(0, Math.min(100, validatedOptions.confidenceThreshold || 70))\r\n                    validatedOptions.multipleFaces = validatedOptions.multipleFaces || false\r\n\r\n                    if (!Array.isArray(validatedOptions.objectsToDetect)) {\r\n                        validatedOptions.objectsToDetect = ['person', 'face', 'car', 'dog', 'cat']\r\n                    }\r\n                }\r\n                break\r\n\r\n            case 'rename':\r\n                const placeholders = ['{name}', '{index}', '{timestamp}', '{width}', '{height}', '{dimensions}']\r\n                if (!placeholders.some(ph => validatedOptions.pattern.includes(ph))) {\r\n                    validatedOptions.pattern = '{name}-{index}'\r\n                }\r\n                break\r\n        }\r\n\r\n        return validatedOptions\r\n    }\r\n\r\n    /**\r\n     * Get step output type\r\n     * @private\r\n     */\r\n    _getStepOutputType = (processor, options) => {\r\n        switch (processor) {\r\n            case 'optimize':\r\n                return options.format === 'auto' ? 'optimized-auto' : `optimized-${options.format}`\r\n            case 'favicon':\r\n                return 'favicon-set'\r\n            case 'template':\r\n                return 'template-applied'\r\n            default:\r\n                return 'processed'\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add resize step\r\n     */\r\n    addResize = (dimension, mode = 'longest', additionalOptions = {}) => {\r\n        return this.addStep('resize', {\r\n            dimension,\r\n            mode,\r\n            ...additionalOptions\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Add crop step\r\n     */\r\n    addCrop = (width, height, mode = 'smart', additionalOptions = {}) => {\r\n        return this.addStep('crop', {\r\n            width,\r\n            height,\r\n            mode,\r\n            ...additionalOptions\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Add smart crop step with AI detection\r\n     */\r\n    addSmartCrop = (width, height, options = {}) => {\r\n        return this.addStep('crop', {\r\n            width,\r\n            height,\r\n            mode: 'smart',\r\n            confidenceThreshold: 70,\r\n            multipleFaces: true,\r\n            cropToFit: true,\r\n            ...options\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Add optimization step with enhanced options\r\n     */\r\n    addOptimize = (quality = 85, format = 'auto', additionalOptions = {}) => {\r\n        return this.addStep('optimize', {\r\n            quality,\r\n            format,\r\n            maxDisplayWidth: additionalOptions.maxDisplayWidth || null,\r\n            browserSupport: additionalOptions.browserSupport || ['modern', 'legacy'],\r\n            compressionMode: additionalOptions.compressionMode || 'adaptive',\r\n            analyzeContent: additionalOptions.analyzeContent !== false,\r\n            ...additionalOptions\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Add optimization-first step for web delivery\r\n     */\r\n    addWebOptimization = (options = {}) => {\r\n        return this.addStep('optimize', {\r\n            quality: 85,\r\n            format: 'auto',\r\n            maxDisplayWidth: 1920,\r\n            browserSupport: ['modern', 'legacy'],\r\n            compressionMode: 'adaptive',\r\n            stripMetadata: true,\r\n            preserveTransparency: true,\r\n            ...options\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Add rename step\r\n     */\r\n    addRename = (pattern, additionalOptions = {}) => {\r\n        return this.addStep('rename', {\r\n            pattern,\r\n            ...additionalOptions\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Add template step\r\n     */\r\n    addTemplate = (templateId, additionalOptions = {}) => {\r\n        return this.addStep('template', {\r\n            templateId,\r\n            ...additionalOptions\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Add favicon generation step\r\n     */\r\n    addFavicon = (sizes = [16, 32, 48, 64, 128, 180, 192, 256, 512], formats = ['png', 'ico'], additionalOptions = {}) => {\r\n        return this.addStep('favicon', {\r\n            sizes,\r\n            formats,\r\n            ...additionalOptions\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Remove a step by ID or index\r\n     */\r\n    removeStep = (identifier) => {\r\n        let index\r\n\r\n        if (typeof identifier === 'number') {\r\n            index = identifier\r\n        } else {\r\n            index = this.steps.findIndex(step => step.id === identifier)\r\n        }\r\n\r\n        if (index >= 0 && index < this.steps.length) {\r\n            this.steps.splice(index, 1)\r\n\r\n            this.steps.forEach((step, idx) => {\r\n                step.order = idx + 1\r\n            })\r\n\r\n            this.updatedAt = new Date().toISOString()\r\n            this._updateMetadata()\r\n            return true\r\n        }\r\n\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * Move step up in order\r\n     */\r\n    moveStepUp = (index) => {\r\n        if (index <= 0 || index >= this.steps.length) {\r\n            return false\r\n        }\r\n\r\n        [this.steps[index - 1], this.steps[index]] = [this.steps[index], this.steps[index - 1]]\r\n\r\n        this.steps.forEach((step, idx) => {\r\n            step.order = idx + 1\r\n        })\r\n\r\n        this.updatedAt = new Date().toISOString()\r\n        return true\r\n    }\r\n\r\n    /**\r\n     * Move step down in order\r\n     */\r\n    moveStepDown = (index) => {\r\n        if (index < 0 || index >= this.steps.length - 1) {\r\n            return false\r\n        }\r\n\r\n        [this.steps[index], this.steps[index + 1]] = [this.steps[index + 1], this.steps[index]]\r\n\r\n        this.steps.forEach((step, idx) => {\r\n            step.order = idx + 1\r\n        })\r\n\r\n        this.updatedAt = new Date().toISOString()\r\n        return true\r\n    }\r\n\r\n    /**\r\n     * Enable/disable a step\r\n     */\r\n    setStepEnabled = (index, enabled = true) => {\r\n        if (index >= 0 && index < this.steps.length) {\r\n            this.steps[index].enabled = enabled\r\n            this.updatedAt = new Date().toISOString()\r\n            this._updateMetadata()\r\n            return true\r\n        }\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * Get enabled steps only\r\n     */\r\n    getEnabledSteps = () => {\r\n        return this.steps.filter(step => step.enabled)\r\n    }\r\n\r\n    /**\r\n     * Get steps by processor type\r\n     */\r\n    getStepsByProcessor = (processor) => {\r\n        return this.steps.filter(step => step.processor === processor)\r\n    }\r\n\r\n    /**\r\n     * Check if task has specific processor\r\n     */\r\n    hasProcessor = (processor) => {\r\n        return this.getEnabledSteps().some(step => step.processor === processor)\r\n    }\r\n\r\n    /**\r\n     * Check if task has optimization step\r\n     */\r\n    hasOptimization = () => {\r\n        return this.hasProcessor('optimize')\r\n    }\r\n\r\n    /**\r\n     * Get optimization step if exists\r\n     */\r\n    getOptimizationStep = () => {\r\n        return this.getEnabledSteps().find(step => step.processor === 'optimize') || null\r\n    }\r\n\r\n    /**\r\n     * Validate task against an image\r\n     */\r\n    validate = async (lemGendImage) => {\r\n        const validation = await validateTask(this, lemGendImage)\r\n\r\n        // Update local state\r\n        this.validationWarnings = validation.warnings || []\r\n        this.validationErrors = validation.errors || []\r\n\r\n        return validation\r\n    }\r\n\r\n    /**\r\n     * Get validation summary\r\n     */\r\n    getValidationSummary = () => {\r\n        const enabledSteps = this.getEnabledSteps()\r\n        const errorCount = this.validationErrors.length\r\n        const warningCount = this.validationWarnings.length\r\n\r\n        const processorCount = {}\r\n        enabledSteps.forEach(step => {\r\n            processorCount[step.processor] = (processorCount[step.processor] || 0) + 1\r\n        })\r\n\r\n        let taskType = 'general'\r\n        if (enabledSteps.some(s => s.processor === 'favicon')) {\r\n            taskType = 'favicon'\r\n        } else if (enabledSteps.some(s => s.processor === 'template')) {\r\n            taskType = 'template'\r\n        } else if (enabledSteps.every(s => ['resize', 'crop', 'optimize'].includes(s.processor))) {\r\n            taskType = 'basic'\r\n        } else if (enabledSteps.length === 1 && enabledSteps[0].processor === 'optimize') {\r\n            taskType = 'optimization-only'\r\n        }\r\n\r\n        const hasSmartCrop = enabledSteps.some(s => s.processor === 'crop' &&\r\n            ['smart', 'face', 'object'].includes(s.options.mode))\r\n        const hasAutoOptimization = enabledSteps.some(s =>\r\n            s.processor === 'optimize' && s.options.format === 'auto'\r\n        )\r\n\r\n        return {\r\n            totalSteps: enabledSteps.length,\r\n            enabledSteps: enabledSteps.length,\r\n            disabledSteps: this.steps.length - enabledSteps.length,\r\n            errorCount,\r\n            warningCount,\r\n            processorCount,\r\n            taskType,\r\n            status: errorCount > 0 ? 'invalid' : warningCount > 0 ? 'has_warnings' : 'valid',\r\n            canProceed: errorCount === 0,\r\n            requiresImage: enabledSteps.some(s => ['resize', 'crop', 'optimize', 'favicon'].includes(s.processor)),\r\n            hasFavicon: processorCount.favicon > 0,\r\n            hasSmartCrop,\r\n            hasAutoOptimization,\r\n            estimatedOutputs: this._estimateOutputCount(),\r\n            optimizationLevel: this._getOptimizationLevel()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get optimization level based on settings\r\n     * @private\r\n     */\r\n    _getOptimizationLevel = () => {\r\n        const optimizeStep = this.getEnabledSteps().find(s => s.processor === 'optimize')\r\n        if (!optimizeStep) return 'none'\r\n\r\n        const { compressionMode, quality, format } = optimizeStep.options\r\n\r\n        if (compressionMode === 'aggressive' && quality < 70) {\r\n            return 'aggressive'\r\n        } else if (compressionMode === 'adaptive' || (quality >= 70 && quality <= 90)) {\r\n            return 'balanced'\r\n        } else if (compressionMode === 'balanced' && quality > 90) {\r\n            return 'high-quality'\r\n        }\r\n\r\n        return 'standard'\r\n    }\r\n\r\n    /**\r\n     * Estimate number of outputs\r\n     * @private\r\n     */\r\n    _estimateOutputCount = () => {\r\n        const enabledSteps = this.getEnabledSteps()\r\n        let count = 1\r\n\r\n        enabledSteps.forEach(step => {\r\n            if (step.processor === 'favicon') {\r\n                const { sizes = [], formats = [] } = step.options\r\n                count += sizes.length * formats.length\r\n\r\n                if (step.options.generateManifest) count++\r\n                if (step.options.generateHTML) count++\r\n                if (step.options.includeAppleTouch) count++\r\n                if (step.options.includeAndroid) count++\r\n            } else if (step.processor === 'optimize') {\r\n                const { format } = step.options\r\n                if (Array.isArray(format)) {\r\n                    count += format.length - 1\r\n                }\r\n            }\r\n        })\r\n\r\n        return count\r\n    }\r\n\r\n    /**\r\n     * Get task description\r\n     */\r\n    getDescription = () => {\r\n        const enabledSteps = this.getEnabledSteps()\r\n\r\n        if (enabledSteps.length === 0) {\r\n            return 'No processing steps configured'\r\n        }\r\n\r\n        return enabledSteps.map((step, index) => {\r\n            const stepNum = index + 1\r\n            const processor = step.processor.charAt(0).toUpperCase() + step.processor.slice(1)\r\n\r\n            switch (step.processor) {\r\n                case 'resize':\r\n                    return `${stepNum}. LemGendaryResize to ${step.options.dimension}px (${step.options.mode})`\r\n                case 'crop':\r\n                    const { mode, width, height } = step.options\r\n                    let cropDesc = `${stepNum}. LemGendaryCrop to ${width}${height}`\r\n\r\n                    if (['smart', 'face', 'object', 'saliency', 'entropy'].includes(mode)) {\r\n                        cropDesc += ` (AI ${mode} mode)`\r\n                    } else {\r\n                        cropDesc += ` (${mode})`\r\n                    }\r\n\r\n                    return cropDesc\r\n                case 'optimize':\r\n                    const formatStr = step.options.format === 'auto'\r\n                        ? 'auto (intelligent selection)'\r\n                        : step.options.format.toUpperCase()\r\n\r\n                    let optimizeDesc = `${stepNum}. LemGendaryOptimize to ${formatStr} (${step.options.quality}%)`\r\n\r\n                    if (step.options.maxDisplayWidth) {\r\n                        optimizeDesc += `, max ${step.options.maxDisplayWidth}px`\r\n                    }\r\n\r\n                    if (step.options.compressionMode && step.options.compressionMode !== 'adaptive') {\r\n                        optimizeDesc += `, ${step.options.compressionMode} compression`\r\n                    }\r\n\r\n                    if (step.options.browserSupport) {\r\n                        optimizeDesc += `, ${step.options.browserSupport.join('+')} browsers`\r\n                    }\r\n\r\n                    return optimizeDesc\r\n                case 'rename':\r\n                    return `${stepNum}. Rename with pattern: \"${step.options.pattern}\"`\r\n                case 'template':\r\n                    return `${stepNum}. Apply template: ${step.options.templateId}`\r\n                case 'favicon':\r\n                    const sizeCount = step.options.sizes?.length || 0\r\n                    const formatCount = step.options.formats?.length || 0\r\n                    return `${stepNum}. Generate favicon set (${sizeCount} sizes, ${formatCount} formats)`\r\n                default:\r\n                    return `${stepNum}. ${processor}`\r\n            }\r\n        }).join('\\n')\r\n    }\r\n\r\n    /**\r\n     * Get estimated processing time\r\n     */\r\n    getTimeEstimate = (imageCount = 1) => {\r\n        const enabledSteps = this.getEnabledSteps()\r\n\r\n        const stepTimes = {\r\n            'resize': 100,\r\n            'crop': 150,\r\n            'optimize': 200,\r\n            'rename': 10,\r\n            'template': 300,\r\n            'favicon': 500\r\n        }\r\n\r\n        let totalMs = 0\r\n        let complexityFactor = 1\r\n\r\n        enabledSteps.forEach(step => {\r\n            const baseTime = stepTimes[step.processor] || 100\r\n\r\n            if (step.processor === 'favicon') {\r\n                const sizeCount = step.options.sizes?.length || 1\r\n                const formatCount = step.options.formats?.length || 1\r\n                complexityFactor = sizeCount * formatCount\r\n            } else if (step.processor === 'crop' &&\r\n                ['smart', 'face', 'object'].includes(step.options.mode)) {\r\n                complexityFactor = 3\r\n            } else if (step.processor === 'optimize') {\r\n                if (step.options.compressionMode === 'aggressive') {\r\n                    complexityFactor = 1.5\r\n                }\r\n                if (step.options.analyzeContent) {\r\n                    complexityFactor *= 1.2\r\n                }\r\n            }\r\n\r\n            totalMs += baseTime * complexityFactor\r\n        })\r\n\r\n        totalMs *= imageCount\r\n\r\n        return {\r\n            perImage: totalMs / imageCount,\r\n            total: totalMs,\r\n            formatted: this._formatTime(totalMs),\r\n            stepCount: enabledSteps.length,\r\n            imageCount,\r\n            complexityFactor: Math.round(complexityFactor * 10) / 10\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Format time in milliseconds\r\n     * @private\r\n     */\r\n    _formatTime = (ms) => {\r\n        if (ms < 1000) return `${Math.round(ms)}ms`\r\n        if (ms < 60000) return `${(ms / 1000).toFixed(1)}s`\r\n        const minutes = Math.floor(ms / 60000)\r\n        const seconds = Math.round((ms % 60000) / 1000)\r\n        return `${minutes}m ${seconds}s`\r\n    }\r\n\r\n    /**\r\n     * Export task configuration\r\n     */\r\n    exportConfig = () => {\r\n        return {\r\n            id: this.id,\r\n            name: this.name,\r\n            description: this.description,\r\n            version: '2.2.0',\r\n            steps: this.steps.map(step => ({\r\n                id: step.id,\r\n                processor: step.processor,\r\n                options: { ...step.options },\r\n                enabled: step.enabled,\r\n                order: step.order,\r\n                metadata: step.metadata\r\n            })),\r\n            metadata: { ...this.metadata },\r\n            createdAt: this.createdAt,\r\n            updatedAt: this.updatedAt,\r\n            validation: {\r\n                warnings: this.validationWarnings,\r\n                errors: this.validationErrors\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Import task configuration\r\n     */\r\n    static importConfig(config) {\r\n        const task = new LemGendTask(config.name, config.description)\r\n        task.id = config.id || task.id\r\n        task.createdAt = config.createdAt || task.createdAt\r\n        task.updatedAt = config.updatedAt || task.updatedAt\r\n        task.metadata = config.metadata || task.metadata\r\n        task.validationWarnings = config.validation?.warnings || []\r\n        task.validationErrors = config.validation?.errors || []\r\n\r\n        config.steps?.forEach(stepConfig => {\r\n            task.addStep(stepConfig.processor, stepConfig.options)\r\n            const lastStep = task.steps[task.steps.length - 1]\r\n            lastStep.enabled = stepConfig.enabled !== false\r\n            lastStep.id = stepConfig.id || lastStep.id\r\n            lastStep.metadata = stepConfig.metadata || lastStep.metadata\r\n        })\r\n\r\n        return task\r\n    }\r\n\r\n    /**\r\n     * Create task from template\r\n     */\r\n    static fromTemplate(templateName) {\r\n        const templates = {\r\n            'web-optimized': {\r\n                name: 'Web Optimization',\r\n                description: 'Optimize images for web with modern formats',\r\n                steps: [\r\n                    { processor: 'resize', options: { dimension: 1920, mode: 'longest' } },\r\n                    { processor: 'optimize', options: { quality: 85, format: 'auto', compressionMode: 'adaptive' } },\r\n                    { processor: 'rename', options: { pattern: '{name}-{width}w' } }\r\n                ]\r\n            },\r\n            'social-media': {\r\n                name: 'Social Media Posts',\r\n                description: 'Prepare images for social media platforms',\r\n                steps: [\r\n                    { processor: 'resize', options: { dimension: 1080, mode: 'longest' } },\r\n                    {\r\n                        processor: 'crop',\r\n                        options: {\r\n                            width: 1080,\r\n                            height: 1080,\r\n                            mode: 'smart',\r\n                            confidenceThreshold: 70,\r\n                            multipleFaces: true\r\n                        }\r\n                    },\r\n                    { processor: 'optimize', options: { quality: 90, format: 'auto', compressionMode: 'balanced' } }\r\n                ]\r\n            },\r\n            'portrait-smart': {\r\n                name: 'Smart Portrait Cropping',\r\n                description: 'AI-powered portrait cropping with face detection',\r\n                steps: [\r\n                    { processor: 'resize', options: { dimension: 1080, mode: 'longest' } },\r\n                    {\r\n                        processor: 'crop',\r\n                        options: {\r\n                            width: 1080,\r\n                            height: 1350,\r\n                            mode: 'face',\r\n                            confidenceThreshold: 80,\r\n                            preserveAspectRatio: true\r\n                        }\r\n                    },\r\n                    { processor: 'optimize', options: { quality: 95, format: 'auto', compressionMode: 'adaptive' } }\r\n                ]\r\n            },\r\n            'product-showcase': {\r\n                name: 'Product Showcase',\r\n                description: 'Smart cropping for product images',\r\n                steps: [\r\n                    { processor: 'resize', options: { dimension: 1200, mode: 'longest' } },\r\n                    {\r\n                        processor: 'crop',\r\n                        options: {\r\n                            width: 1200,\r\n                            height: 1200,\r\n                            mode: 'object',\r\n                            objectsToDetect: ['product', 'item'],\r\n                            confidenceThreshold: 75\r\n                        }\r\n                    },\r\n                    { processor: 'optimize', options: { quality: 90, format: 'auto', compressionMode: 'balanced' } }\r\n                ]\r\n            },\r\n            'favicon-package': {\r\n                name: 'Favicon Package',\r\n                description: 'Generate complete favicon set for all devices',\r\n                steps: [\r\n                    { processor: 'resize', options: { dimension: 512, mode: 'longest' } },\r\n                    {\r\n                        processor: 'crop',\r\n                        options: {\r\n                            width: 512,\r\n                            height: 512,\r\n                            mode: 'smart',\r\n                            confidenceThreshold: 70\r\n                        }\r\n                    },\r\n                    {\r\n                        processor: 'favicon', options: {\r\n                            sizes: [16, 32, 48, 64, 128, 180, 192, 256, 512],\r\n                            formats: ['png', 'ico'],\r\n                            generateManifest: true,\r\n                            generateHTML: true\r\n                        }\r\n                    },\r\n                    { processor: 'rename', options: { pattern: '{name}-favicon-{size}' } }\r\n                ]\r\n            },\r\n            'optimization-only': {\r\n                name: 'Optimization Only',\r\n                description: 'Optimize images without resizing or cropping',\r\n                steps: [\r\n                    {\r\n                        processor: 'optimize',\r\n                        options: {\r\n                            quality: 85,\r\n                            format: 'auto',\r\n                            maxDisplayWidth: 1920,\r\n                            compressionMode: 'adaptive',\r\n                            browserSupport: ['modern', 'legacy']\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        }\r\n\r\n        const template = templates[templateName]\r\n        if (!template) {\r\n            throw new Error(`Unknown template: ${templateName}`)\r\n        }\r\n\r\n        return LemGendTask.importConfig(template)\r\n    }\r\n\r\n    /**\r\n     * Update metadata\r\n     * @private\r\n     */\r\n    _updateMetadata = () => {\r\n        const enabledSteps = this.getEnabledSteps()\r\n\r\n        this.metadata.estimatedDuration = this.getTimeEstimate().total\r\n        this.metadata.estimatedOutputs = this._estimateOutputCount()\r\n        this.metadata.stepCount = enabledSteps.length\r\n\r\n        const processorCount = {}\r\n        enabledSteps.forEach(step => {\r\n            processorCount[step.processor] = (processorCount[step.processor] || 0) + 1\r\n        })\r\n        this.metadata.processorCount = processorCount\r\n\r\n        if (processorCount.favicon > 0) {\r\n            this.metadata.category = 'favicon'\r\n        } else if (processorCount.template > 0) {\r\n            this.metadata.category = 'template'\r\n        } else if (processorCount.optimize > 0 && processorCount.resize === 0 && processorCount.crop === 0) {\r\n            this.metadata.category = 'optimization-only'\r\n        } else {\r\n            this.metadata.category = 'general'\r\n        }\r\n\r\n        this.metadata.hasSmartCrop = enabledSteps.some(s => s.processor === 'crop' &&\r\n            ['smart', 'face', 'object'].includes(s.options.mode))\r\n        this.metadata.hasAutoOptimization = enabledSteps.some(s =>\r\n            s.processor === 'optimize' && s.options.format === 'auto'\r\n        )\r\n    }\r\n\r\n    /**\r\n     * Clone the task\r\n     */\r\n    clone = () => {\r\n        return LemGendTask.importConfig(this.exportConfig())\r\n    }\r\n\r\n    /**\r\n     * Create a simplified version of the task for UI display\r\n     */\r\n    toSimpleObject = () => {\r\n        const summary = this.getValidationSummary()\r\n\r\n        return {\r\n            id: this.id,\r\n            name: this.name,\r\n            description: this.description,\r\n            stepCount: this.steps.length,\r\n            enabledStepCount: this.getEnabledSteps().length,\r\n            hasFavicon: summary.hasFavicon,\r\n            hasSmartCrop: summary.hasSmartCrop,\r\n            hasAutoOptimization: summary.hasAutoOptimization,\r\n            taskType: summary.taskType,\r\n            status: summary.status,\r\n            canProceed: summary.canProceed,\r\n            estimatedOutputs: summary.estimatedOutputs,\r\n            optimizationLevel: summary.optimizationLevel,\r\n            createdAt: this.createdAt,\r\n            updatedAt: this.updatedAt\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if task is compatible with image type\r\n     */\r\n    checkCompatibility = (mimeType) => {\r\n        const enabledSteps = this.getEnabledSteps()\r\n        const hasFavicon = enabledSteps.some(s => s.processor === 'favicon')\r\n        const hasSmartCrop = enabledSteps.some(s => s.processor === 'crop' &&\r\n            ['smart', 'face', 'object'].includes(s.options.mode))\r\n        const hasOptimization = enabledSteps.some(s => s.processor === 'optimize')\r\n\r\n        let compatible = true\r\n        const warnings = []\r\n        const errors = []\r\n\r\n        if (mimeType === 'image/svg+xml') {\r\n            if (hasFavicon) {\r\n                warnings.push('SVG to favicon conversion may not preserve all features')\r\n            }\r\n\r\n            if (hasSmartCrop) {\r\n                warnings.push('SVG images will be rasterized before smart cropping')\r\n            }\r\n        }\r\n\r\n        if (mimeType === 'image/gif') {\r\n            if (hasFavicon) {\r\n                warnings.push('Animated GIFs will lose animation in favicon conversion')\r\n            }\r\n\r\n            if (hasSmartCrop) {\r\n                warnings.push('Smart crop will use first frame of animated GIF')\r\n            }\r\n\r\n            if (hasOptimization) {\r\n                warnings.push('GIF optimization may reduce animation quality')\r\n            }\r\n        }\r\n\r\n        if (mimeType === 'image/x-icon' || mimeType === 'image/vnd.microsoft.icon') {\r\n            warnings.push('ICO files contain multiple images; processing may use first frame only')\r\n        }\r\n\r\n        return {\r\n            compatible,\r\n            warnings,\r\n            errors,\r\n            recommended: warnings.length === 0 && errors.length === 0\r\n        }\r\n    }\r\n}","/**\r\n * LemGendaryResize - Intelligent image resizing processor\r\n * @class\r\n */\r\nexport class LemGendaryResize {\r\n    /**\r\n     * Create a new LemGendaryResize processor\r\n     * @param {Object} options - Resize options\r\n     */\r\n    constructor(options = {}) {\r\n        this.options = {\r\n            dimension: 1024,\r\n            mode: 'longest',\r\n            maintainAspectRatio: true,\r\n            upscale: false,\r\n            algorithm: 'lanczos3',\r\n            ...options\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Process an image with resize\r\n     * @param {LemGendImage} image - Image to process\r\n     * @returns {Promise<Object>} Resize result\r\n     */\r\n    async process(image) {\r\n        if (!image || !image.width || !image.height) {\r\n            throw new Error('Invalid image dimensions');\r\n        }\r\n\r\n        const originalDimensions = {\r\n            width: image.width,\r\n            height: image.height\r\n        };\r\n\r\n        const newDimensions = this.calculateNewDimensions(\r\n            originalDimensions.width,\r\n            originalDimensions.height\r\n        );\r\n\r\n        return {\r\n            originalDimensions,\r\n            newDimensions,\r\n            options: this.options,\r\n            mode: this.options.mode,\r\n            algorithm: this.options.algorithm,\r\n            timestamp: new Date().toISOString()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Calculate new dimensions based on mode\r\n     * @private\r\n     */\r\n    calculateNewDimensions(originalWidth, originalHeight) {\r\n        const { dimension, mode, maintainAspectRatio } = this.options;\r\n\r\n        if (!maintainAspectRatio) {\r\n            return {\r\n                width: dimension,\r\n                height: dimension\r\n            };\r\n        }\r\n\r\n        let newWidth, newHeight;\r\n\r\n        switch (mode) {\r\n            case 'width':\r\n                newWidth = dimension;\r\n                newHeight = Math.round((originalHeight / originalWidth) * dimension);\r\n                break;\r\n\r\n            case 'height':\r\n                newHeight = dimension;\r\n                newWidth = Math.round((originalWidth / originalHeight) * dimension);\r\n                break;\r\n\r\n            case 'longest':\r\n            default:\r\n                if (originalWidth >= originalHeight) {\r\n                    newWidth = dimension;\r\n                    newHeight = Math.round((originalHeight / originalWidth) * dimension);\r\n                } else {\r\n                    newHeight = dimension;\r\n                    newWidth = Math.round((originalWidth / originalHeight) * dimension);\r\n                }\r\n                break;\r\n        }\r\n\r\n        // Apply upscale restriction\r\n        if (!this.options.upscale) {\r\n            newWidth = Math.min(newWidth, originalWidth);\r\n            newHeight = Math.min(newHeight, originalHeight);\r\n        }\r\n\r\n        return {\r\n            width: Math.max(1, newWidth),\r\n            height: Math.max(1, newHeight)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get processor information\r\n     * @returns {Object} Processor info\r\n     */\r\n    getInfo() {\r\n        return {\r\n            name: 'LemGendaryResize',\r\n            version: '1.2.1',\r\n            description: 'Intelligent image resizing with aspect ratio preservation',\r\n            modes: ['width', 'height', 'longest'],\r\n            algorithms: ['lanczos3', 'bilinear', 'nearest', 'cubic', 'mitchell']\r\n        };\r\n    }\r\n}\r\n\r\nexport default LemGendaryResize;","/**\r\n * LemGendaryCrop - Intelligent image cropping processor\r\n * @class\r\n */\r\nexport class LemGendaryCrop {\r\n    /**\r\n     * Create a new LemGendaryCrop processor\r\n     * @param {Object} options - Crop options\r\n     */\r\n    constructor(options = {}) {\r\n        this.options = {\r\n            width: 500,\r\n            height: 500,\r\n            mode: 'center',\r\n            upscale: false,\r\n            preserveAspectRatio: true,\r\n            confidenceThreshold: 70,\r\n            cropToFit: true,\r\n            objectsToDetect: ['person', 'face', 'car', 'dog', 'cat'],\r\n            ...options\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Process an image with crop\r\n     * @param {LemGendImage} image - Image to process\r\n     * @param {Object} currentDimensions - Current image dimensions\r\n     * @returns {Promise<Object>} Crop result\r\n     */\r\n    async process(image, currentDimensions = null) {\r\n        if (!image || (!image.width && !currentDimensions?.width)) {\r\n            throw new Error('Invalid image or dimensions');\r\n        }\r\n\r\n        const sourceWidth = currentDimensions?.width || image.width;\r\n        const sourceHeight = currentDimensions?.height || image.height;\r\n\r\n        const cropOffsets = this.calculateCropOffsets(\r\n            sourceWidth,\r\n            sourceHeight,\r\n            this.options.width,\r\n            this.options.height\r\n        );\r\n\r\n        const finalDimensions = {\r\n            width: this.options.width,\r\n            height: this.options.height\r\n        };\r\n\r\n        const smartCrop = ['smart', 'face', 'object', 'saliency', 'entropy'].includes(this.options.mode);\r\n\r\n        return {\r\n            originalDimensions: { width: sourceWidth, height: sourceHeight },\r\n            finalDimensions,\r\n            cropOffsets,\r\n            smartCrop,\r\n            mode: this.options.mode,\r\n            confidenceThreshold: this.options.confidenceThreshold,\r\n            steps: {\r\n                detection: { confidence: smartCrop ? 85 : 0 },\r\n                resize: !this.options.upscale && (sourceWidth < this.options.width || sourceHeight < this.options.height),\r\n                crop: cropOffsets\r\n            },\r\n            timestamp: new Date().toISOString()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Calculate crop offsets based on mode\r\n     * @private\r\n     */\r\n    calculateCropOffsets(sourceWidth, sourceHeight, targetWidth, targetHeight) {\r\n        let x = 0, y = 0;\r\n        let cropWidth = Math.min(targetWidth, sourceWidth);\r\n        let cropHeight = Math.min(targetHeight, sourceHeight);\r\n\r\n        if (!this.options.upscale) {\r\n            cropWidth = Math.min(targetWidth, sourceWidth);\r\n            cropHeight = Math.min(targetHeight, sourceHeight);\r\n        }\r\n\r\n        switch (this.options.mode) {\r\n            case 'center':\r\n                x = Math.max(0, Math.floor((sourceWidth - cropWidth) / 2));\r\n                y = Math.max(0, Math.floor((sourceHeight - cropHeight) / 2));\r\n                break;\r\n            case 'top':\r\n                x = Math.max(0, Math.floor((sourceWidth - cropWidth) / 2));\r\n                y = 0;\r\n                break;\r\n            case 'bottom':\r\n                x = Math.max(0, Math.floor((sourceWidth - cropWidth) / 2));\r\n                y = Math.max(0, sourceHeight - cropHeight);\r\n                break;\r\n            case 'left':\r\n                x = 0;\r\n                y = Math.max(0, Math.floor((sourceHeight - cropHeight) / 2));\r\n                break;\r\n            case 'right':\r\n                x = Math.max(0, sourceWidth - cropWidth);\r\n                y = Math.max(0, Math.floor((sourceHeight - cropHeight) / 2));\r\n                break;\r\n            case 'top-left':\r\n                x = 0;\r\n                y = 0;\r\n                break;\r\n            case 'top-right':\r\n                x = Math.max(0, sourceWidth - cropWidth);\r\n                y = 0;\r\n                break;\r\n            case 'bottom-left':\r\n                x = 0;\r\n                y = Math.max(0, sourceHeight - cropHeight);\r\n                break;\r\n            case 'bottom-right':\r\n                x = Math.max(0, sourceWidth - cropWidth);\r\n                y = Math.max(0, sourceHeight - cropHeight);\r\n                break;\r\n            case 'smart':\r\n            case 'face':\r\n            case 'object':\r\n            case 'saliency':\r\n            case 'entropy':\r\n                // AI-based cropping - default to center for now\r\n                x = Math.max(0, Math.floor((sourceWidth - cropWidth) / 2));\r\n                y = Math.max(0, Math.floor((sourceHeight - cropHeight) / 2));\r\n                break;\r\n            default:\r\n                x = 0;\r\n                y = 0;\r\n        }\r\n\r\n        return {\r\n            x,\r\n            y,\r\n            width: cropWidth,\r\n            height: cropHeight\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get processor information\r\n     * @returns {Object} Processor info\r\n     */\r\n    getInfo() {\r\n        return {\r\n            name: 'LemGendaryCrop',\r\n            version: '2.0.0',\r\n            description: 'Intelligent image cropping with AI detection',\r\n            modes: ['smart', 'face', 'object', 'saliency', 'entropy', 'center', 'top', 'bottom', 'left', 'right', 'top-left', 'top-right', 'bottom-left', 'bottom-right'],\r\n            aiCapabilities: ['face', 'object', 'saliency', 'entropy']\r\n        };\r\n    }\r\n}\r\n\r\nexport default LemGendaryCrop;","/**\r\n * LemGendaryRename - Intelligent file renaming processor\r\n * @class\r\n */\r\nexport class LemGendaryRename {\r\n    /**\r\n     * Create a new LemGendaryRename processor\r\n     * @param {Object} options - Rename options\r\n     */\r\n    constructor(options = {}) {\r\n        this.options = {\r\n            pattern: '{name}-{dimensions}',\r\n            preserveExtension: true,\r\n            addIndex: true,\r\n            addTimestamp: false,\r\n            customSeparator: '-',\r\n            ...options\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Process an image with rename\r\n     * @param {LemGendImage} image - Image to process\r\n     * @param {number} index - File index in batch\r\n     * @param {number} total - Total files in batch\r\n     * @returns {Promise<Object>} Rename result\r\n     */\r\n    async process(image, index = 0, total = 1) {\r\n        if (!image || !image.originalName) {\r\n            throw new Error('Invalid image or missing original name');\r\n        }\r\n\r\n        const variables = this.generateVariables(image, index, total);\r\n        const newName = this.applyPattern(this.options.pattern, variables);\r\n\r\n        return {\r\n            originalName: image.originalName,\r\n            newName,\r\n            variables,\r\n            pattern: this.options.pattern,\r\n            timestamp: new Date().toISOString()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Generate variables for pattern replacement\r\n     * @private\r\n     */\r\n    generateVariables(image, index, total) {\r\n        const now = new Date();\r\n        const originalName = image.originalName.replace(/\\.[^/.]+$/, ''); // Remove extension\r\n        const dimensions = image.width && image.height ? `${image.width}x${image.height}` : 'unknown';\r\n\r\n        return {\r\n            name: this.sanitizeName(originalName),\r\n            index: index + 1,\r\n            index_padded: String(index + 1).padStart(String(total).length, '0'),\r\n            total,\r\n            width: image.width || 'unknown',\r\n            height: image.height || 'unknown',\r\n            dimensions,\r\n            date: now.toISOString().split('T')[0], // YYYY-MM-DD\r\n            time: now.toTimeString().split(' ')[0], // HH:MM:SS\r\n            timestamp: now.getTime(),\r\n            year: now.getFullYear(),\r\n            month: String(now.getMonth() + 1).padStart(2, '0'),\r\n            day: String(now.getDate()).padStart(2, '0'),\r\n            hour: String(now.getHours()).padStart(2, '0'),\r\n            minute: String(now.getMinutes()).padStart(2, '0'),\r\n            second: String(now.getSeconds()).padStart(2, '0'),\r\n            extension: image.extension || 'unknown'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Apply pattern with variables\r\n     * @private\r\n     */\r\n    applyPattern(pattern, variables) {\r\n        let result = pattern;\r\n\r\n        // Replace all variables\r\n        for (const [key, value] of Object.entries(variables)) {\r\n            const placeholder = `{${key}}`;\r\n            if (result.includes(placeholder)) {\r\n                result = result.replace(new RegExp(this.escapeRegExp(placeholder), 'g'), String(value));\r\n            }\r\n        }\r\n\r\n        // Clean up result\r\n        result = result.replace(/[<>:\"/\\\\|?*\\x00-\\x1F]/g, '_');\r\n        result = result.replace(/[-_]{2,}/g, '-');\r\n        result = result.replace(/[ _]{2,}/g, ' ');\r\n        result = result.trim();\r\n        result = result.replace(/^[-_.]+|[-_.]+$/g, '');\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Sanitize filename\r\n     * @private\r\n     */\r\n    sanitizeName(name) {\r\n        return name\r\n            .replace(/[<>:\"/\\\\|?*]/g, '-')\r\n            .replace(/\\s+/g, '_')\r\n            .replace(/[^\\w.\\-]/g, '')\r\n            .substring(0, 255)\r\n            .trim();\r\n    }\r\n\r\n    /**\r\n     * Escape regex special characters\r\n     * @private\r\n     */\r\n    escapeRegExp(string) {\r\n        return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n    }\r\n\r\n    /**\r\n     * Get common rename patterns\r\n     * @returns {Object} Pattern templates\r\n     */\r\n    getCommonPatterns() {\r\n        return {\r\n            'sequential': '{name}-{index_padded}',\r\n            'dated': '{name}-{date}',\r\n            'timestamped': '{name}-{timestamp}',\r\n            'dimensioned': '{name}-{dimensions}',\r\n            'simple': '{index_padded}',\r\n            'descriptive': '{name}-{dimensions}-{date}',\r\n            'batch': 'batch-{date}-{index_padded}',\r\n            'export': 'export-{timestamp}',\r\n            'web': '{name}-{width}w',\r\n            'social': '{name}-{dimensions}-social'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get processor information\r\n     * @returns {Object} Processor info\r\n     */\r\n    getInfo() {\r\n        return {\r\n            name: 'LemGendaryRename',\r\n            version: '1.0.0',\r\n            description: 'Intelligent file renaming with pattern support',\r\n            patterns: this.getCommonPatterns(),\r\n            variables: ['name', 'index', 'index_padded', 'width', 'height', 'dimensions', 'date', 'time', 'timestamp', 'year', 'month', 'day', 'hour', 'minute', 'second', 'extension']\r\n        };\r\n    }\r\n}\r\n\r\nexport default LemGendaryRename;","/**\r\n * Image processing utilities\r\n * @module utils/processingUtils\r\n */\r\n\r\n// Import core utilities\r\nimport { getFileExtension, formatFileSize } from './imageUtils.js';\r\nimport { validateTask } from './validationUtils.js';\r\n\r\n// Import processors statically\r\nimport { LemGendaryResize } from '../processors/LemGendaryResize.js';\r\nimport { LemGendaryCrop } from '../processors/LemGendaryCrop.js';\r\nimport { LemGendaryOptimize } from '../processors/LemGendaryOptimize.js';\r\nimport { LemGendaryRename } from '../processors/LemGendaryRename.js';\r\n\r\n// Helper function to check if object is LemGendImage\r\nexport function isLemGendImage(obj) {\r\n    return obj &&\r\n        typeof obj === 'object' &&\r\n        obj.constructor &&\r\n        obj.constructor.name === 'LemGendImage';\r\n}\r\n\r\n// Helper function to get image outputs\r\nexport function getImageOutputs(image) {\r\n    if (!image) return [];\r\n    if (typeof image.getAllOutputs === 'function') {\r\n        return image.getAllOutputs();\r\n    } else if (image.outputs && typeof image.outputs.get === 'function') {\r\n        return Array.from(image.outputs.values());\r\n    } else if (Array.isArray(image.outputs)) {\r\n        return image.outputs;\r\n    }\r\n    return [];\r\n}\r\n\r\n/**\r\n * Actually resize an image using canvas\r\n */\r\nexport async function actuallyResizeImage(file, targetWidth, targetHeight, algorithm = 'lanczos3') {\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image();\r\n        img.onload = () => {\r\n            try {\r\n                const canvas = document.createElement('canvas');\r\n                canvas.width = targetWidth;\r\n                canvas.height = targetHeight;\r\n\r\n                const ctx = canvas.getContext('2d');\r\n                if (!ctx) {\r\n                    reject(new Error('Canvas context not supported'));\r\n                    return;\r\n                }\r\n\r\n                ctx.imageSmoothingEnabled = true;\r\n                ctx.imageSmoothingQuality = 'high';\r\n\r\n                ctx.drawImage(img, 0, 0, targetWidth, targetHeight);\r\n\r\n                canvas.toBlob((blob) => {\r\n                    if (!blob) {\r\n                        reject(new Error('Failed to create blob from canvas'));\r\n                        return;\r\n                    }\r\n\r\n                    const resizedFile = new File(\r\n                        [blob],\r\n                        file.name,\r\n                        { type: file.type }\r\n                    );\r\n\r\n                    URL.revokeObjectURL(img.src);\r\n                    resolve(resizedFile);\r\n                }, file.type, 0.95);\r\n            } catch (error) {\r\n                URL.revokeObjectURL(img.src);\r\n                reject(new Error(`Resize failed: ${error.message}`));\r\n            }\r\n        };\r\n        img.onerror = () => {\r\n            reject(new Error('Failed to load image for resizing'));\r\n        };\r\n        img.src = URL.createObjectURL(file);\r\n    });\r\n}\r\n\r\n/**\r\n * Actually crop an image using canvas\r\n */\r\nexport async function actuallyCropImage(file, originalWidth, originalHeight, cropWidth, cropHeight, offsetX, offsetY) {\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image();\r\n        img.onload = () => {\r\n            try {\r\n                const canvas = document.createElement('canvas');\r\n                canvas.width = cropWidth;\r\n                canvas.height = cropHeight;\r\n\r\n                const ctx = canvas.getContext('2d');\r\n                if (!ctx) {\r\n                    reject(new Error('Canvas context not supported'));\r\n                    return;\r\n                }\r\n\r\n                ctx.drawImage(\r\n                    img,\r\n                    offsetX, offsetY, cropWidth, cropHeight,\r\n                    0, 0, cropWidth, cropHeight\r\n                );\r\n\r\n                canvas.toBlob((blob) => {\r\n                    if (!blob) {\r\n                        reject(new Error('Failed to create blob from canvas'));\r\n                        return;\r\n                    }\r\n\r\n                    const croppedFile = new File(\r\n                        [blob],\r\n                        file.name,\r\n                        { type: file.type }\r\n                    );\r\n\r\n                    URL.revokeObjectURL(img.src);\r\n                    resolve(croppedFile);\r\n                }, file.type, 0.95);\r\n            } catch (error) {\r\n                URL.revokeObjectURL(img.src);\r\n                reject(new Error(`Crop failed: ${error.message}`));\r\n            }\r\n        };\r\n        img.onerror = () => {\r\n            reject(new Error('Failed to load image for cropping'));\r\n        };\r\n        img.src = URL.createObjectURL(file);\r\n    });\r\n}\r\n\r\n/**\r\n * Apply optimization to file using canvas\r\n */\r\nexport async function applyOptimization(file, dimensions, options, hasTransparency) {\r\n    const { quality, format, lossless = false } = options;\r\n\r\n    if (format === 'original') {\r\n        return file;\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image();\r\n\r\n        img.onload = () => {\r\n            try {\r\n                const canvas = document.createElement('canvas');\r\n                canvas.width = dimensions.width;\r\n                canvas.height = dimensions.height;\r\n\r\n                const ctx = canvas.getContext('2d');\r\n                if (!ctx) {\r\n                    reject(new Error('Canvas context not supported'));\r\n                    return;\r\n                }\r\n\r\n                ctx.drawImage(img, 0, 0, dimensions.width, dimensions.height);\r\n\r\n                let mimeType = 'image/jpeg';\r\n                let qualityValue = Math.max(0.1, Math.min(1, quality / 100));\r\n\r\n                switch (format.toLowerCase()) {\r\n                    case 'webp':\r\n                        mimeType = 'image/webp';\r\n                        break;\r\n                    case 'png':\r\n                        mimeType = 'image/png';\r\n                        qualityValue = undefined;\r\n                        break;\r\n                    case 'avif':\r\n                        mimeType = 'image/avif';\r\n                        break;\r\n                    case 'jpg':\r\n                    case 'jpeg':\r\n                    default:\r\n                        mimeType = 'image/jpeg';\r\n                }\r\n\r\n                if (hasTransparency && (format === 'jpg' || format === 'jpeg')) {\r\n                    const tempCanvas = document.createElement('canvas');\r\n                    tempCanvas.width = dimensions.width;\r\n                    tempCanvas.height = dimensions.height;\r\n                    const tempCtx = tempCanvas.getContext('2d');\r\n                    tempCtx.fillStyle = 'white';\r\n                    tempCtx.fillRect(0, 0, dimensions.width, dimensions.height);\r\n                    tempCtx.drawImage(img, 0, 0);\r\n\r\n                    tempCanvas.toBlob(\r\n                        (blob) => {\r\n                            if (!blob) {\r\n                                reject(new Error('Failed to create blob'));\r\n                                return;\r\n                            }\r\n\r\n                            const optimizedFile = new File(\r\n                                [blob],\r\n                                `${file.name.replace(/\\.[^/.]+$/, '')}.${format.toLowerCase()}`,\r\n                                { type: mimeType }\r\n                            );\r\n                            URL.revokeObjectURL(img.src);\r\n                            resolve(optimizedFile);\r\n                        },\r\n                        mimeType,\r\n                        qualityValue\r\n                    );\r\n                } else {\r\n                    canvas.toBlob(\r\n                        (blob) => {\r\n                            if (!blob) {\r\n                                reject(new Error('Failed to create blob'));\r\n                                return;\r\n                            }\r\n\r\n                            const optimizedFile = new File(\r\n                                [blob],\r\n                                `${file.name.replace(/\\.[^/.]+$/, '')}.${format.toLowerCase()}`,\r\n                                { type: mimeType }\r\n                            );\r\n                            URL.revokeObjectURL(img.src);\r\n                            resolve(optimizedFile);\r\n                        },\r\n                        mimeType,\r\n                        qualityValue\r\n                    );\r\n                }\r\n            } catch (error) {\r\n                URL.revokeObjectURL(img.src);\r\n                reject(new Error(`Optimization failed: ${error.message}`));\r\n            }\r\n        };\r\n\r\n        img.onerror = reject;\r\n        img.src = URL.createObjectURL(file);\r\n    });\r\n}\r\n\r\n/**\r\n * Process single file through task pipeline\r\n */\r\nexport async function processSingleFile(file, task, index) {\r\n    console.log('processSingleFile called with:', {\r\n        fileType: file?.constructor?.name,\r\n        isLemGendImage: isLemGendImage(file),\r\n        hasFileProperty: !!(file?.file),\r\n        filePropertyType: file?.file?.constructor?.name\r\n    });\r\n\r\n    let lemGendImage;\r\n\r\n    try {\r\n        // Dynamically import LemGendImage to avoid circular dependency\r\n        const { LemGendImage } = await import('../LemGendImage.js');\r\n\r\n        if (isLemGendImage(file)) {\r\n            lemGendImage = file;\r\n\r\n            console.log('Using existing LemGendImage:', {\r\n                hasFile: !!lemGendImage.file,\r\n                fileType: lemGendImage.file?.constructor?.name,\r\n                width: lemGendImage.width,\r\n                height: lemGendImage.height,\r\n                originalName: lemGendImage.originalName\r\n            });\r\n\r\n            if (!lemGendImage.file || !(lemGendImage.file instanceof File)) {\r\n                console.warn('LemGendImage missing valid file property, attempting to reconstruct...');\r\n                if (lemGendImage.originalName && lemGendImage.originalSize) {\r\n                    const placeholderBlob = new Blob([''], {\r\n                        type: lemGendImage.metadata?.type || 'image/jpeg'\r\n                    });\r\n                    const reconstructedFile = new File(\r\n                        [placeholderBlob],\r\n                        lemGendImage.originalName,\r\n                        {\r\n                            type: lemGendImage.metadata?.type || 'image/jpeg',\r\n                            lastModified: Date.now()\r\n                        }\r\n                    );\r\n                    lemGendImage.file = reconstructedFile;\r\n                } else {\r\n                    throw new Error('LemGendImage has no valid file property and cannot be reconstructed');\r\n                }\r\n            }\r\n\r\n            if (!lemGendImage.width || !lemGendImage.height) {\r\n                try {\r\n                    console.log('LemGendImage missing dimensions, loading...');\r\n                    await lemGendImage.load();\r\n                } catch (loadError) {\r\n                    console.warn('Failed to load existing LemGendImage:', loadError);\r\n                    lemGendImage.width = lemGendImage.width || 1000;\r\n                    lemGendImage.height = lemGendImage.height || 1000;\r\n                }\r\n            }\r\n\r\n        } else if (file && file.file && file.file instanceof File) {\r\n            console.log('Creating new LemGendImage from file object...');\r\n            lemGendImage = new LemGendImage(file.file);\r\n            try {\r\n                await lemGendImage.load();\r\n            } catch (loadError) {\r\n                console.warn('Failed to load image, using defaults:', loadError);\r\n                lemGendImage.width = lemGendImage.width || 1000;\r\n                lemGendImage.height = lemGendImage.height || 1000;\r\n            }\r\n\r\n        } else if (file instanceof File || file instanceof Blob) {\r\n            console.log('Creating new LemGendImage from File/Blob...');\r\n            lemGendImage = new LemGendImage(file);\r\n            try {\r\n                await lemGendImage.load();\r\n            } catch (loadError) {\r\n                console.warn('Failed to load image, using defaults:', loadError);\r\n                lemGendImage.width = lemGendImage.width || 1000;\r\n                lemGendImage.height = lemGendImage.height || 1000;\r\n            }\r\n\r\n        } else {\r\n            throw new Error(`Invalid file type provided for processing. Got: ${typeof file}, constructor: ${file?.constructor?.name}`);\r\n        }\r\n\r\n        if (!lemGendImage || !isLemGendImage(lemGendImage)) {\r\n            throw new Error('Failed to create valid LemGendImage instance');\r\n        }\r\n\r\n        if (!lemGendImage.file || !(lemGendImage.file instanceof File)) {\r\n            console.warn('LemGendImage missing file property, creating placeholder...');\r\n            const placeholderBlob = new Blob([''], { type: 'image/jpeg' });\r\n            lemGendImage.file = new File([placeholderBlob], lemGendImage.originalName || 'image.jpg', {\r\n                type: 'image/jpeg',\r\n                lastModified: Date.now()\r\n            });\r\n        }\r\n\r\n        if (!lemGendImage.width || !lemGendImage.height) {\r\n            console.warn('LemGendImage missing dimensions, setting defaults...');\r\n            lemGendImage.width = lemGendImage.width || 1000;\r\n            lemGendImage.height = lemGendImage.height || 1000;\r\n        }\r\n\r\n        console.log('Validating task with LemGendImage...', {\r\n            originalName: lemGendImage.originalName,\r\n            width: lemGendImage.width,\r\n            height: lemGendImage.height,\r\n            hasFile: !!lemGendImage.file,\r\n            fileType: lemGendImage.file?.constructor?.name\r\n        });\r\n\r\n        try {\r\n            const validation = await validateTask(task, lemGendImage);\r\n\r\n            if (!validation.isValid) {\r\n                const errorMessage = validation.errors.map(e => e.message).join(', ');\r\n                console.warn('Task validation warnings:', errorMessage);\r\n            }\r\n        } catch (validationError) {\r\n            console.warn('Task validation threw an error, continuing anyway:', validationError);\r\n        }\r\n\r\n        console.log('Task validation passed (or warnings ignored), proceeding with processing...');\r\n\r\n        const enabledSteps = task.getEnabledSteps();\r\n        let currentFile = lemGendImage.file;\r\n        let currentDimensions = {\r\n            width: lemGendImage.width,\r\n            height: lemGendImage.height\r\n        };\r\n\r\n        const processingOrder = ['resize', 'crop', 'optimize', 'rename'];\r\n        const sortedSteps = enabledSteps.sort((a, b) => {\r\n            const indexA = processingOrder.indexOf(a.processor);\r\n            const indexB = processingOrder.indexOf(b.processor);\r\n            return indexA - indexB;\r\n        });\r\n\r\n        console.log('Processing steps in order:', sortedSteps.map(s => `${s.order}.${s.processor}`));\r\n        console.log('Starting image dimensions:', currentDimensions);\r\n\r\n        for (const step of sortedSteps) {\r\n            try {\r\n                console.log(`\\n=== Processing step ${step.order}: ${step.processor} ===`);\r\n\r\n                switch (step.processor) {\r\n                    case 'resize':\r\n                        const resizeProcessor = new LemGendaryResize(step.options);\r\n                        const resizeResult = await resizeProcessor.process(lemGendImage);\r\n\r\n                        console.log('Resize result:', {\r\n                            original: `${resizeResult.originalDimensions.width}x${resizeResult.originalDimensions.height}`,\r\n                            target: `${resizeResult.newDimensions.width}x${resizeResult.newDimensions.height}`,\r\n                            mode: step.options.mode,\r\n                            dimension: step.options.dimension\r\n                        });\r\n\r\n                        currentFile = await actuallyResizeImage(\r\n                            currentFile,\r\n                            resizeResult.newDimensions.width,\r\n                            resizeResult.newDimensions.height,\r\n                            step.options.algorithm || 'lanczos3'\r\n                        );\r\n\r\n                        currentDimensions = resizeResult.newDimensions;\r\n                        lemGendImage.updateDimensions(currentDimensions.width, currentDimensions.height);\r\n                        lemGendImage.addOperation('resize', resizeResult);\r\n\r\n                        console.log(` Resized to: ${currentDimensions.width}x${currentDimensions.height}`);\r\n                        console.log('File after resize:', {\r\n                            name: currentFile.name,\r\n                            size: currentFile.size,\r\n                            type: currentFile.type\r\n                        });\r\n                        break;\r\n\r\n                    case 'crop':\r\n                        const cropProcessor = new LemGendaryCrop(step.options);\r\n                        const cropResult = await cropProcessor.process(lemGendImage, currentDimensions);\r\n\r\n                        console.log('Crop result:', {\r\n                            current: `${currentDimensions.width}x${currentDimensions.height}`,\r\n                            target: `${cropResult.finalDimensions.width}x${cropResult.finalDimensions.height}`,\r\n                            mode: step.options.mode,\r\n                            smartCrop: cropResult.smartCrop\r\n                        });\r\n\r\n                        if (cropResult.smartCrop) {\r\n                            console.log('Smart crop detected with steps:', {\r\n                                detection: cropResult.steps.detection.confidence,\r\n                                resize: cropResult.steps.resize,\r\n                                crop: cropResult.cropOffsets\r\n                            });\r\n                        }\r\n\r\n                        currentFile = await actuallyCropImage(\r\n                            currentFile,\r\n                            currentDimensions.width,\r\n                            currentDimensions.height,\r\n                            cropResult.cropOffsets.width,\r\n                            cropResult.cropOffsets.height,\r\n                            cropResult.cropOffsets.x,\r\n                            cropResult.cropOffsets.y\r\n                        );\r\n\r\n                        currentDimensions = cropResult.finalDimensions;\r\n                        lemGendImage.updateDimensions(currentDimensions.width, currentDimensions.height);\r\n                        lemGendImage.addOperation('crop', cropResult);\r\n\r\n                        console.log(` Cropped to: ${currentDimensions.width}x${currentDimensions.height}`);\r\n                        console.log('File after crop:', {\r\n                            name: currentFile.name,\r\n                            size: currentFile.size,\r\n                            type: currentFile.type\r\n                        });\r\n                        break;\r\n\r\n                    case 'optimize':\r\n                        const optimizeProcessor = new LemGendaryOptimize(step.options);\r\n                        const optimizeResult = await optimizeProcessor.process(lemGendImage);\r\n\r\n                        console.log('Optimize result:', {\r\n                            format: step.options.format,\r\n                            quality: step.options.quality,\r\n                            originalFormat: optimizeResult.originalInfo.format,\r\n                            transparency: optimizeResult.originalInfo.transparency,\r\n                            savings: optimizeResult.savings\r\n                        });\r\n\r\n                        // Get the optimize method - check for both possible method names\r\n                        const optimizeMethod = optimizeProcessor.applyOptimization || optimizeProcessor.optimize;\r\n                        if (!optimizeMethod) {\r\n                            throw new Error('Optimize processor missing applyOptimization or optimize method');\r\n                        }\r\n\r\n                        currentFile = await optimizeMethod.call(optimizeProcessor, lemGendImage);\r\n\r\n                        lemGendImage.addOperation('optimize', optimizeResult);\r\n                        console.log(` Optimized to: ${optimizeResult.optimization.selectedFormat} at ${optimizeResult.optimization.compression.quality}%`);\r\n                        console.log('File after optimize:', {\r\n                            name: currentFile.name,\r\n                            size: currentFile.size,\r\n                            type: currentFile.type,\r\n                            savings: `${optimizeResult.savings.savingsPercent}%`\r\n                        });\r\n                        break;\r\n\r\n                    case 'rename':\r\n                        const renameProcessor = new LemGendaryRename(step.options);\r\n                        const renameResult = await renameProcessor.process(lemGendImage, index, task.steps.length);\r\n\r\n                        const extension = getFileExtension(currentFile);\r\n\r\n                        const renamedFile = new File(\r\n                            [currentFile],\r\n                            `${renameResult.newName}.${extension}`,\r\n                            { type: currentFile.type }\r\n                        );\r\n\r\n                        currentFile = renamedFile;\r\n                        lemGendImage.addOperation('rename', renameResult);\r\n                        console.log(` Renamed to: ${renameResult.newName}.${extension}`);\r\n                        break;\r\n\r\n                    default:\r\n                        console.warn(`Unknown processor: ${step.processor}`);\r\n                }\r\n            } catch (error) {\r\n                console.error(`Error in step ${step.order} (${step.processor}):`, error);\r\n                throw new Error(`Step ${step.order} (${step.processor}) failed: ${error.message}`);\r\n            }\r\n        }\r\n\r\n        const outputFormat = getFileExtension(currentFile);\r\n        lemGendImage.addOutput(\r\n            outputFormat,\r\n            currentFile,\r\n            null\r\n        );\r\n\r\n        console.log('\\n=== Processing Complete ===');\r\n        console.log('Final result:', {\r\n            originalName: lemGendImage.originalName,\r\n            finalName: currentFile.name,\r\n            originalSize: lemGendImage.originalSize,\r\n            finalSize: currentFile.size,\r\n            dimensions: `${currentDimensions.width}x${currentDimensions.height}`,\r\n            format: outputFormat,\r\n            sizeReduction: `${((lemGendImage.originalSize - currentFile.size) / lemGendImage.originalSize * 100).toFixed(1)}%`\r\n        });\r\n\r\n        return {\r\n            image: lemGendImage,\r\n            file: currentFile,\r\n            success: true,\r\n            metadata: lemGendImage.getInfo()\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error('Error in processSingleFile:', error);\r\n        return {\r\n            image: lemGendImage || file,\r\n            file: lemGendImage?.file || file,\r\n            error: error.message,\r\n            success: false\r\n        };\r\n    }\r\n}\r\n\r\n// Default export\r\nexport default {\r\n    actuallyResizeImage,\r\n    actuallyCropImage,\r\n    applyOptimization,\r\n    processSingleFile,\r\n    isLemGendImage,\r\n    getImageOutputs\r\n};","/**\r\n * LemGendaryOptimize - Intelligent image optimization processor\r\n * @class\r\n */\r\n\r\n// Import processing utils statically\r\nimport { applyOptimization as applyOptimizationUtil } from '../utils/processingUtils.js';\r\n\r\nexport class LemGendaryOptimize {\r\n    /**\r\n     * Create a new LemGendaryOptimize processor\r\n     * @param {Object} options - Optimization options\r\n     */\r\n    constructor(options = {}) {\r\n        this.options = {\r\n            quality: 85,\r\n            format: 'auto',\r\n            lossless: false,\r\n            stripMetadata: true,\r\n            preserveTransparency: true,\r\n            maxDisplayWidth: null,\r\n            browserSupport: ['modern', 'legacy'],\r\n            compressionMode: 'adaptive',\r\n            analyzeContent: true,\r\n            icoSizes: [16, 32, 48, 64, 128, 256],\r\n            ...options\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Process an image with optimization\r\n     * @param {LemGendImage} image - Image to process\r\n     * @returns {Promise<Object>} Optimization result\r\n     */\r\n    async process(image) {\r\n        if (!image || !image.file) {\r\n            throw new Error('Invalid image or missing file');\r\n        }\r\n\r\n        const originalInfo = {\r\n            format: image.extension,\r\n            width: image.width,\r\n            height: image.height,\r\n            size: image.originalSize,\r\n            transparency: image.transparency,\r\n            mimeType: image.type\r\n        };\r\n\r\n        const selectedFormat = this.selectOptimalFormat(image);\r\n        const compression = this.calculateCompressionSettings(image);\r\n\r\n        const savings = this.estimateSavings(\r\n            image.originalSize,\r\n            selectedFormat,\r\n            compression.quality\r\n        );\r\n\r\n        return {\r\n            originalInfo,\r\n            optimization: {\r\n                selectedFormat,\r\n                compression,\r\n                browserSupport: this.options.browserSupport,\r\n                mode: this.options.compressionMode\r\n            },\r\n            savings,\r\n            recommendations: this.generateRecommendations(image, selectedFormat),\r\n            timestamp: new Date().toISOString()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Apply optimization to image\r\n     * @param {LemGendImage} image - Image to optimize\r\n     * @returns {Promise<File>} Optimized file\r\n     */\r\n    async applyOptimization(image) {\r\n        const { selectedFormat } = await this.process(image);\r\n\r\n        const dimensions = {\r\n            width: image.width,\r\n            height: image.height\r\n        };\r\n\r\n        return applyOptimizationUtil(\r\n            image.file,\r\n            dimensions,\r\n            {\r\n                quality: this.options.quality,\r\n                format: selectedFormat,\r\n                lossless: this.options.lossless\r\n            },\r\n            image.transparency\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Select optimal format based on image characteristics\r\n     * @private\r\n     */\r\n    selectOptimalFormat(image) {\r\n        if (this.options.format !== 'auto') {\r\n            return this.options.format;\r\n        }\r\n\r\n        // Auto selection logic\r\n        if (image.extension === 'svg') return 'svg';\r\n        if (image.type.includes('icon')) return 'ico';\r\n\r\n        if (image.transparency) {\r\n            return 'webp'; // WebP supports transparency\r\n        }\r\n\r\n        // For large images, consider AVIF\r\n        if (image.width * image.height > 1000000) {\r\n            return this.options.browserSupport.includes('modern') ? 'avif' : 'webp';\r\n        }\r\n\r\n        return 'webp'; // Default to WebP\r\n    }\r\n\r\n    /**\r\n     * Calculate compression settings\r\n     * @private\r\n     */\r\n    calculateCompressionSettings(image) {\r\n        let quality = this.options.quality;\r\n\r\n        // Adjust quality based on compression mode\r\n        switch (this.options.compressionMode) {\r\n            case 'aggressive':\r\n                quality = Math.max(40, quality - 20);\r\n                break;\r\n            case 'balanced':\r\n                // Keep as is\r\n                break;\r\n            case 'adaptive':\r\n                // Adaptive quality based on image characteristics\r\n                if (image.width * image.height > 2000000) {\r\n                    quality = Math.max(60, quality - 10);\r\n                }\r\n                break;\r\n        }\r\n\r\n        // AVIF has different quality scale\r\n        const selectedFormat = this.selectOptimalFormat(image);\r\n        if (selectedFormat === 'avif') {\r\n            quality = Math.min(63, quality);\r\n        }\r\n\r\n        return {\r\n            quality,\r\n            mode: this.options.compressionMode,\r\n            lossless: this.options.lossless,\r\n            stripMetadata: this.options.stripMetadata\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Estimate savings from optimization\r\n     * @private\r\n     */\r\n    estimateSavings(originalSize, format, quality) {\r\n        let estimatedSize = originalSize;\r\n\r\n        // Format reduction factors\r\n        const formatFactors = {\r\n            'webp': 0.7,\r\n            'avif': 0.6,\r\n            'jpg': 0.8,\r\n            'png': 0.9,\r\n            'svg': 0.3,\r\n            'ico': 0.95\r\n        };\r\n\r\n        estimatedSize *= formatFactors[format] || 0.8;\r\n        estimatedSize *= (quality / 100);\r\n\r\n        const savings = originalSize - estimatedSize;\r\n        const savingsPercent = (savings / originalSize) * 100;\r\n\r\n        return {\r\n            originalSize,\r\n            estimatedSize: Math.round(estimatedSize),\r\n            savings: Math.round(savings),\r\n            savingsPercent: Math.round(savingsPercent * 10) / 10\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Generate optimization recommendations\r\n     * @private\r\n     */\r\n    generateRecommendations(image, selectedFormat) {\r\n        const recommendations = [];\r\n\r\n        if (image.extension !== selectedFormat) {\r\n            recommendations.push(`Convert from ${image.extension} to ${selectedFormat}`);\r\n        }\r\n\r\n        if (image.width > 1920 || image.height > 1080) {\r\n            recommendations.push('Consider resizing for web display');\r\n        }\r\n\r\n        if (image.transparency && selectedFormat === 'jpg') {\r\n            recommendations.push('JPEG format does not support transparency - consider PNG or WebP');\r\n        }\r\n\r\n        return recommendations;\r\n    }\r\n\r\n    /**\r\n     * Prepare images for ZIP export\r\n     */\r\n    async prepareForZip(images) {\r\n        const results = [];\r\n\r\n        for (const image of images) {\r\n            try {\r\n                const optimizationResult = await this.process(image);\r\n                const optimizedFile = await this.applyOptimization(image);\r\n\r\n                results.push({\r\n                    success: true,\r\n                    original: {\r\n                        name: image.originalName,\r\n                        size: image.originalSize,\r\n                        format: image.extension\r\n                    },\r\n                    optimized: optimizedFile,\r\n                    optimization: optimizationResult\r\n                });\r\n            } catch (error) {\r\n                results.push({\r\n                    success: false,\r\n                    original: {\r\n                        name: image.originalName,\r\n                        size: image.originalSize\r\n                    },\r\n                    error: error.message\r\n                });\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Generate optimization report\r\n     */\r\n    generateOptimizationReport(results) {\r\n        const successful = results.filter(r => r.success);\r\n        const failed = results.filter(r => !r.success);\r\n\r\n        const totalOriginalSize = successful.reduce((sum, r) => sum + r.original.size, 0);\r\n        const totalOptimizedSize = successful.reduce((sum, r) => sum + r.optimized.size, 0);\r\n        const totalSavings = totalOriginalSize - totalOptimizedSize;\r\n        const avgSavingsPercent = successful.length > 0\r\n            ? (totalSavings / totalOriginalSize * 100)\r\n            : 0;\r\n\r\n        return {\r\n            summary: {\r\n                totalImages: results.length,\r\n                successful: successful.length,\r\n                failed: failed.length,\r\n                totalOriginalSize,\r\n                totalOptimizedSize,\r\n                totalSavings,\r\n                avgSavingsPercent: Math.round(avgSavingsPercent * 10) / 10\r\n            },\r\n            byFormat: this.groupByFormat(successful),\r\n            failedImages: failed.map(f => ({\r\n                name: f.original.name,\r\n                error: f.error\r\n            })),\r\n            timestamp: new Date().toISOString()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Group results by format\r\n     * @private\r\n     */\r\n    groupByFormat(results) {\r\n        const groups = {};\r\n\r\n        results.forEach(result => {\r\n            const format = result.optimization.optimization.selectedFormat;\r\n            if (!groups[format]) {\r\n                groups[format] = {\r\n                    count: 0,\r\n                    totalOriginalSize: 0,\r\n                    totalOptimizedSize: 0\r\n                };\r\n            }\r\n\r\n            groups[format].count++;\r\n            groups[format].totalOriginalSize += result.original.size;\r\n            groups[format].totalOptimizedSize += result.optimized.size;\r\n        });\r\n\r\n        return groups;\r\n    }\r\n\r\n    /**\r\n     * Get processor information\r\n     * @returns {Object} Processor info\r\n     */\r\n    getInfo() {\r\n        return {\r\n            name: 'LemGendaryOptimize',\r\n            version: '2.0.0',\r\n            description: 'Intelligent image optimization with format selection',\r\n            formats: ['auto', 'webp', 'avif', 'jpg', 'png', 'svg', 'ico'],\r\n            compressionModes: ['adaptive', 'aggressive', 'balanced'],\r\n            browserSupport: ['modern', 'legacy', 'all']\r\n        };\r\n    }\r\n}\r\n\r\nexport default LemGendaryOptimize;","export default [\r\n    // Instagram\r\n    {\r\n        \"id\": \"instagram-profile\",\r\n        \"name\": \"InstagramProfile\",\r\n        \"displayName\": \"Profile Picture\",\r\n        \"width\": 320,\r\n        \"height\": 320,\r\n        \"platform\": \"instagram\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fab fa-instagram\",\r\n        \"description\": \"Instagram profile picture (displays as circular 110110 in app)\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"webp\"\r\n        ],\r\n        \"maxFileSize\": \"100KB\",\r\n        \"notes\": \"Upload at 320320 for best quality, will be cropped to circle\"\r\n    },\r\n    {\r\n        \"id\": \"instagram-square\",\r\n        \"name\": \"InstagramSquare\",\r\n        \"displayName\": \"Square Post\",\r\n        \"width\": 1080,\r\n        \"height\": 1080,\r\n        \"platform\": \"instagram\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-square\",\r\n        \"description\": \"Instagram square photo/video posts\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"webp\"\r\n        ],\r\n        \"maxFileSize\": \"8MB\",\r\n        \"notes\": \"Optimal for grid view, displays at 600600\"\r\n    },\r\n    {\r\n        \"id\": \"instagram-portrait\",\r\n        \"name\": \"InstagramPortrait\",\r\n        \"displayName\": \"Portrait Post\",\r\n        \"width\": 1080,\r\n        \"height\": 1350,\r\n        \"platform\": \"instagram\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-portrait\",\r\n        \"description\": \"Instagram portrait (vertical) posts\",\r\n        \"aspectRatio\": \"4:5\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"webp\"\r\n        ],\r\n        \"maxFileSize\": \"8MB\",\r\n        \"notes\": \"Takes more space in feed, good for full-body shots\"\r\n    },\r\n    {\r\n        \"id\": \"instagram-landscape\",\r\n        \"name\": \"InstagramLandscape\",\r\n        \"displayName\": \"Landscape Post\",\r\n        \"width\": 1080,\r\n        \"height\": 566,\r\n        \"platform\": \"instagram\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-landscape\",\r\n        \"description\": \"Instagram landscape (horizontal) posts\",\r\n        \"aspectRatio\": \"1.91:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"webp\"\r\n        ],\r\n        \"maxFileSize\": \"8MB\",\r\n        \"notes\": \"Good for group photos and scenery\"\r\n    },\r\n    {\r\n        \"id\": \"instagram-stories\",\r\n        \"name\": \"InstagramStoriesReels\",\r\n        \"displayName\": \"Stories & Reels\",\r\n        \"width\": 1080,\r\n        \"height\": 1920,\r\n        \"platform\": \"instagram\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-film\",\r\n        \"description\": \"Instagram Stories, Reels, and IGTV covers\",\r\n        \"aspectRatio\": \"9:16\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"webp\"\r\n        ],\r\n        \"maxFileSize\": \"4MB\",\r\n        \"notes\": \"Full-screen vertical format, safe area: center 10801420\"\r\n    },\r\n\r\n    // Facebook\r\n    {\r\n        \"id\": \"facebook-profile\",\r\n        \"name\": \"FacebookProfile\",\r\n        \"displayName\": \"Profile Picture\",\r\n        \"width\": 180,\r\n        \"height\": 180,\r\n        \"platform\": \"facebook\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fab fa-facebook\",\r\n        \"description\": \"Facebook profile picture (displays as 170170 on desktop)\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Minimum 180180, displays as circular\"\r\n    },\r\n    {\r\n        \"id\": \"facebook-cover\",\r\n        \"name\": \"FacebookCoverBanner\",\r\n        \"displayName\": \"Cover Photo\",\r\n        \"width\": 851,\r\n        \"height\": 315,\r\n        \"platform\": \"facebook\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-panorama\",\r\n        \"description\": \"Facebook page and profile cover photo\",\r\n        \"aspectRatio\": \"~2.7:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"100KB\",\r\n        \"notes\": \"Displays as 820312 on desktop, mobile crops sides\"\r\n    },\r\n    {\r\n        \"id\": \"facebook-shared\",\r\n        \"name\": \"FacebookSharedImage\",\r\n        \"displayName\": \"Shared Image\",\r\n        \"width\": 1200,\r\n        \"height\": 630,\r\n        \"platform\": \"facebook\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-share-alt\",\r\n        \"description\": \"Optimal size for shared links and images in feed\",\r\n        \"aspectRatio\": \"1.91:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"8MB\",\r\n        \"notes\": \"Ideal for link previews and engagement\"\r\n    },\r\n    {\r\n        \"id\": \"facebook-square\",\r\n        \"name\": \"FacebookSquarePost\",\r\n        \"displayName\": \"Square Post\",\r\n        \"width\": 1200,\r\n        \"height\": 1200,\r\n        \"platform\": \"facebook\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-square\",\r\n        \"description\": \"Facebook square post images\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"8MB\",\r\n        \"notes\": \"Good for product shots and albums\"\r\n    },\r\n    {\r\n        \"id\": \"facebook-stories\",\r\n        \"name\": \"FacebookStories\",\r\n        \"displayName\": \"Facebook Stories\",\r\n        \"width\": 1080,\r\n        \"height\": 1920,\r\n        \"platform\": \"facebook\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-scroll\",\r\n        \"description\": \"Facebook Stories (full-screen vertical)\",\r\n        \"aspectRatio\": \"9:16\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"4MB\",\r\n        \"notes\": \"Same as Instagram Stories format\"\r\n    },\r\n\r\n    // Twitter/X\r\n    {\r\n        \"id\": \"twitter-profile\",\r\n        \"name\": \"XProfile\",\r\n        \"displayName\": \"Profile Picture\",\r\n        \"width\": 400,\r\n        \"height\": 400,\r\n        \"platform\": \"twitter\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fab fa-twitter\",\r\n        \"description\": \"Twitter/X profile picture (displays as 200200)\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"2MB\",\r\n        \"notes\": \"Upload at 400400, displays as circular\"\r\n    },\r\n    {\r\n        \"id\": \"twitter-header\",\r\n        \"name\": \"XHeaderBanner\",\r\n        \"displayName\": \"Header Banner\",\r\n        \"width\": 1500,\r\n        \"height\": 500,\r\n        \"platform\": \"twitter\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-panorama\",\r\n        \"description\": \"Twitter/X header banner\",\r\n        \"aspectRatio\": \"3:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Minimum 1500500, important content in center\"\r\n    },\r\n    {\r\n        \"id\": \"twitter-landscape\",\r\n        \"name\": \"XLandscapePost\",\r\n        \"displayName\": \"Landscape Post\",\r\n        \"width\": 1600,\r\n        \"height\": 900,\r\n        \"platform\": \"twitter\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-id-card\",\r\n        \"description\": \"Twitter/X landscape image in tweet\",\r\n        \"aspectRatio\": \"16:9\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Optimal for screenshots and wide images\"\r\n    },\r\n    {\r\n        \"id\": \"twitter-square\",\r\n        \"name\": \"XSquarePost\",\r\n        \"displayName\": \"Square Post\",\r\n        \"width\": 1080,\r\n        \"height\": 1080,\r\n        \"platform\": \"twitter\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-square\",\r\n        \"description\": \"Twitter/X square image in tweet\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Good for product images and infographics\"\r\n    },\r\n    {\r\n        \"id\": \"twitter-portrait\",\r\n        \"name\": \"XPortraitPost\",\r\n        \"displayName\": \"Portrait Post\",\r\n        \"width\": 1080,\r\n        \"height\": 1350,\r\n        \"platform\": \"twitter\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-portrait\",\r\n        \"description\": \"Twitter/X portrait (vertical) image\",\r\n        \"aspectRatio\": \"4:5\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Similar to Instagram portrait format\"\r\n    },\r\n\r\n    // LinkedIn\r\n    {\r\n        \"id\": \"linkedin-profile\",\r\n        \"name\": \"LinkedInProfile\",\r\n        \"displayName\": \"Profile Picture\",\r\n        \"width\": 400,\r\n        \"height\": 400,\r\n        \"platform\": \"linkedin\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fab fa-linkedin\",\r\n        \"description\": \"LinkedIn profile picture (displays as circular)\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"8MB\",\r\n        \"notes\": \"Upload at 400400, minimum 300300\"\r\n    },\r\n    {\r\n        \"id\": \"linkedin-cover\",\r\n        \"name\": \"LinkedInPersonalCover\",\r\n        \"displayName\": \"Personal Cover Photo\",\r\n        \"width\": 1584,\r\n        \"height\": 396,\r\n        \"platform\": \"linkedin\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-panorama\",\r\n        \"description\": \"LinkedIn personal profile cover photo\",\r\n        \"aspectRatio\": \"4:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"8MB\",\r\n        \"notes\": \"Displays as 1400425, keep important content centered\"\r\n    },\r\n    {\r\n        \"id\": \"linkedin-landscape\",\r\n        \"name\": \"LinkedInLandscapePost\",\r\n        \"displayName\": \"Landscape Post\",\r\n        \"width\": 1200,\r\n        \"height\": 627,\r\n        \"platform\": \"linkedin\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-id-card\",\r\n        \"description\": \"LinkedIn landscape post images\",\r\n        \"aspectRatio\": \"1.91:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Optimal for shared links and articles\"\r\n    },\r\n    {\r\n        \"id\": \"linkedin-square\",\r\n        \"name\": \"LinkedInSquarePost\",\r\n        \"displayName\": \"Square Post\",\r\n        \"width\": 1200,\r\n        \"height\": 1200,\r\n        \"platform\": \"linkedin\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-square\",\r\n        \"description\": \"LinkedIn square post images\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Good for infographics and product images\"\r\n    },\r\n    {\r\n        \"id\": \"linkedin-portrait\",\r\n        \"name\": \"LinkedInPortraitPost\",\r\n        \"displayName\": \"Portrait Post\",\r\n        \"width\": 720,\r\n        \"height\": 900,\r\n        \"platform\": \"linkedin\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-portrait\",\r\n        \"description\": \"LinkedIn portrait (vertical) post images\",\r\n        \"aspectRatio\": \"4:5\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Less common but supported format\"\r\n    },\r\n\r\n    // YouTube\r\n    {\r\n        \"id\": \"youtube-channel\",\r\n        \"name\": \"YouTubeChannelIcon\",\r\n        \"displayName\": \"Channel Icon\",\r\n        \"width\": 800,\r\n        \"height\": 800,\r\n        \"platform\": \"youtube\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fab fa-youtube\",\r\n        \"description\": \"YouTube channel profile picture\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"2MB\",\r\n        \"notes\": \"Displays as 9898 in most places\"\r\n    },\r\n    {\r\n        \"id\": \"youtube-banner\",\r\n        \"name\": \"YouTubeBanner\",\r\n        \"displayName\": \"Channel Banner\",\r\n        \"width\": 2048,\r\n        \"height\": 1152,\r\n        \"platform\": \"youtube\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-panorama\",\r\n        \"description\": \"YouTube channel banner/header\",\r\n        \"aspectRatio\": \"16:9\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"6MB\",\r\n        \"notes\": \"Safe area for mobile: 1546423, important content centered\"\r\n    },\r\n    {\r\n        \"id\": \"youtube-thumbnail\",\r\n        \"name\": \"YouTubeThumbnail\",\r\n        \"displayName\": \"Video Thumbnail\",\r\n        \"width\": 1280,\r\n        \"height\": 720,\r\n        \"platform\": \"youtube\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-video\",\r\n        \"description\": \"YouTube video thumbnail\",\r\n        \"aspectRatio\": \"16:9\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"2MB\",\r\n        \"notes\": \"Minimum 640480, 16:9 recommended for all devices\"\r\n    },\r\n\r\n    // Pinterest\r\n    {\r\n        \"id\": \"pinterest-profile\",\r\n        \"name\": \"PinterestProfile\",\r\n        \"displayName\": \"Profile Picture\",\r\n        \"width\": 165,\r\n        \"height\": 165,\r\n        \"platform\": \"pinterest\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fab fa-pinterest\",\r\n        \"description\": \"Pinterest profile picture (displays as circular)\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"10MB\",\r\n        \"notes\": \"Upload at 165165, displays as circular\"\r\n    },\r\n    {\r\n        \"id\": \"pinterest-standard\",\r\n        \"name\": \"PinterestStandardPin\",\r\n        \"displayName\": \"Standard Pin\",\r\n        \"width\": 1000,\r\n        \"height\": 1500,\r\n        \"platform\": \"pinterest\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-thumbtack\",\r\n        \"description\": \"Pinterest standard vertical pin\",\r\n        \"aspectRatio\": \"2:3\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"10MB\",\r\n        \"notes\": \"Height should be 1.22.5 times the width for optimal display\"\r\n    },\r\n    {\r\n        \"id\": \"pinterest-square\",\r\n        \"name\": \"PinterestSquarePin\",\r\n        \"displayName\": \"Square Pin\",\r\n        \"width\": 1000,\r\n        \"height\": 1000,\r\n        \"platform\": \"pinterest\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-square\",\r\n        \"description\": \"Pinterest square pin\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"10MB\",\r\n        \"notes\": \"Good for infographics and step-by-step guides\"\r\n    },\r\n    {\r\n        \"id\": \"pinterest-story\",\r\n        \"name\": \"PinterestStoryPin\",\r\n        \"displayName\": \"Story Pin\",\r\n        \"width\": 1080,\r\n        \"height\": 1920,\r\n        \"platform\": \"pinterest\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-scroll\",\r\n        \"description\": \"Pinterest Story pin (full-screen vertical)\",\r\n        \"aspectRatio\": \"9:16\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"10MB\",\r\n        \"notes\": \"Similar format to Instagram/Facebook Stories\"\r\n    },\r\n\r\n    // TikTok\r\n    {\r\n        \"id\": \"tiktok-profile\",\r\n        \"name\": \"TikTokProfile\",\r\n        \"displayName\": \"Profile Picture\",\r\n        \"width\": 200,\r\n        \"height\": 200,\r\n        \"platform\": \"tiktok\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fab fa-tiktok\",\r\n        \"description\": \"TikTok profile picture\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Upload at 200200, minimum 2020\"\r\n    },\r\n    {\r\n        \"id\": \"tiktok-video\",\r\n        \"name\": \"TikTokVideoCover\",\r\n        \"displayName\": \"Video Cover\",\r\n        \"width\": 1080,\r\n        \"height\": 1920,\r\n        \"platform\": \"tiktok\",\r\n        \"category\": \"social\",\r\n        \"icon\": \"fas fa-video\",\r\n        \"description\": \"TikTok video cover/thumbnail\",\r\n        \"aspectRatio\": \"9:16\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"5MB\",\r\n        \"notes\": \"Full-screen vertical format, same as video dimensions\"\r\n    }\r\n]","export default [\r\n    {\r\n        \"id\": \"web-hero\",\r\n        \"name\": \"WebHero\",\r\n        \"displayName\": \"Hero Banner\",\r\n        \"width\": 1920,\r\n        \"height\": 1080,\r\n        \"platform\": \"web\",\r\n        \"category\": \"web\",\r\n        \"icon\": \"fas fa-desktop\",\r\n        \"description\": \"Full-width hero banner for websites\",\r\n        \"aspectRatio\": \"16:9\",\r\n        \"recommendedFormats\": [\r\n            \"webp\",\r\n            \"jpg\"\r\n        ],\r\n        \"maxFileSize\": \"200KB\",\r\n        \"notes\": \"Optimize for fast loading, consider responsive breakpoints\"\r\n    },\r\n    {\r\n        \"id\": \"web-blog\",\r\n        \"name\": \"WebBlog\",\r\n        \"displayName\": \"Blog Featured Image\",\r\n        \"width\": 1200,\r\n        \"height\": 630,\r\n        \"platform\": \"web\",\r\n        \"category\": \"web\",\r\n        \"icon\": \"fas fa-blog\",\r\n        \"description\": \"Blog post featured image (Open Graph optimal)\",\r\n        \"aspectRatio\": \"1.91:1\",\r\n        \"recommendedFormats\": [\r\n            \"webp\",\r\n            \"jpg\"\r\n        ],\r\n        \"maxFileSize\": \"100KB\",\r\n        \"notes\": \"Also works for social media sharing previews\"\r\n    },\r\n    {\r\n        \"id\": \"web-content\",\r\n        \"name\": \"WebContent\",\r\n        \"displayName\": \"Content Image\",\r\n        \"width\": 1200,\r\n        \"height\": \"flex\",\r\n        \"platform\": \"web\",\r\n        \"category\": \"web\",\r\n        \"icon\": \"fas fa-image\",\r\n        \"description\": \"General content images within articles/pages\",\r\n        \"aspectRatio\": \"flexible\",\r\n        \"recommendedFormats\": [\r\n            \"webp\",\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"150KB\",\r\n        \"notes\": \"Flexible height that maintains natural aspect ratio\"\r\n    },\r\n    {\r\n        \"id\": \"web-thumb\",\r\n        \"name\": \"WebThumb\",\r\n        \"displayName\": \"Thumbnail\",\r\n        \"width\": 300,\r\n        \"height\": 300,\r\n        \"platform\": \"web\",\r\n        \"category\": \"web\",\r\n        \"icon\": \"fas fa-square\",\r\n        \"description\": \"Small thumbnails for galleries, products, listings\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"webp\",\r\n            \"jpg\"\r\n        ],\r\n        \"maxFileSize\": \"30KB\",\r\n        \"notes\": \"Keep file size small for grid views\"\r\n    },\r\n    {\r\n        \"id\": \"web-card\",\r\n        \"name\": \"WebCard\",\r\n        \"displayName\": \"Card Image\",\r\n        \"width\": 400,\r\n        \"height\": 300,\r\n        \"platform\": \"web\",\r\n        \"category\": \"web\",\r\n        \"icon\": \"fas fa-id-card\",\r\n        \"description\": \"Images for feature cards, product cards, etc.\",\r\n        \"aspectRatio\": \"4:3\",\r\n        \"recommendedFormats\": [\r\n            \"webp\",\r\n            \"jpg\"\r\n        ],\r\n        \"maxFileSize\": \"50KB\",\r\n        \"notes\": \"Common card aspect ratio\"\r\n    },\r\n    {\r\n        \"id\": \"web-og\",\r\n        \"name\": \"WebOpenGraph\",\r\n        \"displayName\": \"Open Graph Image\",\r\n        \"width\": 1200,\r\n        \"height\": 630,\r\n        \"platform\": \"web\",\r\n        \"category\": \"web\",\r\n        \"icon\": \"fas fa-share\",\r\n        \"description\": \"Social sharing preview image\",\r\n        \"aspectRatio\": \"1.91:1\",\r\n        \"recommendedFormats\": [\r\n            \"jpg\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"100KB\",\r\n        \"notes\": \"Essential for social media link sharing\"\r\n    }\r\n]","export default [\r\n    {\r\n        \"id\": \"favicon-basic\",\r\n        \"name\": \"FaviconBasic\",\r\n        \"displayName\": \"Basic Favicon\",\r\n        \"width\": 16,\r\n        \"height\": 16,\r\n        \"platform\": \"favicon\",\r\n        \"category\": \"favicon\",\r\n        \"icon\": \"fas fa-star\",\r\n        \"description\": \"Standard 1616 favicon for browser tabs\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"ico\",\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"1KB\",\r\n        \"notes\": \"Required for most browsers, displays in browser tabs\"\r\n    },\r\n    {\r\n        \"id\": \"favicon-standard\",\r\n        \"name\": \"FaviconStandard\",\r\n        \"displayName\": \"Standard Favicon Set\",\r\n        \"width\": 32,\r\n        \"height\": 32,\r\n        \"platform\": \"favicon\",\r\n        \"category\": \"favicon\",\r\n        \"icon\": \"fas fa-layer-group\",\r\n        \"description\": \"Standard favicon set for desktop browsers\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"ico\"\r\n        ],\r\n        \"maxFileSize\": \"10KB\",\r\n        \"notes\": \"Includes 1616, 3232, 4848 sizes in single .ico file\"\r\n    },\r\n    {\r\n        \"id\": \"favicon-modern\",\r\n        \"name\": \"FaviconModern\",\r\n        \"displayName\": \"Modern Favicon Set\",\r\n        \"width\": 180,\r\n        \"height\": 180,\r\n        \"platform\": \"favicon\",\r\n        \"category\": \"favicon\",\r\n        \"icon\": \"fas fa-mobile-alt\",\r\n        \"description\": \"Complete favicon set for all modern devices\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\",\r\n            \"svg\"\r\n        ],\r\n        \"maxFileSize\": \"30KB\",\r\n        \"notes\": \"Includes iOS home screen, Android, Safari pinned tab, Windows tile\"\r\n    },\r\n    {\r\n        \"id\": \"favicon-apple\",\r\n        \"name\": \"FaviconApple\",\r\n        \"displayName\": \"Apple Touch Icon\",\r\n        \"width\": 180,\r\n        \"height\": 180,\r\n        \"platform\": \"favicon\",\r\n        \"category\": \"favicon\",\r\n        \"icon\": \"fab fa-apple\",\r\n        \"description\": \"Apple devices home screen icon\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"20KB\",\r\n        \"notes\": \"For iOS devices when saving to home screen\"\r\n    },\r\n    {\r\n        \"id\": \"favicon-android\",\r\n        \"name\": \"FaviconAndroid\",\r\n        \"displayName\": \"Android Chrome Icon\",\r\n        \"width\": 192,\r\n        \"height\": 192,\r\n        \"platform\": \"favicon\",\r\n        \"category\": \"favicon\",\r\n        \"icon\": \"fab fa-android\",\r\n        \"description\": \"Android Chrome home screen icon\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"20KB\",\r\n        \"notes\": \"For Android devices when saving to home screen\"\r\n    },\r\n    {\r\n        \"id\": \"favicon-safari\",\r\n        \"name\": \"FaviconSafari\",\r\n        \"displayName\": \"Safari Pinned Tab\",\r\n        \"width\": 16,\r\n        \"height\": 16,\r\n        \"platform\": \"favicon\",\r\n        \"category\": \"favicon\",\r\n        \"icon\": \"fab fa-safari\",\r\n        \"description\": \"SVG icon for Safari pinned tabs\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"svg\"\r\n        ],\r\n        \"maxFileSize\": \"5KB\",\r\n        \"notes\": \"Monochrome SVG for Safari pinned tabs feature\"\r\n    },\r\n    {\r\n        \"id\": \"favicon-windows\",\r\n        \"name\": \"FaviconWindows\",\r\n        \"displayName\": \"Windows Tile\",\r\n        \"width\": 144,\r\n        \"height\": 144,\r\n        \"platform\": \"favicon\",\r\n        \"category\": \"favicon\",\r\n        \"icon\": \"fab fa-windows\",\r\n        \"description\": \"Windows 8/10 start menu tile icon\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"15KB\",\r\n        \"notes\": \"For Windows devices when pinning to start menu\"\r\n    },\r\n    {\r\n        \"id\": \"favicon-retina\",\r\n        \"name\": \"FaviconRetina\",\r\n        \"displayName\": \"Retina Favicon\",\r\n        \"width\": 64,\r\n        \"height\": 64,\r\n        \"platform\": \"favicon\",\r\n        \"category\": \"favicon\",\r\n        \"icon\": \"fas fa-expand-alt\",\r\n        \"description\": \"High-resolution favicon for retina displays\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\",\r\n            \"ico\"\r\n        ],\r\n        \"maxFileSize\": \"15KB\",\r\n        \"notes\": \"For high-DPI screens, includes @2x and @3x versions\"\r\n    },\r\n    {\r\n        \"id\": \"favicon-complete\",\r\n        \"name\": \"FaviconComplete\",\r\n        \"displayName\": \"Complete Favicon Package\",\r\n        \"width\": 512,\r\n        \"height\": 512,\r\n        \"platform\": \"favicon\",\r\n        \"category\": \"favicon\",\r\n        \"icon\": \"fas fa-box\",\r\n        \"description\": \"Complete favicon package with all necessary sizes\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"ico\",\r\n            \"png\",\r\n            \"svg\"\r\n        ],\r\n        \"maxFileSize\": \"50KB\",\r\n        \"notes\": \"Includes all sizes: 1616, 3232, 4848, 6464, 128128, 180180, 192192, 256256, 512512\"\r\n    }\r\n]","export default [\r\n    {\r\n        \"id\": \"logo-rectangular\",\r\n        \"name\": \"LogoRectangular\",\r\n        \"displayName\": \"Rectangular Logo\",\r\n        \"width\": 300,\r\n        \"height\": 150,\r\n        \"platform\": \"logo\",\r\n        \"category\": \"logo\",\r\n        \"icon\": \"fas fa-rectangle-landscape\",\r\n        \"description\": \"Standard rectangular logo format\",\r\n        \"aspectRatio\": \"2:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\",\r\n            \"svg\"\r\n        ],\r\n        \"maxFileSize\": \"50KB\",\r\n        \"notes\": \"Good for website headers and email signatures\"\r\n    },\r\n    {\r\n        \"id\": \"logo-square\",\r\n        \"name\": \"LogoSquare\",\r\n        \"displayName\": \"Square Logo\",\r\n        \"width\": 500,\r\n        \"height\": 500,\r\n        \"platform\": \"logo\",\r\n        \"category\": \"logo\",\r\n        \"icon\": \"fas fa-square\",\r\n        \"description\": \"Square logo for social media and apps\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\",\r\n            \"svg\"\r\n        ],\r\n        \"maxFileSize\": \"50KB\",\r\n        \"notes\": \"Required for many social media platforms\"\r\n    },\r\n    {\r\n        \"id\": \"logo-social\",\r\n        \"name\": \"LogoSocial\",\r\n        \"displayName\": \"Social Media Logo\",\r\n        \"width\": 400,\r\n        \"height\": 400,\r\n        \"platform\": \"logo\",\r\n        \"category\": \"logo\",\r\n        \"icon\": \"fas fa-thumbs-up\",\r\n        \"description\": \"Optimized for social media profile pictures\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\",\r\n            \"jpg\"\r\n        ],\r\n        \"maxFileSize\": \"100KB\",\r\n        \"notes\": \"Works for Facebook, Twitter, LinkedIn, etc.\"\r\n    },\r\n    {\r\n        \"id\": \"logo-print\",\r\n        \"name\": \"LogoPrint\",\r\n        \"displayName\": \"Print-Ready Logo\",\r\n        \"width\": 3000,\r\n        \"height\": 3000,\r\n        \"platform\": \"logo\",\r\n        \"category\": \"logo\",\r\n        \"icon\": \"fas fa-print\",\r\n        \"description\": \"High-resolution logo for print materials\",\r\n        \"aspectRatio\": \"1:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\",\r\n            \"svg\",\r\n            \"pdf\",\r\n            \"eps\"\r\n        ],\r\n        \"maxFileSize\": \"2MB\",\r\n        \"notes\": \"300 DPI minimum for quality printing\"\r\n    },\r\n    {\r\n        \"id\": \"logo-watermark\",\r\n        \"name\": \"LogoWatermark\",\r\n        \"displayName\": \"Watermark\",\r\n        \"width\": 1000,\r\n        \"height\": 400,\r\n        \"platform\": \"logo\",\r\n        \"category\": \"logo\",\r\n        \"icon\": \"fas fa-tint\",\r\n        \"description\": \"Semi-transparent watermark for photos\",\r\n        \"aspectRatio\": \"2.5:1\",\r\n        \"recommendedFormats\": [\r\n            \"png\"\r\n        ],\r\n        \"maxFileSize\": \"50KB\",\r\n        \"notes\": \"Use PNG with transparency for overlay\"\r\n    },\r\n    {\r\n        \"id\": \"logo-vertical\",\r\n        \"name\": \"LogoVertical\",\r\n        \"displayName\": \"Vertical Logo\",\r\n        \"width\": 500,\r\n        \"height\": 800,\r\n        \"platform\": \"logo\",\r\n        \"category\": \"logo\",\r\n        \"icon\": \"fas fa-arrows-alt-v\",\r\n        \"description\": \"Tall logo for vertical spaces\",\r\n        \"aspectRatio\": \"5:8\",\r\n        \"recommendedFormats\": [\r\n            \"png\",\r\n            \"svg\"\r\n        ],\r\n        \"maxFileSize\": \"50KB\",\r\n        \"notes\": \"Good for mobile apps and documentation\"\r\n    }\r\n]","/**\r\n * Template management and utilities\r\n * @module templates\r\n */\r\n\r\n// Import template data from .js files\r\nimport socialTemplates from './social.js';\r\nimport webTemplates from './web.js';\r\nimport faviconTemplates from './favicon.js';\r\nimport logoTemplates from './logo.js';\r\n\r\n// Import validation utilities\r\nimport { parseDimension, isVariableDimension } from '../utils/validationUtils.js';\r\n\r\n/**\r\n * LemGendTemplates - Collection of all available templates\r\n * @constant\r\n */\r\nexport const LemGendTemplates = {\r\n    SOCIAL_MEDIA: socialTemplates,\r\n    WEB: webTemplates,\r\n    LOGO: logoTemplates,\r\n    FAVICON: faviconTemplates,\r\n    ALL: [...socialTemplates, ...webTemplates, ...logoTemplates, ...faviconTemplates]\r\n};\r\n\r\n/**\r\n * Template categories\r\n * @constant\r\n */\r\nexport const TEMPLATE_CATEGORIES = [\r\n    { id: 'all', name: 'All Templates', icon: 'fas fa-th', color: '#3B82F6' },\r\n    { id: 'social', name: 'Social Media', icon: 'fas fa-share-alt', color: '#8B5CF6' },\r\n    { id: 'web', name: 'Web', icon: 'fas fa-globe', color: '#10B981' },\r\n    { id: 'logo', name: 'Logo', icon: 'fas fa-copyright', color: '#F59E0B' },\r\n    { id: 'favicon', name: 'Favicon', icon: 'fas fa-star', color: '#EC4899' }\r\n];\r\n\r\n/**\r\n * Platform information\r\n * @constant\r\n */\r\nexport const PLATFORMS = {\r\n    instagram: {\r\n        name: 'Instagram',\r\n        icon: 'fab fa-instagram',\r\n        color: '#E4405F',\r\n        categories: ['social']\r\n    },\r\n    facebook: {\r\n        name: 'Facebook',\r\n        icon: 'fab fa-facebook',\r\n        color: '#1877F2',\r\n        categories: ['social']\r\n    },\r\n    twitter: {\r\n        name: 'Twitter / X',\r\n        icon: 'fab fa-twitter',\r\n        color: '#1DA1F2',\r\n        categories: ['social']\r\n    },\r\n    linkedin: {\r\n        name: 'LinkedIn',\r\n        icon: 'fab fa-linkedin',\r\n        color: '#0A66C2',\r\n        categories: ['social']\r\n    },\r\n    youtube: {\r\n        name: 'YouTube',\r\n        icon: 'fab fa-youtube',\r\n        color: '#FF0000',\r\n        categories: ['social']\r\n    },\r\n    pinterest: {\r\n        name: 'Pinterest',\r\n        icon: 'fab fa-pinterest',\r\n        color: '#E60023',\r\n        categories: ['social']\r\n    },\r\n    tiktok: {\r\n        name: 'TikTok',\r\n        icon: 'fab fa-tiktok',\r\n        color: '#000000',\r\n        categories: ['social']\r\n    },\r\n    web: {\r\n        name: 'Web',\r\n        icon: 'fas fa-globe',\r\n        color: '#3B82F6',\r\n        categories: ['web']\r\n    },\r\n    logo: {\r\n        name: 'Logo',\r\n        icon: 'fas fa-copyright',\r\n        color: '#8B5CF6',\r\n        categories: ['logo']\r\n    },\r\n    favicon: {\r\n        name: 'Favicon',\r\n        icon: 'fas fa-star',\r\n        color: '#EC4899',\r\n        categories: ['favicon']\r\n    }\r\n};\r\n\r\n/**\r\n * Get templates by platform\r\n * @param {string} platform - Platform identifier\r\n * @returns {Array} Array of templates for the platform\r\n */\r\nexport function getTemplatesByPlatform(platform) {\r\n    if (!PLATFORMS[platform]) {\r\n        console.warn(`Unknown platform: ${platform}`);\r\n        return [];\r\n    }\r\n\r\n    return LemGendTemplates.ALL.filter(template =>\r\n        template.platform && template.platform.toLowerCase() === platform.toLowerCase()\r\n    );\r\n}\r\n\r\n/**\r\n * Get templates by category\r\n * @param {string} category - Category identifier\r\n * @returns {Array} Array of templates in the category\r\n */\r\nexport function getTemplatesByCategory(category) {\r\n    const validCategories = TEMPLATE_CATEGORIES.map(c => c.id);\r\n    if (!validCategories.includes(category) && category !== 'all') {\r\n        console.warn(`Invalid category: ${category}`);\r\n        return [];\r\n    }\r\n\r\n    if (category === 'all') {\r\n        return LemGendTemplates.ALL;\r\n    }\r\n\r\n    return LemGendTemplates.ALL.filter(template =>\r\n        template.category && template.category.toLowerCase() === category.toLowerCase()\r\n    );\r\n}\r\n\r\n/**\r\n * Get template by ID\r\n * @param {string} id - Template ID\r\n * @returns {Object|null} Template object or null if not found\r\n */\r\nexport function getTemplateById(id) {\r\n    return LemGendTemplates.ALL.find(template => template.id === id) || null;\r\n}\r\n\r\n/**\r\n * Get templates with specific dimensions\r\n * @param {number|string} width - Minimum width (can be number or 'flex')\r\n * @param {number|string} height - Minimum height (can be number or 'flex')\r\n * @param {string} operator - 'exact', 'min', 'max', 'aspect', 'flexible'\r\n * @returns {Array} Filtered templates\r\n */\r\nexport function getTemplatesByDimensions(width, height, operator = 'min') {\r\n    return LemGendTemplates.ALL.filter(template => {\r\n        if (!template.width || !template.height) return false;\r\n\r\n        // Parse dimensions\r\n        const templateWidth = parseDimension(template.width);\r\n        const templateHeight = parseDimension(template.height);\r\n        const targetWidth = parseDimension(width);\r\n        const targetHeight = parseDimension(height);\r\n\r\n        // Handle flexible templates\r\n        if (operator === 'flexible') {\r\n            return templateWidth.isVariable || templateHeight.isVariable;\r\n        }\r\n\r\n        // For exact match with flexible dimensions\r\n        if (operator === 'exact' && (templateWidth.isVariable || templateHeight.isVariable)) {\r\n            // For flexible templates, we need special handling\r\n            if (templateWidth.isVariable && templateHeight.isVariable) {\r\n                return targetWidth.isVariable && targetHeight.isVariable;\r\n            } else if (templateWidth.isVariable) {\r\n                return targetWidth.isVariable && templateHeight.value === targetHeight.value;\r\n            } else if (templateHeight.isVariable) {\r\n                return templateWidth.value === targetWidth.value && targetHeight.isVariable;\r\n            }\r\n        }\r\n\r\n        // Ensure we have fixed values for comparison\r\n        if (templateWidth.isVariable || templateHeight.isVariable ||\r\n            targetWidth.isVariable || targetHeight.isVariable) {\r\n            return false;\r\n        }\r\n\r\n        switch (operator) {\r\n            case 'exact':\r\n                return templateWidth.value === targetWidth.value && templateHeight.value === targetHeight.value;\r\n            case 'min':\r\n                return templateWidth.value >= targetWidth.value && templateHeight.value >= targetHeight.value;\r\n            case 'max':\r\n                return templateWidth.value <= targetWidth.value && templateHeight.value <= targetHeight.value;\r\n            case 'aspect':\r\n                const templateAspect = templateWidth.value / templateHeight.value;\r\n                const targetAspect = targetWidth.value / targetHeight.value;\r\n                return Math.abs(templateAspect - targetAspect) < 0.1; // Within 10%\r\n            default:\r\n                return false;\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Validate template compatibility\r\n * @param {Object} template - Template to validate\r\n * @param {Object} imageInfo - Image information with width and height\r\n * @returns {Object} Compatibility result\r\n */\r\nexport function validateTemplateCompatibility(template, imageInfo) {\r\n    const result = {\r\n        compatible: true,\r\n        errors: [],\r\n        warnings: []\r\n    };\r\n\r\n    if (!template || !imageInfo) {\r\n        result.compatible = false;\r\n        result.errors.push({\r\n            code: 'MISSING_INFO',\r\n            message: 'Missing template or image information',\r\n            severity: 'error'\r\n        });\r\n        return result;\r\n    }\r\n\r\n    const { width, height } = imageInfo;\r\n    const widthInfo = parseDimension(template.width);\r\n    const heightInfo = parseDimension(template.height);\r\n\r\n    if (!widthInfo.isVariable && widthInfo.value && width < widthInfo.value) {\r\n        result.warnings.push({\r\n            code: 'SMALL_WIDTH',\r\n            message: `Image width (${width}px) smaller than template width (${widthInfo.value}px)`,\r\n            severity: 'warning',\r\n            suggestion: 'Image will be upscaled or may lose quality'\r\n        });\r\n    }\r\n\r\n    if (!heightInfo.isVariable && heightInfo.value && height < heightInfo.value) {\r\n        result.warnings.push({\r\n            code: 'SMALL_HEIGHT',\r\n            message: `Image height (${height}px) smaller than template height (${heightInfo.value}px)`,\r\n            severity: 'warning',\r\n            suggestion: 'Image will be upscaled or may lose quality'\r\n        });\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Calculate match score between image and template - ENHANCED for flexible dimensions\r\n * @private\r\n */\r\nfunction calculateTemplateMatchScore(image, template) {\r\n    let score = 0;\r\n    const maxScore = 100;\r\n\r\n    // Check if image has dimensions\r\n    if (!image || !image.width || !image.height) {\r\n        return 0.5; // Default score if missing data\r\n    }\r\n\r\n    // Parse template dimensions\r\n    const templateWidth = parseDimension(template.width);\r\n    const templateHeight = parseDimension(template.height);\r\n\r\n    // Handle flexible/variable dimensions in template\r\n    if (templateWidth.isVariable || templateHeight.isVariable) {\r\n        // For flexible templates, score based on what's available\r\n\r\n        // Base score for flexibility (50 points)\r\n        score += 50;\r\n\r\n        // Check aspect ratio compatibility (30 points)\r\n        if (templateWidth.isVariable && !templateHeight.isVariable) {\r\n            // Height is fixed, check if image height is sufficient\r\n            const heightRatio = image.height / templateHeight.value;\r\n            if (heightRatio >= 1) {\r\n                score += 30; // Perfect height match\r\n            } else if (heightRatio >= 0.8) {\r\n                score += 20 * heightRatio; // Good enough\r\n            } else {\r\n                score += 10 * heightRatio; // Poor match\r\n            }\r\n\r\n            // Check if image has reasonable aspect ratio for web content (20 points)\r\n            const aspect = image.width / image.height;\r\n            if (aspect >= 0.5 && aspect <= 2.0) {\r\n                score += 20; // Good aspect ratio for content\r\n            } else {\r\n                score += 10; // Extreme aspect ratio\r\n            }\r\n        } else if (!templateWidth.isVariable && templateHeight.isVariable) {\r\n            // Width is fixed, check if image width is sufficient\r\n            const widthRatio = image.width / templateWidth.value;\r\n            if (widthRatio >= 1) {\r\n                score += 30; // Perfect width match\r\n            } else if (widthRatio >= 0.8) {\r\n                score += 20 * widthRatio; // Good enough\r\n            } else {\r\n                score += 10 * widthRatio; // Poor match\r\n            }\r\n\r\n            // Check if image has reasonable aspect ratio for web content (20 points)\r\n            const aspect = image.width / image.height;\r\n            if (aspect >= 0.5 && aspect <= 2.0) {\r\n                score += 20; // Good aspect ratio for content\r\n            } else {\r\n                score += 10; // Extreme aspect ratio\r\n            }\r\n        } else {\r\n            // Both dimensions are variable - give high score for maximum flexibility\r\n            score += 50; // Full points for flexibility\r\n        }\r\n    } else {\r\n        // Fixed template dimensions - original logic\r\n        // Aspect ratio match (50 points)\r\n        const imageAspect = image.width / image.height;\r\n        const templateAspect = templateWidth.value / templateHeight.value;\r\n        const aspectDiff = Math.abs(imageAspect - templateAspect) / imageAspect;\r\n        score += Math.max(0, 50 * (1 - aspectDiff));\r\n\r\n        // Size adequacy (30 points)\r\n        const widthRatio = image.width / templateWidth.value;\r\n        const heightRatio = image.height / templateHeight.value;\r\n        const minRatio = Math.min(widthRatio, heightRatio);\r\n\r\n        if (minRatio >= 1) {\r\n            // Image is larger than template - good\r\n            score += 30;\r\n        } else {\r\n            // Image is smaller - penalty based on how much smaller\r\n            score += 30 * minRatio;\r\n        }\r\n\r\n        // Platform/category relevance (20 points)\r\n        score += 20;\r\n    }\r\n\r\n    return Math.min(maxScore, score) / maxScore; // Normalize to 0-1\r\n}\r\n\r\n/**\r\n * Get recommended templates for an image\r\n * @param {Object} image - Image to match templates for (needs width, height properties)\r\n * @param {Object} options - Matching options\r\n * @returns {Array} Recommended templates\r\n */\r\nexport function getRecommendedTemplates(image, options = {}) {\r\n    const {\r\n        category = 'all',\r\n        platform = null,\r\n        minMatchScore = 0.7,\r\n        includeFlexible = true\r\n    } = options;\r\n\r\n    // Get initial templates\r\n    let templates = category === 'all'\r\n        ? LemGendTemplates.ALL\r\n        : getTemplatesByCategory(category);\r\n\r\n    if (platform) {\r\n        templates = templates.filter(t => t.platform === platform);\r\n    }\r\n\r\n    // Filter out flexible templates if not wanted\r\n    if (!includeFlexible) {\r\n        templates = templates.filter(template => {\r\n            const widthInfo = parseDimension(template.width);\r\n            const heightInfo = parseDimension(template.height);\r\n            return !widthInfo.isVariable && !heightInfo.isVariable;\r\n        });\r\n    }\r\n\r\n    // Calculate match score for each template\r\n    const scoredTemplates = templates.map(template => {\r\n        const score = calculateTemplateMatchScore(image, template);\r\n        const widthInfo = parseDimension(template.width);\r\n        const heightInfo = parseDimension(template.height);\r\n\r\n        return {\r\n            ...template,\r\n            matchScore: score,\r\n            hasFlexibleDimensions: widthInfo.isVariable || heightInfo.isVariable,\r\n            flexibleType: widthInfo.isVariable ? 'width' : heightInfo.isVariable ? 'height' : 'none'\r\n        };\r\n    });\r\n\r\n    // Filter by minimum score and sort by score\r\n    return scoredTemplates\r\n        .filter(t => t.matchScore >= minMatchScore)\r\n        .sort((a, b) => b.matchScore - a.matchScore);\r\n}\r\n\r\n/**\r\n * Get template statistics - ENHANCED for flexible templates\r\n * @returns {Object} Template statistics\r\n */\r\nexport function getTemplateStats() {\r\n    const stats = {\r\n        total: LemGendTemplates.ALL.length,\r\n        byCategory: {},\r\n        byPlatform: {},\r\n        flexibleTemplates: 0,\r\n        fixedTemplates: 0,\r\n        dimensions: {\r\n            minWidth: Infinity,\r\n            maxWidth: 0,\r\n            minHeight: Infinity,\r\n            maxHeight: 0,\r\n            commonAspectRatios: {}\r\n        }\r\n    };\r\n\r\n    // Count by category\r\n    TEMPLATE_CATEGORIES.forEach(category => {\r\n        if (category.id !== 'all') {\r\n            const count = getTemplatesByCategory(category.id).length;\r\n            stats.byCategory[category.id] = count;\r\n        }\r\n    });\r\n\r\n    // Count by platform\r\n    Object.keys(PLATFORMS).forEach(platform => {\r\n        const count = getTemplatesByPlatform(platform).length;\r\n        stats.byPlatform[platform] = count;\r\n    });\r\n\r\n    // Calculate dimension statistics and count flexible templates\r\n    LemGendTemplates.ALL.forEach(template => {\r\n        const widthInfo = parseDimension(template.width);\r\n        const heightInfo = parseDimension(template.height);\r\n\r\n        if (widthInfo.isVariable || heightInfo.isVariable) {\r\n            stats.flexibleTemplates++;\r\n        } else {\r\n            stats.fixedTemplates++;\r\n\r\n            // Update min/max for fixed dimensions only\r\n            stats.dimensions.minWidth = Math.min(stats.dimensions.minWidth, widthInfo.value);\r\n            stats.dimensions.maxWidth = Math.max(stats.dimensions.maxWidth, widthInfo.value);\r\n            stats.dimensions.minHeight = Math.min(stats.dimensions.minHeight, heightInfo.value);\r\n            stats.dimensions.maxHeight = Math.max(stats.dimensions.maxHeight, heightInfo.value);\r\n\r\n            // Calculate aspect ratio for fixed dimensions\r\n            const aspect = (widthInfo.value / heightInfo.value).toFixed(2);\r\n            stats.dimensions.commonAspectRatios[aspect] =\r\n                (stats.dimensions.commonAspectRatios[aspect] || 0) + 1;\r\n        }\r\n    });\r\n\r\n    return stats;\r\n}\r\n\r\n/**\r\n * Export templates to various formats\r\n * @param {string} format - Export format: 'json', 'csv', 'markdown'\r\n * @returns {string} Exported data\r\n */\r\nexport function exportTemplates(format = 'json') {\r\n    switch (format.toLowerCase()) {\r\n        case 'json':\r\n            return JSON.stringify(LemGendTemplates, null, 2);\r\n\r\n        case 'csv':\r\n            const headers = ['id', 'name', 'platform', 'category', 'width', 'height', 'description', 'flexible'];\r\n            const rows = LemGendTemplates.ALL.map(t => {\r\n                const widthInfo = parseDimension(t.width);\r\n                const heightInfo = parseDimension(t.height);\r\n                const flexible = widthInfo.isVariable || heightInfo.isVariable ? 'yes' : 'no';\r\n\r\n                return [\r\n                    t.id,\r\n                    t.name,\r\n                    t.platform,\r\n                    t.category,\r\n                    t.width,\r\n                    t.height,\r\n                    t.description || '',\r\n                    flexible\r\n                ];\r\n            });\r\n            return [headers, ...rows].map(row => row.join(',')).join('\\n');\r\n\r\n        case 'markdown':\r\n            let markdown = '# LemGendary Templates\\n\\n';\r\n            markdown += `**Total Templates:** ${LemGendTemplates.ALL.length}\\n\\n`;\r\n\r\n            const stats = getTemplateStats();\r\n            markdown += `**Flexible Templates:** ${stats.flexibleTemplates}\\n`;\r\n            markdown += `**Fixed Templates:** ${stats.fixedTemplates}\\n\\n`;\r\n\r\n            TEMPLATE_CATEGORIES.forEach(category => {\r\n                if (category.id !== 'all') {\r\n                    const templates = getTemplatesByCategory(category.id);\r\n                    markdown += `## ${category.name} (${templates.length})\\n\\n`;\r\n\r\n                    // Group by platform for better organization\r\n                    const templatesByPlatform = {};\r\n                    templates.forEach(template => {\r\n                        if (!templatesByPlatform[template.platform]) {\r\n                            templatesByPlatform[template.platform] = [];\r\n                        }\r\n                        templatesByPlatform[template.platform].push(template);\r\n                    });\r\n\r\n                    Object.keys(templatesByPlatform).forEach(platform => {\r\n                        const platformTemplates = templatesByPlatform[platform];\r\n                        const platformInfo = PLATFORMS[platform] || { name: platform };\r\n                        markdown += `### ${platformInfo.name}\\n`;\r\n\r\n                        platformTemplates.forEach(template => {\r\n                            const widthInfo = parseDimension(template.width);\r\n                            const heightInfo = parseDimension(template.height);\r\n                            const flexible = widthInfo.isVariable || heightInfo.isVariable;\r\n\r\n                            markdown += `- **${template.displayName || template.name}**: `;\r\n\r\n                            if (flexible) {\r\n                                if (widthInfo.isVariable && heightInfo.isVariable) {\r\n                                    markdown += `Flexible dimensions`;\r\n                                } else if (widthInfo.isVariable) {\r\n                                    markdown += `Flexible width  ${heightInfo.value}`;\r\n                                } else {\r\n                                    markdown += `${widthInfo.value}  Flexible height`;\r\n                                }\r\n                            } else {\r\n                                markdown += `${widthInfo.value}  ${heightInfo.value}`;\r\n                            }\r\n\r\n                            if (template.description) {\r\n                                markdown += ` - ${template.description}`;\r\n                            }\r\n\r\n                            if (flexible) {\r\n                                markdown += ` `;\r\n                            }\r\n\r\n                            markdown += ` (\\`${template.id}\\`)\\n`;\r\n                        });\r\n                        markdown += '\\n';\r\n                    });\r\n                }\r\n            });\r\n\r\n            return markdown;\r\n\r\n        default:\r\n            throw new Error(`Unsupported export format: ${format}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Validate template configuration\r\n * @param {Object} template - Template to validate\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateTemplate(template) {\r\n    const errors = [];\r\n    const warnings = [];\r\n\r\n    // Required fields\r\n    const requiredFields = ['id', 'name', 'width', 'height', 'platform', 'category'];\r\n    requiredFields.forEach(field => {\r\n        if (!template[field]) {\r\n            errors.push(`Missing required field: ${field}`);\r\n        }\r\n    });\r\n\r\n    // Field validation\r\n    if (template.id && typeof template.id !== 'string') {\r\n        errors.push('id must be a string');\r\n    }\r\n\r\n    // Width/height validation with flexible dimension support\r\n    const widthInfo = parseDimension(template.width);\r\n    const heightInfo = parseDimension(template.height);\r\n\r\n    if (!widthInfo.isVariable && (typeof widthInfo.value !== 'number' || widthInfo.value <= 0 || isNaN(widthInfo.value))) {\r\n        errors.push('width must be a positive number or \"flex\"');\r\n    }\r\n\r\n    if (!heightInfo.isVariable && (typeof heightInfo.value !== 'number' || heightInfo.value <= 0 || isNaN(heightInfo.value))) {\r\n        errors.push('height must be a positive number or \"flex\"');\r\n    }\r\n\r\n    if (template.platform && !PLATFORMS[template.platform]) {\r\n        warnings.push(`Unknown platform: ${template.platform}`);\r\n    }\r\n\r\n    if (template.category && !TEMPLATE_CATEGORIES.find(c => c.id === template.category)) {\r\n        warnings.push(`Unknown category: ${template.category}`);\r\n    }\r\n\r\n    // Check for duplicate ID\r\n    if (template.id && getTemplateById(template.id)) {\r\n        warnings.push(`Duplicate template ID: ${template.id}`);\r\n    }\r\n\r\n    // Validate aspect ratio field if present\r\n    if (template.aspectRatio) {\r\n        if (template.aspectRatio === 'flexible' || template.aspectRatio === 'variable') {\r\n            // This is fine for flexible templates\r\n            if (!widthInfo.isVariable && !heightInfo.isVariable) {\r\n                warnings.push('aspectRatio is \"flexible\" but both dimensions are fixed');\r\n            }\r\n        } else if (!template.aspectRatio.match(/^\\d+:\\d+$/)) {\r\n            warnings.push(`Invalid aspect ratio format: ${template.aspectRatio}. Use \"w:h\" or \"flexible\"`);\r\n        }\r\n    }\r\n\r\n    return {\r\n        valid: errors.length === 0,\r\n        errors,\r\n        warnings,\r\n        hasFlexibleDimensions: widthInfo.isVariable || heightInfo.isVariable\r\n    };\r\n}\r\n\r\n/**\r\n * Add a custom template\r\n * @param {Object} template - Template to add\r\n * @returns {Object} Added template with validation result\r\n */\r\nexport function addCustomTemplate(template) {\r\n    const validation = validateTemplate(template);\r\n\r\n    if (!validation.valid) {\r\n        throw new Error(`Invalid template: ${validation.errors.join(', ')}`);\r\n    }\r\n\r\n    // Add to appropriate category array\r\n    switch (template.category) {\r\n        case 'social':\r\n            LemGendTemplates.SOCIAL_MEDIA.push(template);\r\n            break;\r\n        case 'web':\r\n            LemGendTemplates.WEB.push(template);\r\n            break;\r\n        case 'logo':\r\n            LemGendTemplates.LOGO.push(template);\r\n            break;\r\n        case 'favicon':\r\n            LemGendTemplates.FAVICON.push(template);\r\n            break;\r\n        default:\r\n            throw new Error(`Invalid category for custom template: ${template.category}`);\r\n    }\r\n\r\n    // Also add to ALL array\r\n    LemGendTemplates.ALL.push(template);\r\n\r\n    return {\r\n        template,\r\n        validation,\r\n        message: 'Custom template added successfully'\r\n    };\r\n}\r\n\r\n/**\r\n * Get all available platforms\r\n * @returns {Array} Array of platform objects\r\n */\r\nexport function getAllPlatforms() {\r\n    return Object.keys(PLATFORMS).map(key => ({\r\n        id: key,\r\n        ...PLATFORMS[key]\r\n    }));\r\n}\r\n\r\n/**\r\n * Get templates grouped by platform\r\n * @returns {Object} Templates grouped by platform\r\n */\r\nexport function getTemplatesGroupedByPlatform() {\r\n    const grouped = {};\r\n\r\n    Object.keys(PLATFORMS).forEach(platform => {\r\n        grouped[platform] = getTemplatesByPlatform(platform);\r\n    });\r\n\r\n    return grouped;\r\n}\r\n\r\n/**\r\n * Search templates by name, description, or platform\r\n * @param {string} query - Search query\r\n * @returns {Array} Matching templates\r\n */\r\nexport function searchTemplates(query) {\r\n    if (!query || query.trim() === '') {\r\n        return LemGendTemplates.ALL;\r\n    }\r\n\r\n    const searchTerm = query.toLowerCase().trim();\r\n\r\n    return LemGendTemplates.ALL.filter(template => {\r\n        return (\r\n            (template.name && template.name.toLowerCase().includes(searchTerm)) ||\r\n            (template.displayName && template.displayName.toLowerCase().includes(searchTerm)) ||\r\n            (template.description && template.description.toLowerCase().includes(searchTerm)) ||\r\n            (template.platform && template.platform.toLowerCase().includes(searchTerm)) ||\r\n            (template.category && template.category.toLowerCase().includes(searchTerm)) ||\r\n            (template.id && template.id.toLowerCase().includes(searchTerm))\r\n        );\r\n    });\r\n}\r\n\r\n/**\r\n * Get aspect ratio of a template\r\n * @param {Object} template - Template object\r\n * @returns {string} Aspect ratio in format \"w:h\" or \"flexible\"\r\n */\r\nexport function getTemplateAspectRatio(template) {\r\n    const widthInfo = parseDimension(template.width);\r\n    const heightInfo = parseDimension(template.height);\r\n\r\n    if (widthInfo.isVariable || heightInfo.isVariable) {\r\n        return 'flexible';\r\n    }\r\n\r\n    if (!widthInfo.value || !heightInfo.value) return 'unknown';\r\n\r\n    const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);\r\n    const divisor = gcd(widthInfo.value, heightInfo.value);\r\n\r\n    return `${widthInfo.value / divisor}:${heightInfo.value / divisor}`;\r\n}\r\n\r\n/**\r\n * Get all templates with flexible/variable dimensions\r\n * @returns {Array} Templates with flexible dimensions\r\n */\r\nexport function getFlexibleTemplates() {\r\n    return LemGendTemplates.ALL.filter(template => {\r\n        const widthInfo = parseDimension(template.width);\r\n        const heightInfo = parseDimension(template.height);\r\n        return widthInfo.isVariable || heightInfo.isVariable;\r\n    });\r\n}\r\n\r\n/**\r\n * Get templates suitable for an image based on dimensions\r\n * @param {number} width - Image width\r\n * @param {number} height - Image height\r\n * @param {Object} options - Options for filtering\r\n * @returns {Array} Suitable templates\r\n */\r\nexport function getTemplatesForImage(width, height, options = {}) {\r\n    const {\r\n        category = 'all',\r\n        platform = null,\r\n        allowFlexible = true,\r\n        minCoverage = 0.8 // How much of the template should the image cover\r\n    } = options;\r\n\r\n    let templates = category === 'all'\r\n        ? LemGendTemplates.ALL\r\n        : getTemplatesByCategory(category);\r\n\r\n    if (platform) {\r\n        templates = templates.filter(t => t.platform === platform);\r\n    }\r\n\r\n    if (!allowFlexible) {\r\n        templates = templates.filter(t => {\r\n            const widthInfo = parseDimension(t.width);\r\n            const heightInfo = parseDimension(t.height);\r\n            return !widthInfo.isVariable && !heightInfo.isVariable;\r\n        });\r\n    }\r\n\r\n    // Score each template\r\n    const scoredTemplates = templates.map(template => {\r\n        const widthInfo = parseDimension(template.width);\r\n        const heightInfo = parseDimension(template.height);\r\n        let score = 0;\r\n        let coverage = 1;\r\n        let reason = '';\r\n\r\n        if (widthInfo.isVariable || heightInfo.isVariable) {\r\n            // Flexible template scoring\r\n            score = 0.8; // Base score for flexible templates\r\n\r\n            if (widthInfo.isVariable && heightInfo.isVariable) {\r\n                reason = 'Both dimensions flexible - perfect fit';\r\n                score = 0.95;\r\n            } else if (widthInfo.isVariable) {\r\n                // Height is fixed\r\n                coverage = height / heightInfo.value;\r\n                if (coverage >= 1) {\r\n                    score = 0.9;\r\n                    reason = 'Image height exceeds template height';\r\n                } else if (coverage >= minCoverage) {\r\n                    score = 0.8;\r\n                    reason = 'Image height adequate for template';\r\n                } else {\r\n                    score = 0.5;\r\n                    reason = 'Image height insufficient for template';\r\n                }\r\n            } else {\r\n                // Width is fixed\r\n                coverage = width / widthInfo.value;\r\n                if (coverage >= 1) {\r\n                    score = 0.9;\r\n                    reason = 'Image width exceeds template width';\r\n                } else if (coverage >= minCoverage) {\r\n                    score = 0.8;\r\n                    reason = 'Image width adequate for template';\r\n                } else {\r\n                    score = 0.5;\r\n                    reason = 'Image width insufficient for template';\r\n                }\r\n            }\r\n        } else {\r\n            // Fixed template scoring\r\n            const widthCoverage = width / widthInfo.value;\r\n            const heightCoverage = height / heightInfo.value;\r\n            coverage = Math.min(widthCoverage, heightCoverage);\r\n\r\n            if (coverage >= 1) {\r\n                score = 1.0;\r\n                reason = 'Image exceeds template dimensions';\r\n            } else if (coverage >= minCoverage) {\r\n                score = 0.7 + (coverage * 0.3);\r\n                reason = 'Image adequate for template';\r\n            } else {\r\n                score = coverage;\r\n                reason = 'Image too small for template';\r\n            }\r\n\r\n            // Aspect ratio penalty\r\n            const imageAspect = width / height;\r\n            const templateAspect = widthInfo.value / heightInfo.value;\r\n            const aspectDiff = Math.abs(imageAspect - templateAspect);\r\n            if (aspectDiff > 0.1) {\r\n                score *= 0.8;\r\n                reason += ' (aspect ratio mismatch)';\r\n            }\r\n        }\r\n\r\n        return {\r\n            ...template,\r\n            matchScore: score,\r\n            coverage: coverage,\r\n            reason: reason,\r\n            hasFlexibleDimensions: widthInfo.isVariable || heightInfo.isVariable\r\n        };\r\n    });\r\n\r\n    // Sort by score descending\r\n    return scoredTemplates.sort((a, b) => b.matchScore - a.matchScore);\r\n}\r\n\r\n// Export parseDimension from validationUtils\r\nexport { isVariableDimension, parseDimension };\r\n\r\n// Export default object for convenience\r\nexport default {\r\n    LemGendTemplates,\r\n    TEMPLATE_CATEGORIES,\r\n    PLATFORMS,\r\n    getTemplatesByPlatform,\r\n    getTemplatesByCategory,\r\n    getTemplateById,\r\n    getTemplatesByDimensions,\r\n    validateTemplateCompatibility,\r\n    getRecommendedTemplates,\r\n    getTemplateStats,\r\n    exportTemplates,\r\n    validateTemplate,\r\n    addCustomTemplate,\r\n    getAllPlatforms,\r\n    getTemplatesGroupedByPlatform,\r\n    searchTemplates,\r\n    getTemplateAspectRatio,\r\n    getFlexibleTemplates,\r\n    getTemplatesForImage\r\n};","/**\r\n * LemGendary Image Processor - Main Entry Point\r\n * @module image-lemgendizer\r\n */\r\n\r\n// IMPORTANT: Don't import LemGendImage here to avoid circular dependency\r\n// We'll import it dynamically in the functions that need it\r\n\r\n// Import tasks (no circular dependency)\r\nimport { LemGendTask } from './tasks/LemGendTask.js';\r\n\r\n// Import processors\r\nimport { LemGendaryResize } from './processors/LemGendaryResize.js';\r\nimport { LemGendaryCrop } from './processors/LemGendaryCrop.js';\r\nimport { LemGendaryOptimize } from './processors/LemGendaryOptimize.js';\r\nimport { LemGendaryRename } from './processors/LemGendaryRename.js';\r\n\r\n// Import template functions\r\nimport { getTemplateById, validateTemplateCompatibility, parseDimension } from './templates/index.js';\r\n\r\n// Import validation utilities\r\nimport { validateTask } from './utils/validationUtils.js';\r\n\r\n// Import processing utilities\r\nimport { processSingleFile } from './utils/processingUtils.js';\r\n\r\n/**\r\n * Main processing function\r\n */\r\nasync function lemGendaryProcessBatch(files, task, options = {}) {\r\n    const {\r\n        onProgress = null,\r\n        onWarning = null,\r\n        onError = null,\r\n        parallel = false,\r\n        maxParallel = 4\r\n    } = options;\r\n\r\n    const results = [];\r\n    const totalFiles = files.length;\r\n\r\n    console.log('=== lemGendaryProcessBatch START ===');\r\n    console.log('Batch processing:', {\r\n        totalFiles,\r\n        hasTask: !!task,\r\n        steps: task?.getEnabledSteps()?.length || 0,\r\n        options\r\n    });\r\n\r\n    console.log('Validating task...');\r\n    let taskValidation;\r\n    try {\r\n        // Dynamically import LemGendImage to avoid circular dependency\r\n        const { LemGendImage } = await import('./LemGendImage.js');\r\n\r\n        if (files.length > 0) {\r\n            // Check if first file is already a LemGendImage\r\n            let firstFile = files[0];\r\n            if (!(firstFile instanceof LemGendImage) && !firstFile.constructor?.name === 'LemGendImage') {\r\n                // Convert to LemGendImage for validation\r\n                const lemGendImage = new LemGendImage(firstFile);\r\n                await lemGendImage.load().catch(() => { });\r\n                taskValidation = await validateTask(task, lemGendImage);\r\n            } else {\r\n                taskValidation = await validateTask(task, firstFile);\r\n            }\r\n        } else {\r\n            taskValidation = await validateTask(task);\r\n        }\r\n    } catch (validationError) {\r\n        console.error('Task validation threw an error:', validationError);\r\n        taskValidation = {\r\n            isValid: true,\r\n            hasWarnings: true,\r\n            errors: [],\r\n            warnings: [{\r\n                type: 'validation_error',\r\n                message: `Validation error: ${validationError.message}`,\r\n                severity: 'warning'\r\n            }],\r\n            summary: {\r\n                canProceed: true,\r\n                status: 'has_warnings'\r\n            }\r\n        };\r\n    }\r\n\r\n    if (taskValidation.errors && taskValidation.errors.length > 0) {\r\n        const criticalErrors = taskValidation.errors.filter(e =>\r\n            e.severity === 'error' &&\r\n            !e.message.includes('missing file property') &&\r\n            !e.message.includes('invalid file type')\r\n        );\r\n\r\n        if (criticalErrors.length > 0) {\r\n            console.error('Critical validation errors:', criticalErrors);\r\n            throw new Error(`Task validation failed: ${criticalErrors.map(e => e.message).join(', ')}`);\r\n        } else {\r\n            console.warn('Non-critical validation errors, proceeding...');\r\n            if (onWarning) {\r\n                taskValidation.errors.forEach(error => {\r\n                    onWarning({\r\n                        ...error,\r\n                        severity: 'warning'\r\n                    });\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    if (taskValidation.hasWarnings && onWarning) {\r\n        taskValidation.warnings.forEach(warning => onWarning(warning));\r\n    }\r\n\r\n    if (parallel) {\r\n        const batches = [];\r\n        for (let i = 0; i < files.length; i += maxParallel) {\r\n            batches.push(files.slice(i, i + maxParallel));\r\n        }\r\n\r\n        for (let batchIndex = 0; batchIndex < batches.length; batchIndex++) {\r\n            const batch = batches[batchIndex];\r\n            const batchPromises = batch.map((file, fileIndex) =>\r\n                processSingleFile(file, task, batchIndex * maxParallel + fileIndex)\r\n            );\r\n\r\n            const batchResults = await Promise.allSettled(batchPromises);\r\n\r\n            batchResults.forEach((result, index) => {\r\n                if (result.status === 'fulfilled') {\r\n                    results.push(result.value);\r\n                } else {\r\n                    const errorResult = {\r\n                        file: batch[index],\r\n                        error: result.reason.message,\r\n                        success: false\r\n                    };\r\n                    results.push(errorResult);\r\n                    if (onError) onError(result.reason, batch[index]);\r\n                }\r\n            });\r\n\r\n            if (onProgress) {\r\n                const progress = results.length / totalFiles;\r\n                onProgress(progress, results.length, totalFiles);\r\n            }\r\n        }\r\n    } else {\r\n        for (let i = 0; i < files.length; i++) {\r\n            try {\r\n                console.log(`\\n=== Processing file ${i + 1}/${totalFiles} ===`);\r\n\r\n                const file = files[i];\r\n                console.log('File to process:', {\r\n                    type: file?.constructor?.name,\r\n                    name: file?.name || file?.originalName || file?.file?.name\r\n                });\r\n\r\n                const result = await processSingleFile(file, task, i);\r\n                results.push(result);\r\n\r\n                if (onProgress) {\r\n                    const progress = (i + 1) / totalFiles;\r\n                    onProgress(progress, i + 1, totalFiles);\r\n                }\r\n            } catch (error) {\r\n                console.error(`Failed to process file ${i}:`, error);\r\n                const errorResult = {\r\n                    file: files[i],\r\n                    error: error.message,\r\n                    success: false\r\n                };\r\n                results.push(errorResult);\r\n                if (onError) onError(error, files[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    console.log('\\n=== Processing complete ===');\r\n    console.log('Summary:', {\r\n        totalFiles,\r\n        successful: results.filter(r => r.success).length,\r\n        failed: results.filter(r => !r.success).length\r\n    });\r\n\r\n    results.forEach((result, index) => {\r\n        if (result.success) {\r\n            console.log(` File ${index + 1}: ${result.image?.originalName || 'Unknown'}`, {\r\n                success: true,\r\n                size: result.file?.size,\r\n                dimensions: result.image ? `${result.image.width}x${result.image.height}` : 'N/A'\r\n            });\r\n        } else {\r\n            console.log(` File ${index + 1}: Failed`, {\r\n                error: result.error,\r\n                fileName: result.file?.name || 'Unknown'\r\n            });\r\n        }\r\n    });\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Process images using a template\r\n */\r\nasync function processWithTemplate(image, templateId, options = {}) {\r\n    try {\r\n        const template = getTemplateById(templateId);\r\n        if (!template) {\r\n            throw new Error(`Template not found: ${templateId}`);\r\n        }\r\n\r\n        const compatibility = validateTemplateCompatibility(template, {\r\n            width: image.width,\r\n            height: image.height\r\n        });\r\n\r\n        if (!compatibility.compatible) {\r\n            throw new Error(`Template incompatible: ${compatibility.errors.map(e => e.message).join(', ')}`);\r\n        }\r\n\r\n        // Dynamically import LemGendImage\r\n        const { LemGendImage } = await import('./LemGendImage.js');\r\n\r\n        let lemGendImage;\r\n        if (image instanceof LemGendImage) {\r\n            lemGendImage = image;\r\n        } else {\r\n            lemGendImage = new LemGendImage(image);\r\n            await lemGendImage.load();\r\n        }\r\n\r\n        const task = new LemGendTask(`Template: ${template.displayName}`, template.description);\r\n\r\n        const widthInfo = parseDimension(template.width);\r\n        const heightInfo = parseDimension(template.height);\r\n\r\n        if (!widthInfo.isVariable && !heightInfo.isVariable) {\r\n            const aspect = widthInfo.value / heightInfo.value;\r\n            const imageAspect = lemGendImage.width / lemGendImage.height;\r\n\r\n            if (Math.abs(aspect - imageAspect) > 0.1) {\r\n                task.addCrop(widthInfo.value, heightInfo.value, 'smart');\r\n            } else {\r\n                task.addResize(Math.max(widthInfo.value, heightInfo.value), 'longest');\r\n            }\r\n        } else if (widthInfo.isVariable && !heightInfo.isVariable) {\r\n            task.addResize(heightInfo.value, 'height');\r\n        } else if (!widthInfo.isVariable && heightInfo.isVariable) {\r\n            task.addResize(widthInfo.value, 'width');\r\n        }\r\n\r\n        task.addOptimize(85, 'auto', {\r\n            compressionMode: 'adaptive',\r\n            preserveTransparency: template.recommendedFormats?.includes('png') || template.recommendedFormats?.includes('svg')\r\n        });\r\n\r\n        const results = await lemGendaryProcessBatch([lemGendImage], task);\r\n\r\n        if (results.length === 0 || !results[0].success) {\r\n            throw new Error('Template processing failed');\r\n        }\r\n\r\n        return {\r\n            success: true,\r\n            template,\r\n            image: results[0].image,\r\n            file: results[0].file,\r\n            compatibility,\r\n            warnings: compatibility.warnings\r\n        };\r\n    } catch (error) {\r\n        console.error('Template processing failed:', error);\r\n        return {\r\n            success: false,\r\n            error: error.message,\r\n            templateId\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Process flexible dimension template\r\n */\r\nasync function processFlexibleTemplate(image, template, options = {}) {\r\n    // Dynamically import LemGendImage\r\n    const { LemGendImage } = await import('./LemGendImage.js');\r\n\r\n    let lemGendImage;\r\n    if (image instanceof LemGendImage) {\r\n        lemGendImage = image;\r\n    } else {\r\n        lemGendImage = new LemGendImage(image);\r\n        await lemGendImage.load();\r\n    }\r\n\r\n    const widthInfo = parseDimension(template.width);\r\n    const heightInfo = parseDimension(template.height);\r\n\r\n    const task = new LemGendTask(`Flexible: ${template.displayName}`, template.description);\r\n\r\n    if (widthInfo.isVariable && !heightInfo.isVariable) {\r\n        task.addResize(heightInfo.value, 'height');\r\n    } else if (!widthInfo.isVariable && heightInfo.isVariable) {\r\n        task.addResize(widthInfo.value, 'width');\r\n    } else if (widthInfo.isVariable && heightInfo.isVariable) {\r\n        task.addOptimize(85, 'auto');\r\n    }\r\n\r\n    const results = await lemGendaryProcessBatch([lemGendImage], task);\r\n    return results[0] || { success: false, error: 'Processing failed' };\r\n}\r\n\r\n/**\r\n * Get library version and info\r\n */\r\nfunction getLibraryInfo() {\r\n    return {\r\n        name: 'LemGendary Image Processor',\r\n        version: '2.2.0',\r\n        description: 'Batch image processing with intelligent operations, AI-powered smart cropping, and advanced optimization',\r\n        author: 'LemGenda',\r\n        license: 'MIT',\r\n        homepage: 'https://github.com/lemgenda/image-lemgendizer-core',\r\n        processors: {\r\n            LemGendaryResize: {\r\n                name: 'LemGendaryResize',\r\n                description: 'Intelligent image resizing using longest dimension',\r\n                version: '1.2.1'\r\n            },\r\n            LemGendaryCrop: {\r\n                name: 'LemGendaryCrop',\r\n                description: 'AI-powered smart cropping with face and object detection',\r\n                version: '2.0.0'\r\n            },\r\n            LemGendaryOptimize: {\r\n                name: 'LemGendaryOptimize',\r\n                description: 'Advanced image optimization with intelligent format selection and adaptive compression',\r\n                version: '2.0.0'\r\n            },\r\n            LemGendaryRename: {\r\n                name: 'LemGendaryRename',\r\n                description: 'Batch renaming'\r\n            }\r\n        },\r\n        features: [\r\n            'Smart AI cropping',\r\n            'Face detection',\r\n            'Object detection',\r\n            'Content-aware resizing',\r\n            'Advanced optimization',\r\n            'Intelligent format selection',\r\n            'Adaptive compression',\r\n            'Batch processing',\r\n            'Favicon generation',\r\n            'Multiple format support',\r\n            'Optimization-first ZIP creation',\r\n            'Flexible dimension templates',\r\n            'Variable height/width support'\r\n        ]\r\n    };\r\n}\r\n\r\n// Export core functionality\r\nexport {\r\n    // Tasks\r\n    LemGendTask,\r\n\r\n    // Processors\r\n    LemGendaryResize,\r\n    LemGendaryCrop,\r\n    LemGendaryOptimize,\r\n    LemGendaryRename,\r\n\r\n    // Main processing function\r\n    lemGendaryProcessBatch,\r\n\r\n    // Template utilities\r\n    processWithTemplate,\r\n    processFlexibleTemplate,\r\n\r\n    // Info function\r\n    getLibraryInfo\r\n};\r\n\r\n// Note: LemGendImage is NOT exported here to avoid circular dependency\r\n// It should be imported directly from './LemGendImage.js'\r\n\r\n// Default export for convenience\r\nexport default {\r\n    // Note: LemGendImage is not included in default export to avoid circular dependency\r\n    // Users should import it directly: import { LemGendImage } from './LemGendImage.js'\r\n\r\n    // Tasks\r\n    LemGendTask,\r\n\r\n    // Processors\r\n    LemGendaryResize,\r\n    LemGendaryCrop,\r\n    LemGendaryOptimize,\r\n    LemGendaryRename,\r\n\r\n    // Main functions\r\n    lemGendaryProcessBatch,\r\n    getLibraryInfo,\r\n    processWithTemplate,\r\n    processFlexibleTemplate\r\n};"],"names":["index","hasTransparency","applyOptimizationUtil"],"mappings":"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"}