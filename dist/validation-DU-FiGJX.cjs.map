{"version":3,"file":"validation-DU-FiGJX.cjs","sources":["../src/utils/validation.js"],"sourcesContent":["/**\r\n * Validation utilities for LemGendary Image Processor\r\n * @module utils/validation\r\n */\r\n\r\n/**\r\n * Image validation errors\r\n */\r\nexport const ValidationErrors = {\r\n    INVALID_FILE: 'INVALID_FILE',\r\n    UNSUPPORTED_TYPE: 'UNSUPPORTED_TYPE',\r\n    FILE_TOO_LARGE: 'FILE_TOO_LARGE',\r\n    DIMENSIONS_TOO_SMALL: 'DIMENSIONS_TOO_SMALL',\r\n    DIMENSIONS_TOO_LARGE: 'DIMENSIONS_TOO_LARGE',\r\n    INVALID_DIMENSIONS: 'INVALID_DIMENSIONS',\r\n    ASPECT_RATIO_MISMATCH: 'ASPECT_RATIO_MISMATCH',\r\n    QUALITY_OUT_OF_RANGE: 'QUALITY_OUT_OF_RANGE',\r\n    INVALID_FORMAT: 'INVALID_FORMAT',\r\n    TRANSPARENCY_LOSS: 'TRANSPARENCY_LOSS',\r\n    EXCESSIVE_COMPRESSION: 'EXCESSIVE_COMPRESSION',\r\n    AVIF_BROWSER_SUPPORT: 'AVIF_BROWSER_SUPPORT',\r\n    VARIABLE_DIMENSION_NOT_ALLOWED: 'VARIABLE_DIMENSION_NOT_ALLOWED'\r\n}\r\n\r\n/**\r\n * Image validation warnings\r\n */\r\nexport const ValidationWarnings = {\r\n    LARGE_FILE: 'LARGE_FILE',\r\n    SMALL_DIMENSIONS: 'SMALL_DIMENSIONS',\r\n    LARGE_DIMENSIONS: 'LARGE_DIMENSIONS',\r\n    HIGH_QUALITY: 'HIGH_QUALITY',\r\n    LOW_QUALITY: 'LOW_QUALITY',\r\n    POTENTIAL_PIXELATION: 'POTENTIAL_PIXELATION',\r\n    CONTENT_LOSS: 'CONTENT_LOSS',\r\n    ASPECT_CHANGE: 'ASPECT_CHANGE',\r\n    MULTIPLE_OPTIMIZATIONS: 'MULTIPLE_OPTIMIZATIONS',\r\n    TRANSPARENCY_LOSS: 'TRANSPARENCY_LOSS',\r\n    AVIF_BROWSER_SUPPORT: 'AVIF_BROWSER_SUPPORT',\r\n    VARIABLE_DIMENSION_USED: 'VARIABLE_DIMENSION_USED',\r\n    FLEXIBLE_TEMPLATE: 'FLEXIBLE_TEMPLATE'\r\n}\r\n\r\n/**\r\n * Check if a value represents variable/flexible dimension\r\n * @param {*} value - Value to check\r\n * @returns {boolean} True if variable dimension\r\n */\r\nexport function isVariableDimension(value) {\r\n    if (typeof value === 'string') {\r\n        const lowerValue = value.toLowerCase()\r\n        return lowerValue === 'auto' ||\r\n            lowerValue === 'flex' ||\r\n            lowerValue === 'variable' ||\r\n            lowerValue === 'natural'\r\n    }\r\n    return false\r\n}\r\n\r\n/**\r\n * Parse dimension value (handles numbers and variable dimensions)\r\n * @param {*} value - Dimension value\r\n * @returns {Object} Parsed dimension info\r\n */\r\nexport function parseDimension(value) {\r\n    if (isVariableDimension(value)) {\r\n        return {\r\n            value: null,\r\n            isVariable: true,\r\n            type: value.toLowerCase(),\r\n            raw: value\r\n        }\r\n    }\r\n\r\n    const numValue = Number(value)\r\n    return {\r\n        value: isNaN(numValue) ? null : numValue,\r\n        isVariable: false,\r\n        type: 'fixed',\r\n        raw: value\r\n    }\r\n}\r\n\r\n/**\r\n * Format bytes to human-readable string\r\n * @private\r\n */\r\nfunction formatBytes(bytes, decimals = 2) {\r\n    if (bytes === 0) return '0 Bytes'\r\n\r\n    const k = 1024\r\n    const dm = decimals < 0 ? 0 : decimals\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']\r\n\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i]\r\n}\r\n\r\n/**\r\n * Validate optimization options - ENHANCED FUNCTION\r\n * @param {Object} options - Optimization options\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateOptimizationOptions(options = {}) {\r\n    const errors = []\r\n    const warnings = []\r\n    const result = { valid: true, errors, warnings }\r\n\r\n    // Default values\r\n    const quality = options.quality !== undefined ? options.quality : 85\r\n    const format = options.format || 'auto'\r\n    const compressionMode = options.compressionMode || 'adaptive'\r\n    const maxDisplayWidth = options.maxDisplayWidth\r\n    const browserSupport = options.browserSupport || ['modern', 'legacy']\r\n    const preserveTransparency = options.preserveTransparency !== false\r\n\r\n    // Validate quality\r\n    if (typeof quality !== 'number' || quality < 1 || quality > 100) {\r\n        errors.push({\r\n            code: ValidationErrors.QUALITY_OUT_OF_RANGE,\r\n            message: `Quality must be between 1-100, got ${quality}`,\r\n            severity: 'error',\r\n            suggestion: 'Use quality between 60-95 for best results'\r\n        })\r\n        result.valid = false\r\n    } else if (quality > 95) {\r\n        warnings.push({\r\n            code: ValidationWarnings.HIGH_QUALITY,\r\n            message: `High quality (${quality}%) provides minimal visual improvement over 90%`,\r\n            severity: 'info',\r\n            suggestion: 'Consider 80-90% for optimal balance'\r\n        })\r\n    } else if (quality < 50) {\r\n        warnings.push({\r\n            code: ValidationWarnings.LOW_QUALITY,\r\n            message: `Low quality (${quality}%) may cause noticeable artifacts`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider at least 60% for acceptable quality'\r\n        })\r\n    }\r\n\r\n    // Validate format\r\n    const validFormats = ['auto', 'webp', 'jpg', 'jpeg', 'png', 'avif', 'ico', 'svg', 'original']\r\n    if (!validFormats.includes(format.toLowerCase())) {\r\n        errors.push({\r\n            code: ValidationErrors.INVALID_FORMAT,\r\n            message: `Invalid format: ${format}`,\r\n            severity: 'error',\r\n            suggestion: `Use one of: ${validFormats.join(', ')}`\r\n        })\r\n        result.valid = false\r\n    }\r\n\r\n    // Validate AVIF quality adjustment\r\n    if (format.toLowerCase() === 'avif') {\r\n        const avifQuality = Math.min(63, Math.round(quality * 0.63))\r\n        if (avifQuality < quality) {\r\n            warnings.push({\r\n                code: 'AVIF_QUALITY_ADJUSTED',\r\n                message: `AVIF quality adjusted from ${quality} to ${avifQuality} (different quality scale)`,\r\n                severity: 'info'\r\n            })\r\n        }\r\n    }\r\n\r\n    // Validate maxDisplayWidth\r\n    if (maxDisplayWidth !== undefined && maxDisplayWidth !== null) {\r\n        if (typeof maxDisplayWidth !== 'number' || maxDisplayWidth < 10 || maxDisplayWidth > 10000) {\r\n            warnings.push({\r\n                code: 'EXTREME_MAX_DISPLAY_WIDTH',\r\n                message: `maxDisplayWidth (${maxDisplayWidth}) outside recommended range`,\r\n                severity: 'warning',\r\n                suggestion: 'Use between 100-4000px for web images'\r\n            })\r\n        }\r\n    }\r\n\r\n    // Validate compression mode\r\n    const validCompressionModes = ['adaptive', 'aggressive', 'balanced']\r\n    if (!validCompressionModes.includes(compressionMode)) {\r\n        warnings.push({\r\n            code: 'INVALID_COMPRESSION_MODE',\r\n            message: `Invalid compression mode: ${compressionMode}`,\r\n            severity: 'warning',\r\n            suggestion: `Use one of: ${validCompressionModes.join(', ')}`\r\n        })\r\n    }\r\n\r\n    // Validate browser support\r\n    if (browserSupport && !Array.isArray(browserSupport)) {\r\n        warnings.push({\r\n            code: 'INVALID_BROWSER_SUPPORT',\r\n            message: 'browserSupport should be an array',\r\n            severity: 'warning',\r\n            suggestion: 'Use [\"modern\", \"legacy\"] or [\"all\"]'\r\n        })\r\n    }\r\n\r\n    // Validate ICO sizes\r\n    if (options.icoSizes && Array.isArray(options.icoSizes)) {\r\n        options.icoSizes.forEach(size => {\r\n            if (size < 16 || size > 512) {\r\n                warnings.push({\r\n                    code: 'INVALID_ICO_SIZE',\r\n                    message: `ICO size ${size}px outside recommended range`,\r\n                    severity: 'warning',\r\n                    suggestion: 'Use sizes between 16-512px'\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    // Check for JPEG transparency incompatibility\r\n    if ((format.toLowerCase() === 'jpg' || format.toLowerCase() === 'jpeg') && preserveTransparency) {\r\n        warnings.push({\r\n            code: ValidationWarnings.TRANSPARENCY_LOSS,\r\n            message: 'JPEG format does not support transparency',\r\n            severity: 'warning',\r\n            suggestion: 'Use PNG or WebP to preserve transparency'\r\n        })\r\n    }\r\n\r\n    // AVIF browser support warning\r\n    if (format.toLowerCase() === 'avif' && (!browserSupport || !browserSupport.includes('modern'))) {\r\n        warnings.push({\r\n            code: ValidationWarnings.AVIF_BROWSER_SUPPORT,\r\n            message: 'AVIF format has limited browser support (Chrome 85+, Firefox 93+, Edge 85+)',\r\n            severity: 'info',\r\n            suggestion: 'Consider providing WebP fallback or use [\"modern\", \"legacy\"] browser support'\r\n        })\r\n    }\r\n\r\n    // Excessive compression warning\r\n    if (compressionMode === 'aggressive' && quality < 60) {\r\n        warnings.push({\r\n            code: ValidationWarnings.EXCESSIVE_COMPRESSION,\r\n            message: 'Aggressive compression with low quality may degrade image significantly',\r\n            severity: 'warning',\r\n            suggestion: 'Increase quality or use balanced/adaptive mode'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate image file\r\n * @param {File} file - Image file to validate\r\n * @param {Object} options - Validation options\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateImage(file, options = {}) {\r\n    const {\r\n        maxFileSize = 50 * 1024 * 1024, // 50MB\r\n        minFileSize = 1, // 1 byte\r\n        allowedTypes = [\r\n            'image/jpeg', 'image/jpg', 'image/png',\r\n            'image/webp', 'image/gif', 'image/svg+xml',\r\n            'image/bmp', 'image/tiff', 'image/avif',\r\n            'image/x-icon', 'image/vnd.microsoft.icon' // Added favicon support\r\n        ],\r\n        checkDimensions = false,\r\n        minDimensions = { width: 1, height: 1 },\r\n        maxDimensions = { width: 10000, height: 10000 }\r\n    } = options\r\n\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        metadata: {}\r\n    }\r\n\r\n    // Check if it's a valid File object\r\n    if (!(file instanceof File)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FILE,\r\n            message: 'Not a valid File object',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Check file size\r\n    if (file.size < minFileSize) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FILE,\r\n            message: 'File is empty',\r\n            severity: 'error'\r\n        })\r\n    } else if (file.size > maxFileSize) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.FILE_TOO_LARGE,\r\n            message: `File too large (${formatBytes(file.size)} > ${formatBytes(maxFileSize)})`,\r\n            severity: 'error'\r\n        })\r\n    } else if (file.size > 10 * 1024 * 1024) { // 10MB\r\n        result.warnings.push({\r\n            code: ValidationWarnings.LARGE_FILE,\r\n            message: `Large file (${formatBytes(file.size)}) may process slowly`,\r\n            severity: 'warning'\r\n        })\r\n    }\r\n\r\n    // Check file type\r\n    if (!allowedTypes.includes(file.type)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.UNSUPPORTED_TYPE,\r\n            message: `Unsupported file type: ${file.type}`,\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    // Store metadata\r\n    result.metadata = {\r\n        name: file.name,\r\n        type: file.type,\r\n        size: file.size,\r\n        lastModified: file.lastModified\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate dimensions - ENHANCED to handle variable dimensions\r\n * @param {Object} dimensions - Image dimensions\r\n * @param {Object} options - Validation options\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateDimensions(dimensions, options = {}) {\r\n    const {\r\n        minWidth = 1,\r\n        minHeight = 1,\r\n        maxWidth = 10000,\r\n        maxHeight = 10000,\r\n        requireIntegers = true,\r\n        allowVariable = true  // New option\r\n    } = options\r\n\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        dimensions: { ...dimensions },\r\n        hasVariableDimensions: false\r\n    }\r\n\r\n    const { width, height } = dimensions\r\n\r\n    // Parse dimensions\r\n    const widthInfo = parseDimension(width)\r\n    const heightInfo = parseDimension(height)\r\n\r\n    result.hasVariableDimensions = widthInfo.isVariable || heightInfo.isVariable\r\n\r\n    // Check if variable dimensions are allowed\r\n    if ((widthInfo.isVariable || heightInfo.isVariable) && !allowVariable) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.VARIABLE_DIMENSION_NOT_ALLOWED,\r\n            message: 'Variable dimensions are not allowed in this context',\r\n            severity: 'error',\r\n            suggestion: 'Provide fixed dimensions or enable allowVariable option'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Validate fixed dimensions\r\n    if (!widthInfo.isVariable) {\r\n        if (typeof widthInfo.value !== 'number' || isNaN(widthInfo.value)) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.INVALID_DIMENSIONS,\r\n                message: 'Width must be a valid number',\r\n                severity: 'error'\r\n            })\r\n        } else if (requireIntegers && !Number.isInteger(widthInfo.value)) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                message: 'Width should be an integer for best results',\r\n                severity: 'warning'\r\n            })\r\n        } else if (widthInfo.value < minWidth) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.DIMENSIONS_TOO_SMALL,\r\n                message: `Width too small (${widthInfo.value} < ${minWidth})`,\r\n                severity: 'error'\r\n            })\r\n        } else if (widthInfo.value > maxWidth) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.DIMENSIONS_TOO_LARGE,\r\n                message: `Width too large (${widthInfo.value} > ${maxWidth})`,\r\n                severity: 'error'\r\n            })\r\n        } else if (widthInfo.value < 50) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                message: `Small width (${widthInfo.value}px) may produce pixelated results`,\r\n                severity: 'warning'\r\n            })\r\n        }\r\n    }\r\n\r\n    if (!heightInfo.isVariable) {\r\n        if (typeof heightInfo.value !== 'number' || isNaN(heightInfo.value)) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.INVALID_DIMENSIONS,\r\n                message: 'Height must be a valid number',\r\n                severity: 'error'\r\n            })\r\n        } else if (requireIntegers && !Number.isInteger(heightInfo.value)) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                message: 'Height should be an integer for best results',\r\n                severity: 'warning'\r\n            })\r\n        } else if (heightInfo.value < minHeight) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.DIMENSIONS_TOO_SMALL,\r\n                message: `Height too small (${heightInfo.value} < ${minHeight})`,\r\n                severity: 'error'\r\n            })\r\n        } else if (heightInfo.value > maxHeight) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.DIMENSIONS_TOO_LARGE,\r\n                message: `Height too large (${heightInfo.value} > ${maxHeight})`,\r\n                severity: 'error'\r\n            })\r\n        } else if (heightInfo.value < 50) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                message: `Small height (${heightInfo.value}px) may produce pixelated results`,\r\n                severity: 'warning'\r\n            })\r\n        }\r\n    }\r\n\r\n    // Calculate aspect ratio only if both dimensions are fixed\r\n    if (!widthInfo.isVariable && !heightInfo.isVariable &&\r\n        widthInfo.value > 0 && heightInfo.value > 0) {\r\n        result.dimensions.aspectRatio = widthInfo.value / heightInfo.value\r\n        result.dimensions.orientation = widthInfo.value >= heightInfo.value ? 'landscape' : 'portrait'\r\n\r\n        // Check for extreme dimensions\r\n        if (widthInfo.value > 4000 || heightInfo.value > 4000) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.LARGE_DIMENSIONS,\r\n                message: `Large dimensions (${widthInfo.value}x${heightInfo.value}) may cause performance issues`,\r\n                severity: 'warning'\r\n            })\r\n        }\r\n    } else if (widthInfo.isVariable || heightInfo.isVariable) {\r\n        result.dimensions.hasVariable = true\r\n        result.dimensions.variableType = widthInfo.isVariable ? 'width' : 'height'\r\n\r\n        // Warn about variable dimensions\r\n        result.warnings.push({\r\n            code: ValidationWarnings.VARIABLE_DIMENSION_USED,\r\n            message: `Using ${widthInfo.isVariable ? 'variable width' : 'variable height'} dimension`,\r\n            severity: 'info',\r\n            suggestion: 'One dimension will be calculated automatically'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate resize operation with variable dimension support\r\n * @param {Object} currentDimensions - Current image dimensions\r\n * @param {number|string} targetDimension - Target dimension (can be number or 'flex')\r\n * @param {string} mode - Resize mode ('auto', 'width', 'height')\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateResize(currentDimensions, targetDimension, mode = 'auto') {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        newDimensions: null\r\n    }\r\n\r\n    // Validate current dimensions\r\n    const dimValidation = validateDimensions(currentDimensions)\r\n    if (!dimValidation.valid) {\r\n        return dimValidation\r\n    }\r\n\r\n    const { width, height } = currentDimensions\r\n\r\n    // Parse target dimension\r\n    const targetInfo = parseDimension(targetDimension)\r\n\r\n    // Validate target dimension\r\n    if (targetInfo.isVariable) {\r\n        // Variable target - only valid in certain modes\r\n        if (mode === 'width' && targetInfo.type === 'flex') {\r\n            // Flexible width - maintain aspect ratio based on fixed height\r\n            result.newDimensions = { width: 'flex', height: height }\r\n            result.warnings.push({\r\n                code: ValidationWarnings.FLEXIBLE_TEMPLATE,\r\n                message: 'Using flexible width - will maintain natural aspect ratio',\r\n                severity: 'info'\r\n            })\r\n            return result\r\n        } else if (mode === 'height' && targetInfo.type === 'flex') {\r\n            // Flexible height - maintain aspect ratio based on fixed width\r\n            result.newDimensions = { width: width, height: 'flex' }\r\n            result.warnings.push({\r\n                code: ValidationWarnings.FLEXIBLE_TEMPLATE,\r\n                message: 'Using flexible height - will maintain natural aspect ratio',\r\n                severity: 'info'\r\n            })\r\n            return result\r\n        } else {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.INVALID_DIMENSIONS,\r\n                message: `Invalid target dimension for mode ${mode}: ${targetDimension}`,\r\n                severity: 'error'\r\n            })\r\n            return result\r\n        }\r\n    }\r\n\r\n    // Fixed target dimension validation\r\n    if (typeof targetInfo.value !== 'number' || targetInfo.value <= 0) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_DIMENSIONS,\r\n            message: `Invalid target dimension: ${targetDimension}`,\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Calculate new dimensions\r\n    let newWidth, newHeight\r\n    if (mode === 'width') {\r\n        newWidth = targetInfo.value\r\n        newHeight = Math.round((height / width) * targetInfo.value)\r\n    } else if (mode === 'height') {\r\n        newHeight = targetInfo.value\r\n        newWidth = Math.round((width / height) * targetInfo.value)\r\n    } else { // auto\r\n        if (width >= height) {\r\n            newWidth = targetInfo.value\r\n            newHeight = Math.round((height / width) * targetInfo.value)\r\n        } else {\r\n            newHeight = targetInfo.value\r\n            newWidth = Math.round((width / height) * targetInfo.value)\r\n        }\r\n    }\r\n\r\n    result.newDimensions = { width: newWidth, height: newHeight }\r\n\r\n    // Validate new dimensions\r\n    const newDimValidation = validateDimensions(result.newDimensions)\r\n    if (!newDimValidation.valid) {\r\n        return newDimValidation\r\n    }\r\n\r\n    // Add resize-specific warnings\r\n    const scaleFactor = newWidth / width\r\n\r\n    // Extreme downscaling warning\r\n    if (scaleFactor < 0.1) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.POTENTIAL_PIXELATION,\r\n            message: `Downscaling by ${((1 - scaleFactor) * 100).toFixed(1)}% may cause pixelation`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider using nearest-neighbor algorithm for pixel art'\r\n        })\r\n    }\r\n\r\n    // Extreme upscaling warning\r\n    if (scaleFactor > 4) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.POTENTIAL_PIXELATION,\r\n            message: `Upscaling by ${((scaleFactor - 1) * 100).toFixed(1)}% may reduce quality`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider using AI upscaling tools for better results'\r\n        })\r\n    }\r\n\r\n    // Aspect ratio change warning\r\n    const originalAspect = width / height\r\n    const newAspect = newWidth / newHeight\r\n    const aspectDiff = Math.abs(originalAspect - newAspect) / originalAspect\r\n\r\n    if (aspectDiff > 0.01) { // More than 1% deviation\r\n        result.warnings.push({\r\n            code: ValidationWarnings.ASPECT_CHANGE,\r\n            message: `Aspect ratio changed from ${originalAspect.toFixed(3)} to ${newAspect.toFixed(3)}`,\r\n            severity: 'info',\r\n            suggestion: 'Check if this deviation is acceptable'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate crop operation\r\n * @param {Object} currentDimensions - Current image dimensions\r\n * @param {number|string} cropWidth - Crop width (can be number or 'flex')\r\n * @param {number|string} cropHeight - Crop height (can be number or 'flex')\r\n * @param {string} position - Crop position\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateCrop(currentDimensions, cropWidth, cropHeight, position = 'center') {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        cropInfo: null\r\n    }\r\n\r\n    // Validate current dimensions\r\n    const dimValidation = validateDimensions(currentDimensions)\r\n    if (!dimValidation.valid) {\r\n        return dimValidation\r\n    }\r\n\r\n    const { width, height } = currentDimensions\r\n\r\n    // Parse crop dimensions\r\n    const cropWidthInfo = parseDimension(cropWidth)\r\n    const cropHeightInfo = parseDimension(cropHeight)\r\n\r\n    // Check for variable dimensions in crop\r\n    if (cropWidthInfo.isVariable || cropHeightInfo.isVariable) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.FLEXIBLE_TEMPLATE,\r\n            message: 'Using flexible dimensions for crop - will use maximum available space',\r\n            severity: 'info'\r\n        })\r\n\r\n        // For flexible crop, use original dimensions as max\r\n        const actualCropWidth = cropWidthInfo.isVariable ? width : cropWidthInfo.value\r\n        const actualCropHeight = cropHeightInfo.isVariable ? height : cropHeightInfo.value\r\n\r\n        result.cropInfo = {\r\n            cropDimensions: { width: actualCropWidth, height: actualCropHeight },\r\n            offsets: { x: 0, y: 0 },\r\n            position: 'center',\r\n            scale: 1,\r\n            hasFlexibleDimensions: true,\r\n            flexibleWidth: cropWidthInfo.isVariable,\r\n            flexibleHeight: cropHeightInfo.isVariable\r\n        }\r\n\r\n        return result\r\n    }\r\n\r\n    // Validate fixed crop dimensions\r\n    const cropDimValidation = validateDimensions({ width: cropWidthInfo.value, height: cropHeightInfo.value })\r\n    if (!cropDimValidation.valid) {\r\n        return cropDimValidation\r\n    }\r\n\r\n    // Calculate scale to fit\r\n    const scale = Math.max(cropWidthInfo.value / width, cropHeightInfo.value / height)\r\n    const scaledWidth = Math.round(width * scale)\r\n    const scaledHeight = Math.round(height * scale)\r\n\r\n    // Calculate crop offsets\r\n    let offsetX, offsetY\r\n    switch (position) {\r\n        case 'top':\r\n            offsetX = (scaledWidth - cropWidthInfo.value) / 2\r\n            offsetY = 0\r\n            break\r\n        case 'bottom':\r\n            offsetX = (scaledWidth - cropWidthInfo.value) / 2\r\n            offsetY = scaledHeight - cropHeightInfo.value\r\n            break\r\n        case 'left':\r\n            offsetX = 0\r\n            offsetY = (scaledHeight - cropHeightInfo.value) / 2\r\n            break\r\n        case 'right':\r\n            offsetX = scaledWidth - cropWidthInfo.value\r\n            offsetY = (scaledHeight - cropHeightInfo.value) / 2\r\n            break\r\n        case 'center':\r\n        default:\r\n            offsetX = (scaledWidth - cropWidthInfo.value) / 2\r\n            offsetY = (scaledHeight - cropHeightInfo.value) / 2\r\n    }\r\n\r\n    result.cropInfo = {\r\n        scaledDimensions: { width: scaledWidth, height: scaledHeight },\r\n        cropDimensions: { width: cropWidthInfo.value, height: cropHeightInfo.value },\r\n        offsets: { x: Math.max(0, Math.round(offsetX)), y: Math.max(0, Math.round(offsetY)) },\r\n        position,\r\n        scale\r\n    }\r\n\r\n    // Add crop-specific warnings\r\n    const contentLostX = Math.max(0, (cropWidthInfo.value - width) / width)\r\n    const contentLostY = Math.max(0, (cropHeightInfo.value - height) / height)\r\n    const maxContentLost = Math.max(contentLostX, contentLostY)\r\n\r\n    if (maxContentLost > 0.3) { // More than 30% content lost\r\n        result.warnings.push({\r\n            code: ValidationWarnings.CONTENT_LOSS,\r\n            message: `Crop will remove ${(maxContentLost * 100).toFixed(1)}% of image content`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider adjusting crop dimensions or position'\r\n        })\r\n    }\r\n\r\n    // Aspect ratio mismatch warning\r\n    const sourceAspect = width / height\r\n    const targetAspect = cropWidthInfo.value / cropHeightInfo.value\r\n    const aspectDiff = Math.abs(sourceAspect - targetAspect) / sourceAspect\r\n\r\n    if (aspectDiff > 0.5) { // More than 50% aspect ratio difference\r\n        result.warnings.push({\r\n            code: ValidationWarnings.ASPECT_CHANGE,\r\n            message: `Source aspect ratio (${sourceAspect.toFixed(2)}) differs significantly from target (${targetAspect.toFixed(2)})`,\r\n            severity: 'warning',\r\n            suggestion: 'This may result in stretched appearance'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate optimization settings\r\n * @param {string} currentFormat - Current image format\r\n * @param {string} targetFormat - Target format\r\n * @param {number} quality - Quality percentage\r\n * @param {boolean} hasTransparency - Whether image has transparency\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateOptimization(currentFormat, targetFormat, quality, hasTransparency = false) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        recommendations: []\r\n    }\r\n\r\n    // Validate quality\r\n    if (typeof quality !== 'number' || quality < 1 || quality > 100) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.QUALITY_OUT_OF_RANGE,\r\n            message: `Quality must be between 1-100, got ${quality}`,\r\n            severity: 'error'\r\n        })\r\n    } else if (quality > 95) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.HIGH_QUALITY,\r\n            message: `High quality setting (${quality}%) provides minimal visual improvement`,\r\n            severity: 'info',\r\n            suggestion: 'Consider 80-85% for optimal balance'\r\n        })\r\n    } else if (quality < 50) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.LOW_QUALITY,\r\n            message: `Low quality setting (${quality}%) may cause noticeable artifacts`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider 60%+ for acceptable quality'\r\n        })\r\n    }\r\n\r\n    // Validate format compatibility\r\n    const formatMatrix = {\r\n        'jpg': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'tiff', 'ico'],\r\n        'jpeg': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'tiff', 'ico'],\r\n        'png': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'tiff', 'svg', 'ico'],\r\n        'webp': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'tiff', 'svg', 'ico'],\r\n        'avif': ['jpeg', 'png', 'webp', 'ico'],\r\n        'ico': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'ico'] // Added favicon support\r\n    }\r\n\r\n    const current = currentFormat.toLowerCase().replace('image/', '')\r\n    const target = targetFormat.toLowerCase()\r\n\r\n    if (target !== 'original' && !formatMatrix[target]?.includes(current)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FORMAT,\r\n            message: `Cannot convert ${current} to ${target}`,\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    // Transparency loss warning\r\n    if ((target === 'jpg' || target === 'jpeg') && hasTransparency) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.TRANSPARENCY_LOSS,\r\n            message: 'JPEG format does not support transparency',\r\n            severity: 'warning',\r\n            suggestion: 'Use PNG or WebP to preserve transparency'\r\n        })\r\n    }\r\n\r\n    // Format-specific recommendations\r\n    if (target === 'webp') {\r\n        if (quality > 90) {\r\n            result.recommendations.push({\r\n                type: 'quality_adjustment',\r\n                message: 'WebP quality above 90 has diminishing returns',\r\n                suggestion: 'Use 80-85% for optimal size/quality balance'\r\n            })\r\n        }\r\n    } else if (target === 'jpg' || target === 'jpeg') {\r\n        result.recommendations.push({\r\n            type: 'format_suggestion',\r\n            message: 'Consider WebP for better compression with similar quality',\r\n            suggestion: 'WebP typically provides 25-35% smaller files than JPEG'\r\n        })\r\n    } else if (target === 'ico') {\r\n        result.recommendations.push({\r\n            type: 'format_suggestion',\r\n            message: 'ICO format is best for favicons and Windows icons',\r\n            suggestion: 'Include multiple sizes (16×16, 32×32, 48×48, 64×64) in single .ico file'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate batch rename pattern\r\n * @param {string} pattern - Rename pattern\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateRenamePattern(pattern) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        variables: []\r\n    }\r\n\r\n    if (typeof pattern !== 'string' || pattern.trim() === '') {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FORMAT,\r\n            message: 'Pattern cannot be empty',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Check for invalid filename characters\r\n    const invalidChars = /[<>:\"/\\\\|?*]/\r\n    if (invalidChars.test(pattern)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FORMAT,\r\n            message: 'Pattern contains invalid filename characters',\r\n            severity: 'error',\r\n            details: 'Remove <>:\"/\\\\|?* from pattern'\r\n        })\r\n    }\r\n\r\n    // Extract variables\r\n    const variableRegex = /\\{(\\w+)\\}/g\r\n    let match\r\n    const variables = new Set()\r\n\r\n    while ((match = variableRegex.exec(pattern)) !== null) {\r\n        variables.add(match[1])\r\n    }\r\n\r\n    result.variables = Array.from(variables)\r\n\r\n    // Check for unknown variables\r\n    const knownVariables = [\r\n        'name', 'index', 'date', 'time', 'year', 'month', 'day',\r\n        'hour', 'minute', 'second', 'timestamp', 'width', 'height',\r\n        'size', 'format', 'ext', 'orientation', 'aspect', 'total', 'padded'\r\n    ]\r\n\r\n    const unknownVars = result.variables.filter(v => !knownVariables.includes(v))\r\n    if (unknownVars.length > 0) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.CONTENT_LOSS,\r\n            message: `Unknown variables: ${unknownVars.join(', ')}`,\r\n            severity: 'warning',\r\n            suggestion: 'These variables will not be replaced'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate template dimensions compatibility\r\n * @param {Object} template - Template with dimensions\r\n * @param {Object} imageDimensions - Image dimensions\r\n * @returns {Object} Compatibility result\r\n */\r\nexport function validateTemplateCompatibility(template, imageDimensions) {\r\n    const result = {\r\n        compatible: true,\r\n        errors: [],\r\n        warnings: [],\r\n        matchScore: 0,\r\n        recommendations: []\r\n    }\r\n\r\n    // Parse template dimensions\r\n    const templateWidth = parseDimension(template.width)\r\n    const templateHeight = parseDimension(template.height)\r\n\r\n    // Parse image dimensions\r\n    const imageWidth = parseDimension(imageDimensions.width)\r\n    const imageHeight = parseDimension(imageDimensions.height)\r\n\r\n    // Check for variable dimensions in template\r\n    if (templateWidth.isVariable || templateHeight.isVariable) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.FLEXIBLE_TEMPLATE,\r\n            message: 'Using flexible template - one dimension will adapt automatically',\r\n            severity: 'info'\r\n        })\r\n\r\n        // Calculate match score for flexible template\r\n        let score = 80 // High base score for flexible templates\r\n\r\n        // Check aspect ratio compatibility if both image dimensions are fixed\r\n        if (!imageWidth.isVariable && !imageHeight.isVariable) {\r\n            if (templateWidth.isVariable && !templateHeight.isVariable) {\r\n                // Height fixed, check if image has sufficient height\r\n                const heightRatio = imageHeight.value / templateHeight.value\r\n                if (heightRatio >= 0.8) {\r\n                    score += 20\r\n                } else {\r\n                    score *= heightRatio\r\n                    result.warnings.push({\r\n                        code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                        message: `Image height (${imageHeight.value}px) is smaller than template height (${templateHeight.value}px)`,\r\n                        severity: 'warning'\r\n                    })\r\n                }\r\n            } else if (!templateWidth.isVariable && templateHeight.isVariable) {\r\n                // Width fixed, check if image has sufficient width\r\n                const widthRatio = imageWidth.value / templateWidth.value\r\n                if (widthRatio >= 0.8) {\r\n                    score += 20\r\n                } else {\r\n                    score *= widthRatio\r\n                    result.warnings.push({\r\n                        code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                        message: `Image width (${imageWidth.value}px) is smaller than template width (${templateWidth.value}px)`,\r\n                        severity: 'warning'\r\n                    })\r\n                }\r\n            }\r\n        }\r\n\r\n        result.matchScore = score / 100\r\n        result.compatible = true\r\n        return result\r\n    }\r\n\r\n    // Fixed template dimensions validation\r\n    if (imageWidth.isVariable || imageHeight.isVariable) {\r\n        result.compatible = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_DIMENSIONS,\r\n            message: 'Cannot use variable image dimensions with fixed template',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Check if image meets minimum template dimensions\r\n    if (imageWidth.value < templateWidth.value || imageHeight.value < templateHeight.value) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.SMALL_DIMENSIONS,\r\n            message: `Image dimensions (${imageWidth.value}x${imageHeight.value}) are smaller than template (${templateWidth.value}x${templateHeight.value})`,\r\n            severity: 'warning'\r\n        })\r\n\r\n        // Calculate how much smaller\r\n        const widthRatio = imageWidth.value / templateWidth.value\r\n        const heightRatio = imageHeight.value / templateHeight.value\r\n        const minRatio = Math.min(widthRatio, heightRatio)\r\n\r\n        result.matchScore = minRatio * 0.8 // Scale score based on size adequacy\r\n    } else {\r\n        // Image is equal or larger - good match\r\n        result.matchScore = 0.9\r\n\r\n        // Check aspect ratio\r\n        const imageAspect = imageWidth.value / imageHeight.value\r\n        const templateAspect = templateWidth.value / templateHeight.value\r\n        const aspectDiff = Math.abs(imageAspect - templateAspect) / imageAspect\r\n\r\n        if (aspectDiff > 0.1) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.ASPECT_CHANGE,\r\n                message: `Aspect ratio differs (image: ${imageAspect.toFixed(2)}, template: ${templateAspect.toFixed(2)})`,\r\n                severity: 'warning',\r\n                suggestion: 'Consider cropping to match template aspect ratio'\r\n            })\r\n            result.matchScore *= 0.8 // Reduce score for aspect mismatch\r\n        }\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Get validation summary\r\n * @param {Object} validationResults - Array of validation results\r\n * @returns {Object} Summary\r\n */\r\nexport function getValidationSummary(validationResults) {\r\n    const summary = {\r\n        total: validationResults.length,\r\n        valid: 0,\r\n        errors: 0,\r\n        warnings: 0,\r\n        errorDetails: [],\r\n        warningDetails: []\r\n    }\r\n\r\n    validationResults.forEach(result => {\r\n        if (result.valid) summary.valid++\r\n        summary.errors += result.errors.length\r\n        summary.warnings += result.warnings.length\r\n\r\n        result.errors.forEach(error => {\r\n            summary.errorDetails.push({\r\n                ...error,\r\n                source: result.metadata?.name || 'Unknown'\r\n            })\r\n        })\r\n\r\n        result.warnings.forEach(warning => {\r\n            summary.warningDetails.push({\r\n                ...warning,\r\n                source: result.metadata?.name || 'Unknown'\r\n            })\r\n        })\r\n    })\r\n\r\n    return summary\r\n}\r\n\r\n/**\r\n * Get all flexible dimension templates\r\n * @param {Array} templates - Template array\r\n * @returns {Array} Templates with flexible dimensions\r\n */\r\nexport function getFlexibleTemplates(templates) {\r\n    return templates.filter(template => {\r\n        const widthInfo = parseDimension(template.width)\r\n        const heightInfo = parseDimension(template.height)\r\n        return widthInfo.isVariable || heightInfo.isVariable\r\n    })\r\n}\r\n\r\nexport default {\r\n    ValidationErrors,\r\n    ValidationWarnings,\r\n    isVariableDimension,\r\n    parseDimension,\r\n    validateOptimizationOptions,\r\n    validateImage,\r\n    validateDimensions,\r\n    validateResize,\r\n    validateCrop,\r\n    validateOptimization,\r\n    validateRenamePattern,\r\n    validateTemplateCompatibility,\r\n    getValidationSummary,\r\n    getFlexibleTemplates\r\n}"],"names":["ValidationErrors","ValidationWarnings","isVariableDimension","value","lowerValue","parseDimension","numValue","formatBytes","bytes","decimals","k","dm","sizes","i","validateOptimizationOptions","options","errors","warnings","result","quality","format","compressionMode","maxDisplayWidth","browserSupport","preserveTransparency","validFormats","avifQuality","validCompressionModes","size","validateImage","file","maxFileSize","minFileSize","allowedTypes","checkDimensions","minDimensions","maxDimensions","validateDimensions","dimensions","minWidth","minHeight","maxWidth","maxHeight","requireIntegers","allowVariable","width","height","widthInfo","heightInfo","validateResize","currentDimensions","targetDimension","mode","dimValidation","targetInfo","newWidth","newHeight","newDimValidation","scaleFactor","originalAspect","newAspect","validateCrop","cropWidth","cropHeight","position","cropWidthInfo","cropHeightInfo","actualCropWidth","actualCropHeight","cropDimValidation","scale","scaledWidth","scaledHeight","offsetX","offsetY","contentLostX","contentLostY","maxContentLost","sourceAspect","targetAspect","validateOptimization","currentFormat","targetFormat","hasTransparency","formatMatrix","current","target","validateRenamePattern","pattern","variableRegex","match","variables","knownVariables","unknownVars","v","validateTemplateCompatibility","template","imageDimensions","templateWidth","templateHeight","imageWidth","imageHeight","score","heightRatio","widthRatio","minRatio","imageAspect","templateAspect","getValidationSummary","validationResults","summary","error","warning","getFlexibleTemplates","templates","validation"],"mappings":"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"}