{"version":3,"file":"validation-D92jbWMx.js","sources":["../src/utils/validation.js"],"sourcesContent":["/**\r\n * Validation utilities for LemGendary Image Processor\r\n * @module utils/validation\r\n */\r\n\r\n/**\r\n * Image validation errors\r\n */\r\nexport const ValidationErrors = {\r\n    INVALID_FILE: 'INVALID_FILE',\r\n    UNSUPPORTED_TYPE: 'UNSUPPORTED_TYPE',\r\n    FILE_TOO_LARGE: 'FILE_TOO_LARGE',\r\n    DIMENSIONS_TOO_SMALL: 'DIMENSIONS_TOO_SMALL',\r\n    DIMENSIONS_TOO_LARGE: 'DIMENSIONS_TOO_LARGE',\r\n    INVALID_DIMENSIONS: 'INVALID_DIMENSIONS',\r\n    ASPECT_RATIO_MISMATCH: 'ASPECT_RATIO_MISMATCH',\r\n    QUALITY_OUT_OF_RANGE: 'QUALITY_OUT_OF_RANGE',\r\n    INVALID_FORMAT: 'INVALID_FORMAT',\r\n    TRANSPARENCY_LOSS: 'TRANSPARENCY_LOSS',\r\n    EXCESSIVE_COMPRESSION: 'EXCESSIVE_COMPRESSION',\r\n    AVIF_BROWSER_SUPPORT: 'AVIF_BROWSER_SUPPORT',\r\n    VARIABLE_DIMENSION_NOT_ALLOWED: 'VARIABLE_DIMENSION_NOT_ALLOWED'\r\n}\r\n\r\n/**\r\n * Image validation warnings\r\n */\r\nexport const ValidationWarnings = {\r\n    LARGE_FILE: 'LARGE_FILE',\r\n    SMALL_DIMENSIONS: 'SMALL_DIMENSIONS',\r\n    LARGE_DIMENSIONS: 'LARGE_DIMENSIONS',\r\n    HIGH_QUALITY: 'HIGH_QUALITY',\r\n    LOW_QUALITY: 'LOW_QUALITY',\r\n    POTENTIAL_PIXELATION: 'POTENTIAL_PIXELATION',\r\n    CONTENT_LOSS: 'CONTENT_LOSS',\r\n    ASPECT_CHANGE: 'ASPECT_CHANGE',\r\n    MULTIPLE_OPTIMIZATIONS: 'MULTIPLE_OPTIMIZATIONS',\r\n    TRANSPARENCY_LOSS: 'TRANSPARENCY_LOSS',\r\n    AVIF_BROWSER_SUPPORT: 'AVIF_BROWSER_SUPPORT',\r\n    VARIABLE_DIMENSION_USED: 'VARIABLE_DIMENSION_USED',\r\n    FLEXIBLE_TEMPLATE: 'FLEXIBLE_TEMPLATE'\r\n}\r\n\r\n/**\r\n * Check if a value represents variable/flexible dimension\r\n * @param {*} value - Value to check\r\n * @returns {boolean} True if variable dimension\r\n */\r\nexport function isVariableDimension(value) {\r\n    if (typeof value === 'string') {\r\n        const lowerValue = value.toLowerCase()\r\n        return lowerValue === 'auto' ||\r\n            lowerValue === 'flex' ||\r\n            lowerValue === 'variable' ||\r\n            lowerValue === 'natural'\r\n    }\r\n    return false\r\n}\r\n\r\n/**\r\n * Parse dimension value (handles numbers and variable dimensions)\r\n * @param {*} value - Dimension value\r\n * @returns {Object} Parsed dimension info\r\n */\r\nexport function parseDimension(value) {\r\n    if (isVariableDimension(value)) {\r\n        return {\r\n            value: null,\r\n            isVariable: true,\r\n            type: value.toLowerCase(),\r\n            raw: value\r\n        }\r\n    }\r\n\r\n    const numValue = Number(value)\r\n    return {\r\n        value: isNaN(numValue) ? null : numValue,\r\n        isVariable: false,\r\n        type: 'fixed',\r\n        raw: value\r\n    }\r\n}\r\n\r\n/**\r\n * Format bytes to human-readable string\r\n * @private\r\n */\r\nfunction formatBytes(bytes, decimals = 2) {\r\n    if (bytes === 0) return '0 Bytes'\r\n\r\n    const k = 1024\r\n    const dm = decimals < 0 ? 0 : decimals\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']\r\n\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i]\r\n}\r\n\r\n/**\r\n * Validate optimization options - ENHANCED FUNCTION\r\n * @param {Object} options - Optimization options\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateOptimizationOptions(options = {}) {\r\n    const errors = []\r\n    const warnings = []\r\n    const result = { valid: true, errors, warnings }\r\n\r\n    // Default values\r\n    const quality = options.quality !== undefined ? options.quality : 85\r\n    const format = options.format || 'auto'\r\n    const compressionMode = options.compressionMode || 'adaptive'\r\n    const maxDisplayWidth = options.maxDisplayWidth\r\n    const browserSupport = options.browserSupport || ['modern', 'legacy']\r\n    const preserveTransparency = options.preserveTransparency !== false\r\n\r\n    // Validate quality\r\n    if (typeof quality !== 'number' || quality < 1 || quality > 100) {\r\n        errors.push({\r\n            code: ValidationErrors.QUALITY_OUT_OF_RANGE,\r\n            message: `Quality must be between 1-100, got ${quality}`,\r\n            severity: 'error',\r\n            suggestion: 'Use quality between 60-95 for best results'\r\n        })\r\n        result.valid = false\r\n    } else if (quality > 95) {\r\n        warnings.push({\r\n            code: ValidationWarnings.HIGH_QUALITY,\r\n            message: `High quality (${quality}%) provides minimal visual improvement over 90%`,\r\n            severity: 'info',\r\n            suggestion: 'Consider 80-90% for optimal balance'\r\n        })\r\n    } else if (quality < 50) {\r\n        warnings.push({\r\n            code: ValidationWarnings.LOW_QUALITY,\r\n            message: `Low quality (${quality}%) may cause noticeable artifacts`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider at least 60% for acceptable quality'\r\n        })\r\n    }\r\n\r\n    // Validate format\r\n    const validFormats = ['auto', 'webp', 'jpg', 'jpeg', 'png', 'avif', 'ico', 'svg', 'original']\r\n    if (!validFormats.includes(format.toLowerCase())) {\r\n        errors.push({\r\n            code: ValidationErrors.INVALID_FORMAT,\r\n            message: `Invalid format: ${format}`,\r\n            severity: 'error',\r\n            suggestion: `Use one of: ${validFormats.join(', ')}`\r\n        })\r\n        result.valid = false\r\n    }\r\n\r\n    // Validate AVIF quality adjustment\r\n    if (format.toLowerCase() === 'avif') {\r\n        const avifQuality = Math.min(63, Math.round(quality * 0.63))\r\n        if (avifQuality < quality) {\r\n            warnings.push({\r\n                code: 'AVIF_QUALITY_ADJUSTED',\r\n                message: `AVIF quality adjusted from ${quality} to ${avifQuality} (different quality scale)`,\r\n                severity: 'info'\r\n            })\r\n        }\r\n    }\r\n\r\n    // Validate maxDisplayWidth\r\n    if (maxDisplayWidth !== undefined && maxDisplayWidth !== null) {\r\n        if (typeof maxDisplayWidth !== 'number' || maxDisplayWidth < 10 || maxDisplayWidth > 10000) {\r\n            warnings.push({\r\n                code: 'EXTREME_MAX_DISPLAY_WIDTH',\r\n                message: `maxDisplayWidth (${maxDisplayWidth}) outside recommended range`,\r\n                severity: 'warning',\r\n                suggestion: 'Use between 100-4000px for web images'\r\n            })\r\n        }\r\n    }\r\n\r\n    // Validate compression mode\r\n    const validCompressionModes = ['adaptive', 'aggressive', 'balanced']\r\n    if (!validCompressionModes.includes(compressionMode)) {\r\n        warnings.push({\r\n            code: 'INVALID_COMPRESSION_MODE',\r\n            message: `Invalid compression mode: ${compressionMode}`,\r\n            severity: 'warning',\r\n            suggestion: `Use one of: ${validCompressionModes.join(', ')}`\r\n        })\r\n    }\r\n\r\n    // Validate browser support\r\n    if (browserSupport && !Array.isArray(browserSupport)) {\r\n        warnings.push({\r\n            code: 'INVALID_BROWSER_SUPPORT',\r\n            message: 'browserSupport should be an array',\r\n            severity: 'warning',\r\n            suggestion: 'Use [\"modern\", \"legacy\"] or [\"all\"]'\r\n        })\r\n    }\r\n\r\n    // Validate ICO sizes\r\n    if (options.icoSizes && Array.isArray(options.icoSizes)) {\r\n        options.icoSizes.forEach(size => {\r\n            if (size < 16 || size > 512) {\r\n                warnings.push({\r\n                    code: 'INVALID_ICO_SIZE',\r\n                    message: `ICO size ${size}px outside recommended range`,\r\n                    severity: 'warning',\r\n                    suggestion: 'Use sizes between 16-512px'\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    // Check for JPEG transparency incompatibility\r\n    if ((format.toLowerCase() === 'jpg' || format.toLowerCase() === 'jpeg') && preserveTransparency) {\r\n        warnings.push({\r\n            code: ValidationWarnings.TRANSPARENCY_LOSS,\r\n            message: 'JPEG format does not support transparency',\r\n            severity: 'warning',\r\n            suggestion: 'Use PNG or WebP to preserve transparency'\r\n        })\r\n    }\r\n\r\n    // AVIF browser support warning\r\n    if (format.toLowerCase() === 'avif' && (!browserSupport || !browserSupport.includes('modern'))) {\r\n        warnings.push({\r\n            code: ValidationWarnings.AVIF_BROWSER_SUPPORT,\r\n            message: 'AVIF format has limited browser support (Chrome 85+, Firefox 93+, Edge 85+)',\r\n            severity: 'info',\r\n            suggestion: 'Consider providing WebP fallback or use [\"modern\", \"legacy\"] browser support'\r\n        })\r\n    }\r\n\r\n    // Excessive compression warning\r\n    if (compressionMode === 'aggressive' && quality < 60) {\r\n        warnings.push({\r\n            code: ValidationWarnings.EXCESSIVE_COMPRESSION,\r\n            message: 'Aggressive compression with low quality may degrade image significantly',\r\n            severity: 'warning',\r\n            suggestion: 'Increase quality or use balanced/adaptive mode'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate image file\r\n * @param {File} file - Image file to validate\r\n * @param {Object} options - Validation options\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateImage(file, options = {}) {\r\n    const {\r\n        maxFileSize = 50 * 1024 * 1024, // 50MB\r\n        minFileSize = 1, // 1 byte\r\n        allowedTypes = [\r\n            'image/jpeg', 'image/jpg', 'image/png',\r\n            'image/webp', 'image/gif', 'image/svg+xml',\r\n            'image/bmp', 'image/tiff', 'image/avif',\r\n            'image/x-icon', 'image/vnd.microsoft.icon' // Added favicon support\r\n        ],\r\n        checkDimensions = false,\r\n        minDimensions = { width: 1, height: 1 },\r\n        maxDimensions = { width: 10000, height: 10000 }\r\n    } = options\r\n\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        metadata: {}\r\n    }\r\n\r\n    // Check if it's a valid File object\r\n    if (!(file instanceof File)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FILE,\r\n            message: 'Not a valid File object',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Check file size\r\n    if (file.size < minFileSize) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FILE,\r\n            message: 'File is empty',\r\n            severity: 'error'\r\n        })\r\n    } else if (file.size > maxFileSize) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.FILE_TOO_LARGE,\r\n            message: `File too large (${formatBytes(file.size)} > ${formatBytes(maxFileSize)})`,\r\n            severity: 'error'\r\n        })\r\n    } else if (file.size > 10 * 1024 * 1024) { // 10MB\r\n        result.warnings.push({\r\n            code: ValidationWarnings.LARGE_FILE,\r\n            message: `Large file (${formatBytes(file.size)}) may process slowly`,\r\n            severity: 'warning'\r\n        })\r\n    }\r\n\r\n    // Check file type\r\n    if (!allowedTypes.includes(file.type)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.UNSUPPORTED_TYPE,\r\n            message: `Unsupported file type: ${file.type}`,\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    // Store metadata\r\n    result.metadata = {\r\n        name: file.name,\r\n        type: file.type,\r\n        size: file.size,\r\n        lastModified: file.lastModified\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate dimensions - ENHANCED to handle variable dimensions\r\n * @param {Object} dimensions - Image dimensions\r\n * @param {Object} options - Validation options\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateDimensions(dimensions, options = {}) {\r\n    const {\r\n        minWidth = 1,\r\n        minHeight = 1,\r\n        maxWidth = 10000,\r\n        maxHeight = 10000,\r\n        requireIntegers = true,\r\n        allowVariable = true  // New option\r\n    } = options\r\n\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        dimensions: { ...dimensions },\r\n        hasVariableDimensions: false\r\n    }\r\n\r\n    const { width, height } = dimensions\r\n\r\n    // Parse dimensions\r\n    const widthInfo = parseDimension(width)\r\n    const heightInfo = parseDimension(height)\r\n\r\n    result.hasVariableDimensions = widthInfo.isVariable || heightInfo.isVariable\r\n\r\n    // Check if variable dimensions are allowed\r\n    if ((widthInfo.isVariable || heightInfo.isVariable) && !allowVariable) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.VARIABLE_DIMENSION_NOT_ALLOWED,\r\n            message: 'Variable dimensions are not allowed in this context',\r\n            severity: 'error',\r\n            suggestion: 'Provide fixed dimensions or enable allowVariable option'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Validate fixed dimensions\r\n    if (!widthInfo.isVariable) {\r\n        if (typeof widthInfo.value !== 'number' || isNaN(widthInfo.value)) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.INVALID_DIMENSIONS,\r\n                message: 'Width must be a valid number',\r\n                severity: 'error'\r\n            })\r\n        } else if (requireIntegers && !Number.isInteger(widthInfo.value)) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                message: 'Width should be an integer for best results',\r\n                severity: 'warning'\r\n            })\r\n        } else if (widthInfo.value < minWidth) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.DIMENSIONS_TOO_SMALL,\r\n                message: `Width too small (${widthInfo.value} < ${minWidth})`,\r\n                severity: 'error'\r\n            })\r\n        } else if (widthInfo.value > maxWidth) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.DIMENSIONS_TOO_LARGE,\r\n                message: `Width too large (${widthInfo.value} > ${maxWidth})`,\r\n                severity: 'error'\r\n            })\r\n        } else if (widthInfo.value < 50) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                message: `Small width (${widthInfo.value}px) may produce pixelated results`,\r\n                severity: 'warning'\r\n            })\r\n        }\r\n    }\r\n\r\n    if (!heightInfo.isVariable) {\r\n        if (typeof heightInfo.value !== 'number' || isNaN(heightInfo.value)) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.INVALID_DIMENSIONS,\r\n                message: 'Height must be a valid number',\r\n                severity: 'error'\r\n            })\r\n        } else if (requireIntegers && !Number.isInteger(heightInfo.value)) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                message: 'Height should be an integer for best results',\r\n                severity: 'warning'\r\n            })\r\n        } else if (heightInfo.value < minHeight) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.DIMENSIONS_TOO_SMALL,\r\n                message: `Height too small (${heightInfo.value} < ${minHeight})`,\r\n                severity: 'error'\r\n            })\r\n        } else if (heightInfo.value > maxHeight) {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.DIMENSIONS_TOO_LARGE,\r\n                message: `Height too large (${heightInfo.value} > ${maxHeight})`,\r\n                severity: 'error'\r\n            })\r\n        } else if (heightInfo.value < 50) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                message: `Small height (${heightInfo.value}px) may produce pixelated results`,\r\n                severity: 'warning'\r\n            })\r\n        }\r\n    }\r\n\r\n    // Calculate aspect ratio only if both dimensions are fixed\r\n    if (!widthInfo.isVariable && !heightInfo.isVariable &&\r\n        widthInfo.value > 0 && heightInfo.value > 0) {\r\n        result.dimensions.aspectRatio = widthInfo.value / heightInfo.value\r\n        result.dimensions.orientation = widthInfo.value >= heightInfo.value ? 'landscape' : 'portrait'\r\n\r\n        // Check for extreme dimensions\r\n        if (widthInfo.value > 4000 || heightInfo.value > 4000) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.LARGE_DIMENSIONS,\r\n                message: `Large dimensions (${widthInfo.value}x${heightInfo.value}) may cause performance issues`,\r\n                severity: 'warning'\r\n            })\r\n        }\r\n    } else if (widthInfo.isVariable || heightInfo.isVariable) {\r\n        result.dimensions.hasVariable = true\r\n        result.dimensions.variableType = widthInfo.isVariable ? 'width' : 'height'\r\n\r\n        // Warn about variable dimensions\r\n        result.warnings.push({\r\n            code: ValidationWarnings.VARIABLE_DIMENSION_USED,\r\n            message: `Using ${widthInfo.isVariable ? 'variable width' : 'variable height'} dimension`,\r\n            severity: 'info',\r\n            suggestion: 'One dimension will be calculated automatically'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate resize operation with variable dimension support\r\n * @param {Object} currentDimensions - Current image dimensions\r\n * @param {number|string} targetDimension - Target dimension (can be number or 'flex')\r\n * @param {string} mode - Resize mode ('auto', 'width', 'height')\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateResize(currentDimensions, targetDimension, mode = 'auto') {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        newDimensions: null\r\n    }\r\n\r\n    // Validate current dimensions\r\n    const dimValidation = validateDimensions(currentDimensions)\r\n    if (!dimValidation.valid) {\r\n        return dimValidation\r\n    }\r\n\r\n    const { width, height } = currentDimensions\r\n\r\n    // Parse target dimension\r\n    const targetInfo = parseDimension(targetDimension)\r\n\r\n    // Validate target dimension\r\n    if (targetInfo.isVariable) {\r\n        // Variable target - only valid in certain modes\r\n        if (mode === 'width' && targetInfo.type === 'flex') {\r\n            // Flexible width - maintain aspect ratio based on fixed height\r\n            result.newDimensions = { width: 'flex', height: height }\r\n            result.warnings.push({\r\n                code: ValidationWarnings.FLEXIBLE_TEMPLATE,\r\n                message: 'Using flexible width - will maintain natural aspect ratio',\r\n                severity: 'info'\r\n            })\r\n            return result\r\n        } else if (mode === 'height' && targetInfo.type === 'flex') {\r\n            // Flexible height - maintain aspect ratio based on fixed width\r\n            result.newDimensions = { width: width, height: 'flex' }\r\n            result.warnings.push({\r\n                code: ValidationWarnings.FLEXIBLE_TEMPLATE,\r\n                message: 'Using flexible height - will maintain natural aspect ratio',\r\n                severity: 'info'\r\n            })\r\n            return result\r\n        } else {\r\n            result.valid = false\r\n            result.errors.push({\r\n                code: ValidationErrors.INVALID_DIMENSIONS,\r\n                message: `Invalid target dimension for mode ${mode}: ${targetDimension}`,\r\n                severity: 'error'\r\n            })\r\n            return result\r\n        }\r\n    }\r\n\r\n    // Fixed target dimension validation\r\n    if (typeof targetInfo.value !== 'number' || targetInfo.value <= 0) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_DIMENSIONS,\r\n            message: `Invalid target dimension: ${targetDimension}`,\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Calculate new dimensions\r\n    let newWidth, newHeight\r\n    if (mode === 'width') {\r\n        newWidth = targetInfo.value\r\n        newHeight = Math.round((height / width) * targetInfo.value)\r\n    } else if (mode === 'height') {\r\n        newHeight = targetInfo.value\r\n        newWidth = Math.round((width / height) * targetInfo.value)\r\n    } else { // auto\r\n        if (width >= height) {\r\n            newWidth = targetInfo.value\r\n            newHeight = Math.round((height / width) * targetInfo.value)\r\n        } else {\r\n            newHeight = targetInfo.value\r\n            newWidth = Math.round((width / height) * targetInfo.value)\r\n        }\r\n    }\r\n\r\n    result.newDimensions = { width: newWidth, height: newHeight }\r\n\r\n    // Validate new dimensions\r\n    const newDimValidation = validateDimensions(result.newDimensions)\r\n    if (!newDimValidation.valid) {\r\n        return newDimValidation\r\n    }\r\n\r\n    // Add resize-specific warnings\r\n    const scaleFactor = newWidth / width\r\n\r\n    // Extreme downscaling warning\r\n    if (scaleFactor < 0.1) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.POTENTIAL_PIXELATION,\r\n            message: `Downscaling by ${((1 - scaleFactor) * 100).toFixed(1)}% may cause pixelation`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider using nearest-neighbor algorithm for pixel art'\r\n        })\r\n    }\r\n\r\n    // Extreme upscaling warning\r\n    if (scaleFactor > 4) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.POTENTIAL_PIXELATION,\r\n            message: `Upscaling by ${((scaleFactor - 1) * 100).toFixed(1)}% may reduce quality`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider using AI upscaling tools for better results'\r\n        })\r\n    }\r\n\r\n    // Aspect ratio change warning\r\n    const originalAspect = width / height\r\n    const newAspect = newWidth / newHeight\r\n    const aspectDiff = Math.abs(originalAspect - newAspect) / originalAspect\r\n\r\n    if (aspectDiff > 0.01) { // More than 1% deviation\r\n        result.warnings.push({\r\n            code: ValidationWarnings.ASPECT_CHANGE,\r\n            message: `Aspect ratio changed from ${originalAspect.toFixed(3)} to ${newAspect.toFixed(3)}`,\r\n            severity: 'info',\r\n            suggestion: 'Check if this deviation is acceptable'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate crop operation\r\n * @param {Object} currentDimensions - Current image dimensions\r\n * @param {number|string} cropWidth - Crop width (can be number or 'flex')\r\n * @param {number|string} cropHeight - Crop height (can be number or 'flex')\r\n * @param {string} position - Crop position\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateCrop(currentDimensions, cropWidth, cropHeight, position = 'center') {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        cropInfo: null\r\n    }\r\n\r\n    // Validate current dimensions\r\n    const dimValidation = validateDimensions(currentDimensions)\r\n    if (!dimValidation.valid) {\r\n        return dimValidation\r\n    }\r\n\r\n    const { width, height } = currentDimensions\r\n\r\n    // Parse crop dimensions\r\n    const cropWidthInfo = parseDimension(cropWidth)\r\n    const cropHeightInfo = parseDimension(cropHeight)\r\n\r\n    // Check for variable dimensions in crop\r\n    if (cropWidthInfo.isVariable || cropHeightInfo.isVariable) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.FLEXIBLE_TEMPLATE,\r\n            message: 'Using flexible dimensions for crop - will use maximum available space',\r\n            severity: 'info'\r\n        })\r\n\r\n        // For flexible crop, use original dimensions as max\r\n        const actualCropWidth = cropWidthInfo.isVariable ? width : cropWidthInfo.value\r\n        const actualCropHeight = cropHeightInfo.isVariable ? height : cropHeightInfo.value\r\n\r\n        result.cropInfo = {\r\n            cropDimensions: { width: actualCropWidth, height: actualCropHeight },\r\n            offsets: { x: 0, y: 0 },\r\n            position: 'center',\r\n            scale: 1,\r\n            hasFlexibleDimensions: true,\r\n            flexibleWidth: cropWidthInfo.isVariable,\r\n            flexibleHeight: cropHeightInfo.isVariable\r\n        }\r\n\r\n        return result\r\n    }\r\n\r\n    // Validate fixed crop dimensions\r\n    const cropDimValidation = validateDimensions({ width: cropWidthInfo.value, height: cropHeightInfo.value })\r\n    if (!cropDimValidation.valid) {\r\n        return cropDimValidation\r\n    }\r\n\r\n    // Calculate scale to fit\r\n    const scale = Math.max(cropWidthInfo.value / width, cropHeightInfo.value / height)\r\n    const scaledWidth = Math.round(width * scale)\r\n    const scaledHeight = Math.round(height * scale)\r\n\r\n    // Calculate crop offsets\r\n    let offsetX, offsetY\r\n    switch (position) {\r\n        case 'top':\r\n            offsetX = (scaledWidth - cropWidthInfo.value) / 2\r\n            offsetY = 0\r\n            break\r\n        case 'bottom':\r\n            offsetX = (scaledWidth - cropWidthInfo.value) / 2\r\n            offsetY = scaledHeight - cropHeightInfo.value\r\n            break\r\n        case 'left':\r\n            offsetX = 0\r\n            offsetY = (scaledHeight - cropHeightInfo.value) / 2\r\n            break\r\n        case 'right':\r\n            offsetX = scaledWidth - cropWidthInfo.value\r\n            offsetY = (scaledHeight - cropHeightInfo.value) / 2\r\n            break\r\n        case 'center':\r\n        default:\r\n            offsetX = (scaledWidth - cropWidthInfo.value) / 2\r\n            offsetY = (scaledHeight - cropHeightInfo.value) / 2\r\n    }\r\n\r\n    result.cropInfo = {\r\n        scaledDimensions: { width: scaledWidth, height: scaledHeight },\r\n        cropDimensions: { width: cropWidthInfo.value, height: cropHeightInfo.value },\r\n        offsets: { x: Math.max(0, Math.round(offsetX)), y: Math.max(0, Math.round(offsetY)) },\r\n        position,\r\n        scale\r\n    }\r\n\r\n    // Add crop-specific warnings\r\n    const contentLostX = Math.max(0, (cropWidthInfo.value - width) / width)\r\n    const contentLostY = Math.max(0, (cropHeightInfo.value - height) / height)\r\n    const maxContentLost = Math.max(contentLostX, contentLostY)\r\n\r\n    if (maxContentLost > 0.3) { // More than 30% content lost\r\n        result.warnings.push({\r\n            code: ValidationWarnings.CONTENT_LOSS,\r\n            message: `Crop will remove ${(maxContentLost * 100).toFixed(1)}% of image content`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider adjusting crop dimensions or position'\r\n        })\r\n    }\r\n\r\n    // Aspect ratio mismatch warning\r\n    const sourceAspect = width / height\r\n    const targetAspect = cropWidthInfo.value / cropHeightInfo.value\r\n    const aspectDiff = Math.abs(sourceAspect - targetAspect) / sourceAspect\r\n\r\n    if (aspectDiff > 0.5) { // More than 50% aspect ratio difference\r\n        result.warnings.push({\r\n            code: ValidationWarnings.ASPECT_CHANGE,\r\n            message: `Source aspect ratio (${sourceAspect.toFixed(2)}) differs significantly from target (${targetAspect.toFixed(2)})`,\r\n            severity: 'warning',\r\n            suggestion: 'This may result in stretched appearance'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate optimization settings\r\n * @param {string} currentFormat - Current image format\r\n * @param {string} targetFormat - Target format\r\n * @param {number} quality - Quality percentage\r\n * @param {boolean} hasTransparency - Whether image has transparency\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateOptimization(currentFormat, targetFormat, quality, hasTransparency = false) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        recommendations: []\r\n    }\r\n\r\n    // Validate quality\r\n    if (typeof quality !== 'number' || quality < 1 || quality > 100) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.QUALITY_OUT_OF_RANGE,\r\n            message: `Quality must be between 1-100, got ${quality}`,\r\n            severity: 'error'\r\n        })\r\n    } else if (quality > 95) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.HIGH_QUALITY,\r\n            message: `High quality setting (${quality}%) provides minimal visual improvement`,\r\n            severity: 'info',\r\n            suggestion: 'Consider 80-85% for optimal balance'\r\n        })\r\n    } else if (quality < 50) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.LOW_QUALITY,\r\n            message: `Low quality setting (${quality}%) may cause noticeable artifacts`,\r\n            severity: 'warning',\r\n            suggestion: 'Consider 60%+ for acceptable quality'\r\n        })\r\n    }\r\n\r\n    // Validate format compatibility\r\n    const formatMatrix = {\r\n        'jpg': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'tiff', 'ico'],\r\n        'jpeg': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'tiff', 'ico'],\r\n        'png': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'tiff', 'svg', 'ico'],\r\n        'webp': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'tiff', 'svg', 'ico'],\r\n        'avif': ['jpeg', 'png', 'webp', 'ico'],\r\n        'ico': ['jpeg', 'png', 'webp', 'gif', 'bmp', 'ico'] // Added favicon support\r\n    }\r\n\r\n    const current = currentFormat.toLowerCase().replace('image/', '')\r\n    const target = targetFormat.toLowerCase()\r\n\r\n    if (target !== 'original' && !formatMatrix[target]?.includes(current)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FORMAT,\r\n            message: `Cannot convert ${current} to ${target}`,\r\n            severity: 'error'\r\n        })\r\n    }\r\n\r\n    // Transparency loss warning\r\n    if ((target === 'jpg' || target === 'jpeg') && hasTransparency) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.TRANSPARENCY_LOSS,\r\n            message: 'JPEG format does not support transparency',\r\n            severity: 'warning',\r\n            suggestion: 'Use PNG or WebP to preserve transparency'\r\n        })\r\n    }\r\n\r\n    // Format-specific recommendations\r\n    if (target === 'webp') {\r\n        if (quality > 90) {\r\n            result.recommendations.push({\r\n                type: 'quality_adjustment',\r\n                message: 'WebP quality above 90 has diminishing returns',\r\n                suggestion: 'Use 80-85% for optimal size/quality balance'\r\n            })\r\n        }\r\n    } else if (target === 'jpg' || target === 'jpeg') {\r\n        result.recommendations.push({\r\n            type: 'format_suggestion',\r\n            message: 'Consider WebP for better compression with similar quality',\r\n            suggestion: 'WebP typically provides 25-35% smaller files than JPEG'\r\n        })\r\n    } else if (target === 'ico') {\r\n        result.recommendations.push({\r\n            type: 'format_suggestion',\r\n            message: 'ICO format is best for favicons and Windows icons',\r\n            suggestion: 'Include multiple sizes (16×16, 32×32, 48×48, 64×64) in single .ico file'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate batch rename pattern\r\n * @param {string} pattern - Rename pattern\r\n * @returns {Object} Validation result\r\n */\r\nexport function validateRenamePattern(pattern) {\r\n    const result = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n        variables: []\r\n    }\r\n\r\n    if (typeof pattern !== 'string' || pattern.trim() === '') {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FORMAT,\r\n            message: 'Pattern cannot be empty',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Check for invalid filename characters\r\n    const invalidChars = /[<>:\"/\\\\|?*]/\r\n    if (invalidChars.test(pattern)) {\r\n        result.valid = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_FORMAT,\r\n            message: 'Pattern contains invalid filename characters',\r\n            severity: 'error',\r\n            details: 'Remove <>:\"/\\\\|?* from pattern'\r\n        })\r\n    }\r\n\r\n    // Extract variables\r\n    const variableRegex = /\\{(\\w+)\\}/g\r\n    let match\r\n    const variables = new Set()\r\n\r\n    while ((match = variableRegex.exec(pattern)) !== null) {\r\n        variables.add(match[1])\r\n    }\r\n\r\n    result.variables = Array.from(variables)\r\n\r\n    // Check for unknown variables\r\n    const knownVariables = [\r\n        'name', 'index', 'date', 'time', 'year', 'month', 'day',\r\n        'hour', 'minute', 'second', 'timestamp', 'width', 'height',\r\n        'size', 'format', 'ext', 'orientation', 'aspect', 'total', 'padded'\r\n    ]\r\n\r\n    const unknownVars = result.variables.filter(v => !knownVariables.includes(v))\r\n    if (unknownVars.length > 0) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.CONTENT_LOSS,\r\n            message: `Unknown variables: ${unknownVars.join(', ')}`,\r\n            severity: 'warning',\r\n            suggestion: 'These variables will not be replaced'\r\n        })\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Validate template dimensions compatibility\r\n * @param {Object} template - Template with dimensions\r\n * @param {Object} imageDimensions - Image dimensions\r\n * @returns {Object} Compatibility result\r\n */\r\nexport function validateTemplateCompatibility(template, imageDimensions) {\r\n    const result = {\r\n        compatible: true,\r\n        errors: [],\r\n        warnings: [],\r\n        matchScore: 0,\r\n        recommendations: []\r\n    }\r\n\r\n    // Parse template dimensions\r\n    const templateWidth = parseDimension(template.width)\r\n    const templateHeight = parseDimension(template.height)\r\n\r\n    // Parse image dimensions\r\n    const imageWidth = parseDimension(imageDimensions.width)\r\n    const imageHeight = parseDimension(imageDimensions.height)\r\n\r\n    // Check for variable dimensions in template\r\n    if (templateWidth.isVariable || templateHeight.isVariable) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.FLEXIBLE_TEMPLATE,\r\n            message: 'Using flexible template - one dimension will adapt automatically',\r\n            severity: 'info'\r\n        })\r\n\r\n        // Calculate match score for flexible template\r\n        let score = 80 // High base score for flexible templates\r\n\r\n        // Check aspect ratio compatibility if both image dimensions are fixed\r\n        if (!imageWidth.isVariable && !imageHeight.isVariable) {\r\n            if (templateWidth.isVariable && !templateHeight.isVariable) {\r\n                // Height fixed, check if image has sufficient height\r\n                const heightRatio = imageHeight.value / templateHeight.value\r\n                if (heightRatio >= 0.8) {\r\n                    score += 20\r\n                } else {\r\n                    score *= heightRatio\r\n                    result.warnings.push({\r\n                        code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                        message: `Image height (${imageHeight.value}px) is smaller than template height (${templateHeight.value}px)`,\r\n                        severity: 'warning'\r\n                    })\r\n                }\r\n            } else if (!templateWidth.isVariable && templateHeight.isVariable) {\r\n                // Width fixed, check if image has sufficient width\r\n                const widthRatio = imageWidth.value / templateWidth.value\r\n                if (widthRatio >= 0.8) {\r\n                    score += 20\r\n                } else {\r\n                    score *= widthRatio\r\n                    result.warnings.push({\r\n                        code: ValidationWarnings.SMALL_DIMENSIONS,\r\n                        message: `Image width (${imageWidth.value}px) is smaller than template width (${templateWidth.value}px)`,\r\n                        severity: 'warning'\r\n                    })\r\n                }\r\n            }\r\n        }\r\n\r\n        result.matchScore = score / 100\r\n        result.compatible = true\r\n        return result\r\n    }\r\n\r\n    // Fixed template dimensions validation\r\n    if (imageWidth.isVariable || imageHeight.isVariable) {\r\n        result.compatible = false\r\n        result.errors.push({\r\n            code: ValidationErrors.INVALID_DIMENSIONS,\r\n            message: 'Cannot use variable image dimensions with fixed template',\r\n            severity: 'error'\r\n        })\r\n        return result\r\n    }\r\n\r\n    // Check if image meets minimum template dimensions\r\n    if (imageWidth.value < templateWidth.value || imageHeight.value < templateHeight.value) {\r\n        result.warnings.push({\r\n            code: ValidationWarnings.SMALL_DIMENSIONS,\r\n            message: `Image dimensions (${imageWidth.value}x${imageHeight.value}) are smaller than template (${templateWidth.value}x${templateHeight.value})`,\r\n            severity: 'warning'\r\n        })\r\n\r\n        // Calculate how much smaller\r\n        const widthRatio = imageWidth.value / templateWidth.value\r\n        const heightRatio = imageHeight.value / templateHeight.value\r\n        const minRatio = Math.min(widthRatio, heightRatio)\r\n\r\n        result.matchScore = minRatio * 0.8 // Scale score based on size adequacy\r\n    } else {\r\n        // Image is equal or larger - good match\r\n        result.matchScore = 0.9\r\n\r\n        // Check aspect ratio\r\n        const imageAspect = imageWidth.value / imageHeight.value\r\n        const templateAspect = templateWidth.value / templateHeight.value\r\n        const aspectDiff = Math.abs(imageAspect - templateAspect) / imageAspect\r\n\r\n        if (aspectDiff > 0.1) {\r\n            result.warnings.push({\r\n                code: ValidationWarnings.ASPECT_CHANGE,\r\n                message: `Aspect ratio differs (image: ${imageAspect.toFixed(2)}, template: ${templateAspect.toFixed(2)})`,\r\n                severity: 'warning',\r\n                suggestion: 'Consider cropping to match template aspect ratio'\r\n            })\r\n            result.matchScore *= 0.8 // Reduce score for aspect mismatch\r\n        }\r\n    }\r\n\r\n    return result\r\n}\r\n\r\n/**\r\n * Get validation summary\r\n * @param {Object} validationResults - Array of validation results\r\n * @returns {Object} Summary\r\n */\r\nexport function getValidationSummary(validationResults) {\r\n    const summary = {\r\n        total: validationResults.length,\r\n        valid: 0,\r\n        errors: 0,\r\n        warnings: 0,\r\n        errorDetails: [],\r\n        warningDetails: []\r\n    }\r\n\r\n    validationResults.forEach(result => {\r\n        if (result.valid) summary.valid++\r\n        summary.errors += result.errors.length\r\n        summary.warnings += result.warnings.length\r\n\r\n        result.errors.forEach(error => {\r\n            summary.errorDetails.push({\r\n                ...error,\r\n                source: result.metadata?.name || 'Unknown'\r\n            })\r\n        })\r\n\r\n        result.warnings.forEach(warning => {\r\n            summary.warningDetails.push({\r\n                ...warning,\r\n                source: result.metadata?.name || 'Unknown'\r\n            })\r\n        })\r\n    })\r\n\r\n    return summary\r\n}\r\n\r\n/**\r\n * Get all flexible dimension templates\r\n * @param {Array} templates - Template array\r\n * @returns {Array} Templates with flexible dimensions\r\n */\r\nexport function getFlexibleTemplates(templates) {\r\n    return templates.filter(template => {\r\n        const widthInfo = parseDimension(template.width)\r\n        const heightInfo = parseDimension(template.height)\r\n        return widthInfo.isVariable || heightInfo.isVariable\r\n    })\r\n}\r\n\r\nexport default {\r\n    ValidationErrors,\r\n    ValidationWarnings,\r\n    isVariableDimension,\r\n    parseDimension,\r\n    validateOptimizationOptions,\r\n    validateImage,\r\n    validateDimensions,\r\n    validateResize,\r\n    validateCrop,\r\n    validateOptimization,\r\n    validateRenamePattern,\r\n    validateTemplateCompatibility,\r\n    getValidationSummary,\r\n    getFlexibleTemplates\r\n}"],"names":["ValidationErrors","ValidationWarnings","isVariableDimension","value","lowerValue","parseDimension","numValue","formatBytes","bytes","decimals","k","dm","sizes","i","validateOptimizationOptions","options","errors","warnings","result","quality","format","compressionMode","maxDisplayWidth","browserSupport","preserveTransparency","validFormats","avifQuality","validCompressionModes","size","validateImage","file","maxFileSize","minFileSize","allowedTypes","checkDimensions","minDimensions","maxDimensions","validateDimensions","dimensions","minWidth","minHeight","maxWidth","maxHeight","requireIntegers","allowVariable","width","height","widthInfo","heightInfo","validateResize","currentDimensions","targetDimension","mode","dimValidation","targetInfo","newWidth","newHeight","newDimValidation","scaleFactor","originalAspect","newAspect","validateCrop","cropWidth","cropHeight","position","cropWidthInfo","cropHeightInfo","actualCropWidth","actualCropHeight","cropDimValidation","scale","scaledWidth","scaledHeight","offsetX","offsetY","contentLostX","contentLostY","maxContentLost","sourceAspect","targetAspect","validateOptimization","currentFormat","targetFormat","hasTransparency","formatMatrix","current","target","validateRenamePattern","pattern","variableRegex","match","variables","knownVariables","unknownVars","v","validateTemplateCompatibility","template","imageDimensions","templateWidth","templateHeight","imageWidth","imageHeight","score","heightRatio","widthRatio","minRatio","imageAspect","templateAspect","getValidationSummary","validationResults","summary","error","warning","getFlexibleTemplates","templates","validation"],"mappings":"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"}